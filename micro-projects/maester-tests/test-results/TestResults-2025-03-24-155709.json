{
  "Result": "Failed",
  "FailedCount": 67,
  "PassedCount": 59,
  "SkippedCount": 65,
  "TotalCount": 197,
  "ExecutedAt": "2025-03-24T15:57:09.6048328-04:00",
  "TenantId": "a6014805-994d-45e8-98ef-306a7e2e2139",
  "TenantName": "K-laboratory",
  "Account": "mhebert@klabmtl.ca",
  "CurrentVersion": "1.0.0",
  "LatestVersion": "1.0.0",
  "Tests": [
    {
      "Name": "CIS 1.1.1 (L1) Ensure Administrative accounts are separate and cloud-only",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.1.1",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisCloudAdmin\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"admin accounts are separate and cloud-only\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisCloudAdmin.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has no hybrid Global Administrators:\n\n| Display Name | Cloud Only |\n| --- | --- |\n| Almighty Admin | ✅ Pass |\n| Anthony Thurel | ✅ Pass |\n| Antoine Durocher | ✅ Pass |\n| Gabriel Tessier | ✅ Pass |\n| Marc-Antoine Hébert | ✅ Pass |\n| Philippe De Ladurantaye | ✅ Pass |\n| The Notorious BGA | ✅ Pass |\n",
        "TestDescription": "1.1.1 (L1) Ensure Administrative accounts are separate and cloud-only\r\n\r\nAdministrative accounts are special privileged accounts that could have varying levels of access to data, users, and settings. Regular user accounts should never be utilized for administrative tasks and care should be taken, in the case of a hybrid environment, to keep Administrative accounts separated from on-prem accounts. Administrative accounts should not have applications assigned so that they have no access to potentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to perform tasks as needed for administrative purposes.\r\n\r\n#### Remediation action:\r\n\r\nTo created licensed, separate Administrative accounts for Administrative users:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Click to expand **Users** select **Active users**\r\n3. Click **Add a user**.\r\n4. Fill out the appropriate fields for Name, user, etc.\r\n5. When prompted to assign licenses select as needed **Microsoft Entra ID P1** or\r\n**Microsoft Entra ID P2**, then click **Next**.\r\n6. Under the **Option settings** screen you may choose from several types of\r\nAdministrative access roles. Choose **Admin center access** followed by the\r\nappropriate role then click **Next**.\r\n7. Select **Finish adding**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 16](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 1.1.3 (L1) Ensure that between two and four global admins are designated",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.1.3",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisGlobalAdminCount\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"only 2-4 Global Administrators exist\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisGlobalAdminCount.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because only 2-4 Global Administrators exist, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because only 2-4 Global Administrators exist, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisGlobalAdminCount.Tests.ps1",
            "Line": "7",
            "LineText": "            $result | Should -Be $true -Because \"only 2-4 Global Administrators exist\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisGlobalAdminCount.Tests.ps1: line 7\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have the appropriate number of Global Administrators.",
        "TestDescription": "1.1.3 (L1) Ensure that between two and four global admins are designated\r\n\r\nMore than one global administrator should be designated so a single admin can be monitored and to provide redundancy should a single admin leave an organization. Additionally, there should be no more than four global admins set for any tenant. Ideally global administrators will have no licenses assigned to them.\r\n\r\n#### Remediation action:\r\n\r\nTo correct the number of global tenant administrators:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Select **Users** > **Active Users**.\r\n3. In the Search field enter the name of the user to be made a Global Administrator.\r\n4. To create a new Global Admin:\r\n 1. Select the user's name.\r\n 2. A window will appear to the right.\r\n 3. Select **Manage roles**.\r\n 4. Select **Admin center access**.\r\n 5. Check **Global Administrator**.\r\n 6. Click Save changes.\r\n\r\nTo remove Global Admins:\r\n1. Select **User**.\r\n2. Under Roles select **Manage roles**.\r\n3. De-Select the appropriate role.\r\n4. Click **Save changes**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 25](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 1.2.1 (L2) Ensure that only organizationally managed/approved public groups exist",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.2.1",
        "L2",
        "CIS E3 Level 2",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCis365PublicGroup\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"365 groups are private\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCis365PublicGroup.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has no public 365 groups:\n\n| Display Name | Group Public |\n| --- | --- |\n",
        "TestDescription": "1.2.1 (L2) Ensure that only organizationally managed/approved public groups exist\r\n\r\nMicrosoft 365 Groups is the foundational membership service that drives all teamwork across Microsoft 365. With Microsoft 365 Groups, you can give a group of people access to a collection of shared resources. While there are several different group types this recommendation concerns Microsoft 365 Groups.\r\n\r\nEnsure that only organizationally managed and approved public groups exist.\r\n\r\n#### Remediation action:\r\n\r\nTo enable only organizationally managed/approved public groups exist:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Click to expand **Teams & groups** select **Active teams & groups**.\r\n3. On the **Active teams and groups** page, select the group's name that is public.\r\n4. On the popup groups name page, **Select Settings**.\r\n5. Under Privacy, select **Private**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 30](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AF01: Authentication Method - FIDO2 security key - State.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AF01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF01"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\"\r\n            .state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AF01 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - FIDO2 security key",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'enabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')**\r\n",
        "TestDescription": "Whether the FIDO2 security keys is enabled in the tenant.\r\n\r\nenabled\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\r\n.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [fido2AuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/fido2authenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AF02: Authentication Method - FIDO2 security key - Allow self-service set up.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AF02",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF02"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\"\r\n            .isSelfServiceRegistrationAllowed -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AF02 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - FIDO2 security key",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')**\r\n",
        "TestDescription": "Allows users to register a FIDO key through the MySecurityInfo portal, even if enabled by Authentication Methods policy.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\r\n.isSelfServiceRegistrationAllowed -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [fido2AuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/fido2authenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AF03: Authentication Method - FIDO2 security key - Enforce attestation.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AF03",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF03"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\"\r\n            .isAttestationEnforced -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AF03 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - FIDO2 security key",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')**\r\n",
        "TestDescription": "Requires the FIDO security key metadata to be published and verified with the FIDO Alliance Metadata Service, and also pass Microsoft's additional set of validation testing.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\r\n.isAttestationEnforced -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [fido2AuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/fido2authenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AF04: Authentication Method - FIDO2 security key - Enforce key restrictions.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AF04",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF04"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\"\r\n            .keyRestrictions.isEnforced -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AF04 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 4\nActual length:   5\nStrings differ at index 0.\nExpected: 'true'\nBut was:  'False'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 4\nActual length:   5\nStrings differ at index 0.\nExpected: 'true'\nBut was:  'False'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "315",
            "LineText": "        Test-MtEidscaControl -CheckId AF04 | Should -Be 'true'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 315\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - FIDO2 security key",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **False**.\n\nThe recommended value is **'true'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')**\r\n",
        "TestDescription": "Manages if registration of FIDO2 keys should be restricted.\r\n\r\nRestrict usage of FIDO2 from unauthorized vendors or platforms\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\r\n.keyRestrictions.isEnforced -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [fido2AuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/fido2authenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AG01: Authentication Method - General Settings - Manage migration.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AG01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AG01"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy\"\r\n            .policyMigrationState -eq 'migrationComplete'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AG01 | Should -Be 'migrationComplete'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 17\nActual length:   12\nStrings differ at index 0.\nExpected: 'migrationComplete'\nBut was:  'preMigration'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 17\nActual length:   12\nStrings differ at index 0.\nExpected: 'migrationComplete'\nBut was:  'preMigration'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "187",
            "LineText": "        Test-MtEidscaControl -CheckId AG01 | Should -Be 'migrationComplete'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 187\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - General Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **preMigration**.\n\nThe recommended value is **'migrationComplete'** for **policies/authenticationMethodsPolicy**\r\n",
        "TestDescription": "The state of migration of the authentication methods policy from the legacy multifactor authentication and self-service password reset (SSPR) policies. In January 2024, the legacy multifactor authentication and self-service password reset policies will be deprecated and you'll manage all authentication methods here in the authentication methods policy. Use this control to manage your migration from the legacy policies to the new unified policy.\r\n\r\nOn September 30th, 2025, the legacy multifactor authentication and self-service password reset policies will be deprecated and you'll manage all authentication methods here in the authentication methods policy. Use this control to manage your migration from the legacy policies to the new unified policy.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy\r\n.policyMigrationState -eq 'migrationComplete'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [Get authenticationMethodsPolicy - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/authenticationmethodspolicy-get)\r\n- [View in Microsoft Entra admin center](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AG02: Authentication Method - General Settings - Report suspicious activity - State.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AG02",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AG02"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy\"\r\n            .reportSuspiciousActivitySettings.state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AG02 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nString lengths are both 7.\nStrings differ at index 0.\nExpected: 'enabled'\nBut was:  'default'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nString lengths are both 7.\nStrings differ at index 0.\nExpected: 'enabled'\nBut was:  'default'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "196",
            "LineText": "        Test-MtEidscaControl -CheckId AG02 | Should -Be 'enabled'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 196\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - General Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **default**.\n\nThe recommended value is **'enabled'** for **policies/authenticationMethodsPolicy**\r\n",
        "TestDescription": "Allows users to report suspicious activities if they receive an authentication request that they did not initiate. This control is available when using the Microsoft Authenticator app and voice calls. Reporting suspicious activity will set the user's risk to high. If the user is subject to risk-based Conditional Access policies, they may be blocked.\r\n\r\nAllows to integrate report of fraud attempt by users to identity protection: Users who report an MFA prompt as suspicious are set to High User Risk. Administrators can use risk-based policies to limit access for these users, or enable self-service password reset (SSPR) for users to remediate problems on their own.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy\r\n.reportSuspiciousActivitySettings.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [Get authenticationMethodsPolicy - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/authenticationmethodspolicy-get)\r\n- [View in Microsoft Entra admin center](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AuthMethodsSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AG03: Authentication Method - General Settings - Report suspicious activity - Included users/groups.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AG03",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AG03"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy\"\r\n            .reportSuspiciousActivitySettings.includeTarget.id -eq 'all_users'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AG03 | Should -Be 'all_users'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - General Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'all_users'** for **policies/authenticationMethodsPolicy**\r\n",
        "TestDescription": "Object Id or scope of users which will be included to report suspicious activities if they receive an authentication request that they did not initiate.\r\n\r\nApply this feature to all users.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy\r\n.reportSuspiciousActivitySettings.includeTarget.id -eq 'all_users'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [Get authenticationMethodsPolicy - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/authenticationmethodspolicy-get)\r\n- [View in Microsoft Entra admin center](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AuthMethodsSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM01: Authentication Method - Microsoft Authenticator - State.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM01"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM01 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'enabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Whether the Authenticator App is enabled in the tenant.\r\n\r\nenabled\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n- [View in Microsoft Entra admin center](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM02: Authentication Method - Microsoft Authenticator - Allow use of Microsoft Authenticator OTP.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM02",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM02"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .isSoftwareOathEnabled -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM02 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 4\nActual length:   5\nStrings differ at index 0.\nExpected: 'true'\nBut was:  'False'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 4\nActual length:   5\nStrings differ at index 0.\nExpected: 'true'\nBut was:  'False'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "224",
            "LineText": "        Test-MtEidscaControl -CheckId AM02 | Should -Be 'true'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 224\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **False**.\n\nThe recommended value is **'true'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Defines if users can use the OTP code generated by the Authenticator App.\r\n\r\ntrue\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.isSoftwareOathEnabled -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n- [View in Microsoft Entra admin center](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM03: Authentication Method - Microsoft Authenticator - Require number matching for push notifications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM03",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM03"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .featureSettings.numberMatchingRequiredState.state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM03 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'enabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Defines if number matching is required for MFA notifications.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.featureSettings.numberMatchingRequiredState.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM04: Authentication Method - Microsoft Authenticator - Included users/groups of number matching for push notifications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM04",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM04"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .featureSettings.numberMatchingRequiredState.includeTarget.id -eq 'all_users'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM04 | Should -Be 'all_users'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'all_users'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Object Id or scope of users which will be showing number matching in the Authenticator App.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.featureSettings.numberMatchingRequiredState.includeTarget.id -eq 'all_users'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM06: Authentication Method - Microsoft Authenticator - Show application name in push and passwordless notifications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM06",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM06"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .featureSettings.displayAppInformationRequiredState.state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM06 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'enabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Determines whether the user's Authenticator app will show them the client app they are signing into.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.featureSettings.displayAppInformationRequiredState.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM07: Authentication Method - Microsoft Authenticator - Included users/groups to show application name in push and passwordless notifications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM07",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM07"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .featureSettings.displayAppInformationRequiredState.includeTarget.id -eq 'all_users'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM07 | Should -Be 'all_users'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 9\nActual length:   36\nStrings differ at index 1.\nExpected: 'all_users'\nBut was:  'afc1a098-b192-427d-88a1-267d03512d9b'\n           -^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 9\nActual length:   36\nStrings differ at index 1.\nExpected: 'all_users'\nBut was:  'afc1a098-b192-427d-88a1-267d03512d9b'\n           -^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "260",
            "LineText": "        Test-MtEidscaControl -CheckId AM07 | Should -Be 'all_users'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 260\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **afc1a098-b192-427d-88a1-267d03512d9b**.\n\nThe recommended value is **'all_users'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Object Id or scope of users which will be showing app information in the Authenticator App.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.featureSettings.displayAppInformationRequiredState.includeTarget.id -eq 'all_users'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM09: Authentication Method - Microsoft Authenticator - Show geographic location in push and passwordless notifications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM09",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM09"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .featureSettings.displayLocationInformationRequiredState.state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM09 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'enabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Determines whether the user's Authenticator app will show them the geographic location of where the authentication request originated from.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.featureSettings.displayLocationInformationRequiredState.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AM10: Authentication Method - Microsoft Authenticator - Included users/groups to show geographic location in push and passwordless notifications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AM10",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM10"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\"\r\n            .featureSettings.displayLocationInformationRequiredState.includeTarget.id -eq 'all_users'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AM10 | Should -Be 'all_users'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 9\nActual length:   36\nStrings differ at index 1.\nExpected: 'all_users'\nBut was:  'afc1a098-b192-427d-88a1-267d03512d9b'\n           -^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 9\nActual length:   36\nStrings differ at index 1.\nExpected: 'all_users'\nBut was:  'afc1a098-b192-427d-88a1-267d03512d9b'\n           -^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "278",
            "LineText": "        Test-MtEidscaControl -CheckId AM10 | Should -Be 'all_users'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 278\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - Microsoft Authenticator",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **afc1a098-b192-427d-88a1-267d03512d9b**.\n\nThe recommended value is **'all_users'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')**\r\n",
        "TestDescription": "Object Id or scope of users which will be showing geographic location in the Authenticator App.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')\r\n.featureSettings.displayLocationInformationRequiredState.includeTarget.id -eq 'all_users'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('MicrosoftAuthenticator')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [microsoftAuthenticatorAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/microsoftauthenticatorauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP01: Default Authorization Settings - Enabled Self service password reset for administrators.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP01"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .allowedToUseSSPR -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP01 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "12",
            "LineText": "        Test-MtEidscaControl -CheckId AP01 | Should -Be 'false'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 12\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **True**.\n\nThe recommended value is **'false'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Indicates whether administrators of the tenant can use the Self-Service Password Reset (SSPR). The policy applies to some critical critical roles in Microsoft Entra ID.\r\n\r\nAdministrators with sensitive roles should use phishing-resistant authentication methods only and therefore not able to reset their password using SSPR.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.allowedToUseSSPR -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP04: Default Authorization Settings - Guest invite restrictions.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP04",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP04"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .allowInvitesFrom -in @('adminsAndGuestInviters','none')\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP04 | Should -BeIn @('adminsAndGuestInviters','none')\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is one of the following values **@('adminsAndGuestInviters','none')** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Manages controls who can invite guests to your directory to collaborate on resources secured by your Azure AD, such as SharePoint sites or Azure resources.\r\n\r\nCISA SCuBA 2.18: Only users with the Guest Inviter role SHOULD be able to invite guest users\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.allowInvitesFrom -in @('adminsAndGuestInviters','none')\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/CompanyRelationshipsMenuBlade/~/Settings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP05: Default Authorization Settings - Sign-up for email based subscription.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP05",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP05"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .allowedToSignUpEmailBasedSubscriptions -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP05 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "30",
            "LineText": "        Test-MtEidscaControl -CheckId AP05 | Should -Be 'false'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 30\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **True**.\n\nThe recommended value is **'false'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Indicates whether users can sign up for email based subscriptions.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.allowedToSignUpEmailBasedSubscriptions -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP06: Default Authorization Settings - User can join the tenant by email validation.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP06",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP06"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .allowEmailVerifiedUsersToJoinOrganization -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP06 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "39",
            "LineText": "        Test-MtEidscaControl -CheckId AP06 | Should -Be 'false'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 39\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **True**.\n\nThe recommended value is **'false'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Controls whether users can join the tenant by email validation. To join, the user must have an email address in a domain which matches one of the verified domains in the tenant.\r\n\r\n[Self-service sign up for email-verified users - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/directory-self-service-signup)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.allowEmailVerifiedUsersToJoinOrganization -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP07: Default Authorization Settings - Guest user access.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP07",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP07"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .guestUserRoleId -eq '2af84b1e-32c8-42b7-82bc-daa82404023b'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP07 | Should -Be '2af84b1e-32c8-42b7-82bc-daa82404023b'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'2af84b1e-32c8-42b7-82bc-daa82404023b'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Represents role templateId for the role that should be granted to guest user.\r\n\r\nCISA SCuBA 2.18: Guest users SHOULD have limited access to Azure AD directory objects.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.guestUserRoleId -eq '2af84b1e-32c8-42b7-82bc-daa82404023b'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/AllowlistPolicyBlade)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP08: Default Authorization Settings - User consent policy assigned for applications.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP08",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP08"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .permissionGrantPolicyIdsAssignedToDefaultUserRole | Sort-Object -Descending | select-object -first 1 -eq 'ManagePermissionGrantsForSelf.microsoft-user-default-low'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP08 | Should -Be 'ManagePermissionGrantsForSelf.microsoft-user-default-low'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 56\nActual length:   59\nStrings differ at index 54.\nExpected: 'ManagePermissionGrantsForSelf.microsoft-user-default-low'\nBut was:  'ManagePermissionGrantsForSelf.microsoft-user-default-legacy'\n           ------------------------------------------------------^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 56\nActual length:   59\nStrings differ at index 54.\nExpected: 'ManagePermissionGrantsForSelf.microsoft-user-default-low'\nBut was:  'ManagePermissionGrantsForSelf.microsoft-user-default-legacy'\n           ------------------------------------------------------^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "57",
            "LineText": "        Test-MtEidscaControl -CheckId AP08 | Should -Be 'ManagePermissionGrantsForSelf.microsoft-user-default-low'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 57\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **ManagePermissionGrantsForSelf.microsoft-user-default-legacy**.\n\nThe recommended value is **'ManagePermissionGrantsForSelf.microsoft-user-default-low'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Defines if user consent to apps is allowed, and if it is, which app consent policy (permissionGrantPolicy) governs the permissions.\r\n\r\nMicrosoft recommends to allow to user consent for apps from verified publisher for selected permissions. CISA SCuBA 2.7 defines that all Non-Admin Users SHALL Be Prevented From Providing Consent To Third-Party Applications.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.permissionGrantPolicyIdsAssignedToDefaultUserRole | Sort-Object -Descending | select-object -first 1 -eq 'ManagePermissionGrantsForSelf.microsoft-user-default-low'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP09: Default Authorization Settings - Risk-based step-up consent.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP09",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP09"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .allowUserConsentForRiskyApps -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP09 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'false'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Indicates whether user consent for risky apps is allowed. For example, consent requests for newly registered multi-tenant apps that are not publisher verified and require non-basic permissions are considered risky.\r\n\r\n[Configure risk-based step-up consent - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/configure-risk-based-step-up-consent)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.allowUserConsentForRiskyApps -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP10: Default Authorization Settings - Default User Role Permissions - Allowed to create Apps.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP10",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP10"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .defaultUserRolePermissions.allowedToCreateApps -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP10 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 5\nActual length:   4\nStrings differ at index 0.\nExpected: 'false'\nBut was:  'True'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "75",
            "LineText": "        Test-MtEidscaControl -CheckId AP10 | Should -Be 'false'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 75\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **True**.\n\nThe recommended value is **'false'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Controls if non-admin users may register custom-developed applications for use within this directory.\r\n\r\nCISA SCuBA 2.6: Only Administrators SHALL Be Allowed To Register Third-Party Applications\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.defaultUserRolePermissions.allowedToCreateApps -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/UserSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AP14: Default Authorization Settings - Default User Role Permissions - Allowed to read other users.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AP14",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP14"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authorizationPolicy\"\r\n            .defaultUserRolePermissions.allowedToReadOtherUsers -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AP14 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Authorization Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **policies/authorizationPolicy**\r\n",
        "TestDescription": "Prevents all non-admins from reading user information from the directory. This flag doesn't prevent reading user information in other Microsoft services like Exchange Online.\r\n\r\nRestrict this default permissions for members have huge impact on collaboration features and user lookup.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authorizationPolicy\r\n.defaultUserRolePermissions.allowedToReadOtherUsers -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authorizationPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [authorizationPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/authorizationpolicy)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AT01: Authentication Method - Temporary Access Pass - State.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AT01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AT01"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')\"\r\n            .state -eq 'enabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AT01 | Should -Be 'enabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Temporary Access Pass",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'enabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')**\r\n",
        "TestDescription": "Whether the Temporary Access Pass is enabled in the tenant.\r\n\r\nUse Temporary Access Pass for secure onboarding users (initial password replacement) and enforce MFA for registering security information in Conditional Access Policy.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')\r\n.state -eq 'enabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [temporaryAccessPassAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/temporaryaccesspassauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AT02: Authentication Method - Temporary Access Pass - One-time.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AT02",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AT02"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')\"\r\n            .isUsableOnce -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AT02 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 4\nActual length:   5\nStrings differ at index 0.\nExpected: 'true'\nBut was:  'False'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 4\nActual length:   5\nStrings differ at index 0.\nExpected: 'true'\nBut was:  'False'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "352",
            "LineText": "        Test-MtEidscaControl -CheckId AT02 | Should -Be 'true'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 352\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - Temporary Access Pass",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **False**.\n\nThe recommended value is **'true'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')**\r\n",
        "TestDescription": "Determines whether the pass is limited to a one-time use.\r\n\r\nAvoid to allow reusable passes and restrict usage to one-time use (if applicable)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')\r\n.isUsableOnce -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('TemporaryAccessPass')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [temporaryAccessPassAuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/temporaryaccesspassauthenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AV01: Authentication Method - Voice call - State.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AV01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AV01"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Voice')\"\r\n            .state -eq 'disabled'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AV01 | Should -Be 'disabled'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Authentication Method - Voice call",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'disabled'** for **policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Voice')**\r\n",
        "TestDescription": "Whether the Voice call is enabled in the tenant.\r\n\r\nChoose authentication methods with number matching (Authenticator) \r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Voice')\r\n.state -eq 'disabled'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Voice')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CP03: Default Settings - Consent Policy Settings - Block user consent for risky apps.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CP03",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CP03"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'BlockUserConsentForRiskyApps' | select-object -expand value -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CP03 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Consent Policy Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **settings**\r\n",
        "TestDescription": "Defines whether user consent will be blocked when a risky request is detected\r\n\r\n[Configure risk-based step-up consent - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/configure-risk-based-step-up-consent)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'BlockUserConsentForRiskyApps' | select-object -expand value -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CP04: Default Settings - Consent Policy Settings - Users can request admin consent to apps they are unable to consent to.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CP04",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CP04"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'EnableAdminConsentRequests' | select-object -expand value -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CP04 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Consent Policy Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **settings**\r\n",
        "TestDescription": "If this option is set to enabled, then users request admin consent to any app that requires access to data they do not have the permission to grant. If this option is set to disabled, then users must contact their admin to request to consent in order to use the apps they need.\r\n\r\nCISA SCuBA 2.7: Non-Admin Users SHALL Be Prevented From Providing Consent To Third-Party Applications.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'EnableAdminConsentRequests' | select-object -expand value -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CR01: Consent Framework - Admin Consent Request - Policy to enable or disable admin consent request feature.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CR01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CR01"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\"\r\n            .isEnabled -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CR01 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Consent Framework - Admin Consent Request",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **policies/adminConsentRequestPolicy**\r\n",
        "TestDescription": "Defines if admin consent request feature is enabled or disabled\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\r\n.isEnabled -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/adminConsentRequestPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [adminConsentRequestPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/adminconsentrequestpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CR02: Consent Framework - Admin Consent Request - Reviewers will receive email notifications for requests.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CR02",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CR02"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\"\r\n            .notifyReviewers -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CR02 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Consent Framework - Admin Consent Request",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **policies/adminConsentRequestPolicy**\r\n",
        "TestDescription": "Specifies whether reviewers will receive notifications\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\r\n.notifyReviewers -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/adminConsentRequestPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [adminConsentRequestPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/adminconsentrequestpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CR03: Consent Framework - Admin Consent Request - Reviewers will receive email notifications when admin consent requests are about to expire.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CR03",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CR03"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\"\r\n            .remindersEnabled -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CR03 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Consent Framework - Admin Consent Request",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'true'** for **policies/adminConsentRequestPolicy**\r\n",
        "TestDescription": "Specifies whether reviewers will receive reminder emails\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\r\n.remindersEnabled -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/adminConsentRequestPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [adminConsentRequestPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/adminconsentrequestpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CR04: Consent Framework - Admin Consent Request - Consent request duration (days).",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CR04",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CR04"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\"\r\n            .requestDurationInDays -le '30'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CR04 | Should -BeLessOrEqual '30'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Consent Framework - Admin Consent Request",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is less than or equal to **'30'** for **policies/adminConsentRequestPolicy**\r\n",
        "TestDescription": "Specifies the duration the request is active before it automatically expires if no decision is applied\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/adminConsentRequestPolicy\r\n.requestDurationInDays -le '30'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/adminConsentRequestPolicy&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [adminConsentRequestPolicy resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/adminconsentrequestpolicy)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.PR01: Default Settings - Password Rule Settings - Password Protection - Mode.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.PR01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.PR01"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'BannedPasswordCheckOnPremisesMode' | select-object -expand value -eq 'Enforce'\r\n        #>\r\n        Test-MtEidscaControl -CheckId PR01 | Should -Be 'Enforce'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 7\nActual length:   5\nStrings differ at index 0.\nExpected: 'Enforce'\nBut was:  'Audit'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, but they were different.\nExpected length: 7\nActual length:   5\nStrings differ at index 0.\nExpected: 'Enforce'\nBut was:  'Audit'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "122",
            "LineText": "        Test-MtEidscaControl -CheckId PR01 | Should -Be 'Enforce'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 122\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Settings - Password Rule Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **Audit**.\n\nThe recommended value is **'Enforce'** for **settings**\r\n",
        "TestDescription": "If set to Enforce, users will be prevented from setting banned passwords and the attempt will be logged. If set to Audit, the attempt will only be logged.\r\n\r\n[Microsoft Entra Password Protection - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad-on-premises)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'BannedPasswordCheckOnPremisesMode' | select-object -expand value -eq 'Enforce'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/PasswordProtection)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.PR02: Default Settings - Password Rule Settings - Password Protection - Enable password protection on Windows Server Active Directory.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.PR02",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.PR02"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'EnableBannedPasswordCheckOnPremises' | select-object -expand value -eq 'True'\r\n        #>\r\n        Test-MtEidscaControl -CheckId PR02 | Should -Be 'True'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Password Rule Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'True'** for **settings**\r\n",
        "TestDescription": "If set to Yes, password protection is turned on for Active Directory domain controllers when the appropriate agent is installed.\r\n\r\n[Azure identity & access security best practices - Microsoft Learn](https://learn.microsoft.com/en-us/azure/security/fundamentals/identity-management-best-practices#enable-password-management)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'EnableBannedPasswordCheckOnPremises' | select-object -expand value -eq 'True'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/PasswordProtection)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.PR03: Default Settings - Password Rule Settings - Enforce custom list.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.PR03",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.PR03"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'EnableBannedPasswordCheck' | select-object -expand value -eq 'True'\r\n        #>\r\n        Test-MtEidscaControl -CheckId PR03 | Should -Be 'True'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Password Rule Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'True'** for **settings**\r\n",
        "TestDescription": "When enabled, the words in the list below are used in the banned password system to prevent easy-to-guess passwords.\r\n\r\n[Password protection in Microsoft Entra ID - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-password-ban-bad#global-banned-password-list)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'EnableBannedPasswordCheck' | select-object -expand value -eq 'True'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/PasswordProtection)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.PR05: Default Settings - Password Rule Settings - Smart Lockout - Lockout duration in seconds.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.PR05",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.PR05"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'LockoutDurationInSeconds' | select-object -expand value -ge '60'\r\n        #>\r\n        Test-MtEidscaControl -CheckId PR05 | Should -BeGreaterOrEqual '60'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Password Rule Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is greater than or equal to **'60'** for **settings**\r\n",
        "TestDescription": "The minimum length in seconds of each lockout. If an account locks repeatedly, this duration increases.\r\n\r\n[Prevent attacks using smart lockout - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-password-smart-lockout)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'LockoutDurationInSeconds' | select-object -expand value -ge '60'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/PasswordProtection)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.PR06: Default Settings - Password Rule Settings - Smart Lockout - Lockout threshold.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.PR06",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.PR06"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'LockoutThreshold' | select-object -expand value -eq '10'\r\n        #>\r\n        Test-MtEidscaControl -CheckId PR06 | Should -Be '10'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected '10', but got 6.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected '10', but got 6.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
            "Line": "158",
            "LineText": "        Test-MtEidscaControl -CheckId PR06 | Should -Be '10'",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 158\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Settings - Password Rule Settings",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured as **6**.\n\nThe recommended value is **'10'** for **settings**\r\n",
        "TestDescription": "How many failed sign-ins are allowed on an account before its first lockout. If the first sign-in after a lockout also fails, the account locks out again.\r\n\r\n[Prevent attacks using smart lockout - Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-password-smart-lockout)\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'LockoutThreshold' | select-object -expand value -eq '10'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/PasswordProtection)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.ST08: Default Settings - Classification and M365 Groups - M365 groups - Allow Guests to become Group Owner.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.ST08",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.ST08"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'AllowGuestsToBeGroupOwner' | select-object -expand value -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId ST08 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Classification and M365 Groups",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'false'** for **settings**\r\n",
        "TestDescription": "Indicating whether or not a guest user can be an owner of groups, manage\r\n\r\nCISA SCuBA 2.18: Guest users SHOULD have limited access to Azure AD directory objects\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'AllowGuestsToBeGroupOwner' | select-object -expand value -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.ST09: Default Settings - Classification and M365 Groups - M365 groups - Allow Guests to have access to groups content.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.ST09",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.ST09"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'AllowGuestsToAccessGroups' | select-object -expand value -eq 'True'\r\n        #>\r\n        Test-MtEidscaControl -CheckId ST09 | Should -Be 'True'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Default Settings - Classification and M365 Groups",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. The configuration in your tenant and recommended value is **'True'** for **settings**\r\n",
        "TestDescription": "Indicating whether or not a guest user can have access to Microsoft 365 groups content. This setting does not require an Azure Active Directory Premium P1 license.\r\n\r\nManages if guest accounts can access resources through Microsoft 365 Group membership and could break collaboration if you disable it.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'AllowGuestsToAccessGroups' | select-object -expand value -eq 'True'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.1.1: Legacy authentication SHALL be blocked.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.1.1",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaBlockLegacyAuth\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled policy for all users blocking legacy auth access shall exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockLegacyAuth.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant has one or more policies that block legacy authentication:\n\n  - [02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/7b9eb412-5671-46c9-bafd-ba6948b624a8)\n\r\n",
        "TestDescription": "Legacy authentication SHALL be blocked.\r\n\r\nRationale: The security risk of allowing legacy authentication protocols is they do not support MFA. Blocking legacy protocols reduces the impact of user credential theft.\r\n\r\n#### Remediation action:\r\n\r\nFollow the guide below to create a conditional access policy that blocks legacy authentication.\r\n\r\n- [Block legacy authentication - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-block-legacy#create-a-conditional-access-policy)\r\n\r\n#### Related links\r\n\r\n- [CISA Legacy Authentication - MS.AAD.1.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#1-legacy-authentication)\r\n- [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L47)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.2.1: Users detected as high risk SHALL be blocked.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.2.1",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaBlockHighRiskUser\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled policy for all users blocking high risk users shall exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockHighRiskUsers.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because an enabled policy for all users blocking high risk users shall exist., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because an enabled policy for all users blocking high risk users shall exist., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockHighRiskUsers.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"an enabled policy for all users blocking high risk users shall exist.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockHighRiskUsers.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have any conditional access policies that block high risk users.\r\n",
        "TestDescription": "Users detected as high risk SHALL be blocked.\r\n\r\nRationale: Blocking high-risk users may prevent compromised accounts from accessing the tenant. This prevents compromised accounts from accessing the tenant.\r\n\r\n#### Remediation action:\r\n\r\nCreate a conditional access policy blocking users categorized as high risk by the Identity Protection service. Configure the following policy settings in the new conditional access policy as per the values below:\r\n\r\n* Users > Include > **All users**\r\n* Target resources > Cloud apps > **All cloud apps**\r\n* Conditions > User risk > **High**\r\n* Access controls > Grant > **Block Access**\r\n\r\nNote: While CISA recommends blocking, the [Microsoft recommendation](https://learn.microsoft.com/entra/id-protection/howto-identity-protection-configure-risk-policies#microsofts-recommendation) is to require multi-factor authentication for high-risk users.\r\n\r\n#### Related links\r\n\r\n* [CISA Risk Based Policies - MS.AAD.2.1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad21v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L85)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.2.2: A notification SHOULD be sent to the administrator when high-risk users are detected.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.2.2",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaNotifyHighRisk\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled is a recipient of risky user login notifications.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaNotifyHighRiskUsers.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has one or more recipients for notifications of risky user logins:\n\n  - [Almighty Admin](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/~/UsersAtRiskAlerts/fromNav/Identity)\n  - [Philippe De Ladurantaye](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/~/UsersAtRiskAlerts/fromNav/Identity)\n  - [Antoine Durocher](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/~/UsersAtRiskAlerts/fromNav/Identity)\n  - [Gabriel Tessier](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/~/UsersAtRiskAlerts/fromNav/Identity)\n  - [Marc-Antoine Hébert](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/~/UsersAtRiskAlerts/fromNav/Identity)\n\r\n",
        "TestDescription": "A notification SHOULD be sent to the administrator when high-risk users are detected.\r\n\r\nRationale: Notification enables the admin to monitor the event and remediate the risk. This helps the organization proactively respond to cyber intrusions as they occur.\r\n\r\n#### Remediation action:\r\n\r\nFollow the guide below to configure Entra ID Protection to send a regularly monitored security mailbox email notification when user accounts are determined to be high risk.\r\n\r\n- [Configure Entra Identity Protection Notifications - Microsoft Learn](https://learn.microsoft.com/entra/id-protection/howto-identity-protection-configure-notifications#configure-users-at-risk-detected-alerts)\r\n\r\n#### Related links\r\n\r\n- [CISA Risk Based Policies - MS.AAD.2.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad22v1)\r\n- [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L122)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.2.3: Sign-ins detected as high risk SHALL be blocked.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.2.3",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaBlockHighRiskSignIn\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled policy for all users blocking high risk sign-ins shall exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockHighRiskSignIns.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because an enabled policy for all users blocking high risk sign-ins shall exist., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because an enabled policy for all users blocking high risk sign-ins shall exist., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockHighRiskSignIns.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"an enabled policy for all users blocking high risk sign-ins shall exist.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaBlockHighRiskSignIns.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have any conditional access policies that block high risk sign-ins.\r\n",
        "TestDescription": "Sign-ins detected as high risk SHALL be blocked.\r\n\r\nRationale: Blocking high-risk sign ins may prevent compromised sign-ins from accessing the tenant. This prevents compromised sign-ins from accessing the tenant.\r\n\r\n#### Remediation action:\r\n\r\nCreate a Conditional Access policy blocking sign-ins determined high risk by the Identity Protection service. Configure the following policy settings in the new Conditional Access policy as per the values below:\r\n\r\n* Users > Include > **All users**\r\n* Target resources > Cloud apps > **All cloud apps**\r\n* Conditions > Sign-in risk > **High**\r\n* Access controls > Grant > **Block Access**\r\n\r\nNote: While CISA recommends blocking, the [Microsoft recommendation](https://learn.microsoft.com/entra/id-protection/howto-identity-protection-configure-risk-policies#microsofts-recommendation) is to require multi-factor authentication for high-risk sign-ins.\r\n\r\n#### Related links\r\n\r\n* [CISA Risk Based Policies - MS.AAD.2.3](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad23v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L138)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.1: Phishing-resistant MFA SHALL be enforced for all users.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.1",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaPhishResistant\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled conditional access policy requires phishing-resistant MFA for all apps.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPhishResistant.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because an enabled conditional access policy requires phishing-resistant MFA for all apps., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because an enabled conditional access policy requires phishing-resistant MFA for all apps., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPhishResistant.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"an enabled conditional access policy requires phishing-resistant MFA for all apps.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPhishResistant.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have any conditional access policies that require Phishing Resistant Authentication Strengths.\r\n",
        "TestDescription": "Phishing-resistant MFA SHALL be enforced for all users.\r\n\r\nRationale: Weaker forms of MFA do not protect against sophisticated phishing attacks. By enforcing methods resistant to phishing, those risks are minimized.\r\n\r\n#### Remediation action:\r\n\r\nCreate a conditional access policy enforcing phishing-resistant MFA for all users. Configure the following policy settings in the new conditional access policy, per the values below:\r\n\r\n* Users > Include > **All users**\r\n* Target resources > Cloud apps > **All cloud apps**\r\n* Access controls > Grant > Grant Access > Require authentication strength > **Phishing-resistant MFA**\r\n\r\n#### Related links\r\n\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad31v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L181)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.2: If phishing-resistant MFA has not been enforced, an alternative MFA method SHALL be enforced for all users.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.2",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaMfa\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled conditional access policy requires MFA for all apps.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaMfa.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has one or more policies that require MFA:\n\n  - [12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/fd319abe-075c-4e98-b190-4954e8784d14)\n  - [14_REQUIRE_PASSWORD-RESET_HIGH-USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/69d49cd7-b663-4d66-bd29-3784695d9524)\n  - [01_REQUIRE_MFA_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/68d414a3-c27a-46e5-9391-3d6344e891bd)\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6)\n\r\n",
        "TestDescription": "If phishing-resistant MFA has not been enforced, an alternative MFA method SHALL be enforced for all users.\r\n\r\nRationale: This is a stopgap security policy to help protect the tenant if phishing-resistant MFA has not been enforced. This policy requires MFA enforcement, thus reducing single-form authentication risk.\r\n\r\n#### Remediation action:\r\n\r\nIf phishing-resistant MFA has not been enforced for all users yet, create a conditional access policy that enforces MFA but does not dictate MFA method. Configure the following policy settings in the new conditional access policy, per the values below:\r\n\r\n* Users > Include > **All users**\r\n* Target resources > Cloud apps > **All cloud apps**\r\n* Access controls > Grant > Grant Access > **Require multifactor authentication**\r\n\r\n#### Related links\r\n\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad32v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L214)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.3: If phishing-resistant MFA has not been enforced and Microsoft Authenticator is enabled, it SHALL be configured to show login context information.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.3",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaAuthenticatorContext\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"Microsoft Authenticator is configured to show login context information.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAuthenticatorContext.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because Microsoft Authenticator is configured to show login context information., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because Microsoft Authenticator is configured to show login context information., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAuthenticatorContext.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"Microsoft Authenticator is configured to show login context information.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAuthenticatorContext.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have the [Authentication Methods](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods/fromNav/Identity) policy for Microsoft Authenticator set appropriately or migration to Authentication Methods is not complete.\n\n[Authentication Methods](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods/fromNav/Identity) Migration Complete: ❌ Fail\r\n",
        "TestDescription": "If phishing-resistant MFA has not been enforced and Microsoft Authenticator is enabled, it SHALL be configured to show login context information.\r\n\r\nRationale: This stopgap security policy helps protect the tenant when phishing-resistant MFA has not been enforced and Microsoft Authenticator is used. This policy helps improve the security of Microsoft Authenticator by showing user context information, which helps reduce MFA phishing compromises.\r\n\r\n#### Remediation action:\r\n\r\nIf phishing-resistant MFA has not been deployed yet and Microsoft Authenticator is in use, configure Authenticator to display context information to users when they log in.\r\n\r\n1. In Azure Active Directory, click Security > Authentication methods > **Microsoft Authenticator**.\r\n2. Click the **Configure tab**.\r\n3. For Allow use of Microsoft Authenticator OTP select **No**.\r\n4. Under Show application name in push and passwordless notifications select Status > **Enabled** and Target > Include > **All users**.\r\n5. Under Show geographic location in push and passwordless notifications select Status > **Enabled** and Target > Include > **All users**.\r\n6. Select **Save**.\r\n\r\n#### Related links\r\n\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad33v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L254)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.4: The Authentication Methods Manage Migration feature SHALL be set to Migration Complete.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.4",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaMethodsMigration\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the migration to Authentication Methods is complete.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaMethodsMigration.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because the migration to Authentication Methods is complete., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because the migration to Authentication Methods is complete., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaMethodsMigration.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"the migration to Authentication Methods is complete.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaMethodsMigration.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant has not completed the migration to Authentication Methods.\r\n",
        "TestDescription": "The Authentication Methods Manage Migration feature SHALL be set to Migration Complete.\r\n\r\nRationale: To disable the legacy authentication methods screen for the tenant, configure the Manage Migration feature to Migration Complete. The MFA and Self-Service Password Reset (SSPR) authentication methods are both managed from a central admin page, thereby reducing administrative complexity and potential security misconfigurations.\r\n\r\n#### Remediation action:\r\n\r\nIf phishing-resistant MFA has not been enforced for all users yet, create a conditional access policy that enforces MFA but does not dictate MFA method. Configure the following policy settings in the new conditional access policy, per the values below:\r\n\r\n1. Go through the process of [migrating from the legacy Azure AD MFA and Self-Service Password Reset (SSPR) administration pages to the new unified Authentication Methods policy page](https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-authentication-methods-manage).\r\n2. Once ready to finish the migration, [set the **Manage Migration** option to **Migration Complete**](https://learn.microsoft.com/en-us/entra/identity/authentication/how-to-authentication-methods-manage#finish-the-migration).\r\n\r\n#### Related links\r\n\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.4v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad34v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L284)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.5: The authentication methods SMS, Voice Call, and Email One-Time Passcode (OTP) SHALL be disabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.5",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaWeakFactor\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"all weak authentication methods are disabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaWeakFactor.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because all weak authentication methods are disabled., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because all weak authentication methods are disabled., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaWeakFactor.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"all weak authentication methods are disabled.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaWeakFactor.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nOne or more weak methods are enabled in your tenant, or migration to Authentication Methods is incomplete.\n\n[Authentication Methods](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods) Migration Complete: ❌ Fail\n\n| Authentication Method | State | Test Result |\n| --- | --- | --- |\n| [Sms](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods) | disabled | ✅ Pass |\n| [Voice](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods) | disabled | ✅ Pass |\n| [Email](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods) | enabled | ❌ Fail |\n\r\n",
        "TestDescription": "The authentication methods SMS, Voice Call, and Email One-Time Passcode (OTP) SHALL be disabled.\r\n\r\nRationale: SMS, voice call, and email OTP are the weakest authenticators. This policy forces users to use stronger MFA methods.\r\n\r\n#### Remediation action:\r\n\r\nIf phishing-resistant MFA has not been deployed yet and Microsoft Authenticator is in use, configure Authenticator to display context information to users when they log in.\r\n\r\n1. In **Azure Active Directory**, click **Security** > **[Authentication methods](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods/fromNav/Identity)**\r\n2. Click on the **SMS**, **Voice Call**, and **Email OTP** authentication methods and disable each of them. Their statuses should be **Enabled** > **No** on the **Authentication methods** > **Policies** page.\r\n\r\n#### Related links\r\n\r\n* [Entra admin portal - Authentication methods](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/AdminAuthMethods/fromNav/Identity)\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.5v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad35v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L307)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.6: Phishing-resistant MFA SHALL be required for highly privileged roles.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.6",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaPrivilegedPhishResistant\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"an enabled conditional access policy for highly privileged roles should require phishing resistant MFA.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPrivilegedPhishResistant.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because an enabled conditional access policy for highly privileged roles should require phishing resistant MFA., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because an enabled conditional access policy for highly privileged roles should require phishing resistant MFA., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPrivilegedPhishResistant.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"an enabled conditional access policy for highly privileged roles should require phishing resistant MFA.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPrivilegedPhishResistant.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have any conditional access policies that require phishing resistant MFA for highly privileged users.\r\n",
        "TestDescription": "Phishing-resistant MFA SHALL be required for highly privileged roles.\r\n\r\nRationale: This is a backup security policy to help protect privileged access to the tenant if the conditional access policy, which requires MFA for all users, is disabled or misconfigured.\r\n\r\n#### Remediation action:\r\n\r\nCreate a conditional access policy enforcing phishing-resistant MFA for highly privileged roles. Configure the following policy settings in the new conditional access policy, per the values below:\r\n\r\n1. In **Entra** under **Protection** and **Conditional Access**, select **[Policies](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies/fromNav/)**.\r\n2. Click on **New policy**\r\n3. Under **New Conditional Access policy**, configure the following policy settings in the new conditional access policy, per the values below:\r\n    * Users > Include > Select users and groups > Directory roles > select each of the roles listed in the **[Highly Privileged Roles](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#highly-privileged-roles)** listed.\r\n    * Target resources > Cloud apps > **All cloud apps**\r\n    * Access controls > Grant > Grant Access > Require authentication strength > **Phishing-resistant MFA**\r\n4. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Conditional Access | Policies](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies/fromNav/)\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.6v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad36v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L354)\r\n* [CISA ScubaGear Highly Privileged Roles](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#highly-privileged-roles)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.7: Managed devices SHOULD be required for authentication.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.7",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaManagedDevice\r\n\r\n        if ($null -ne $result) {\r\n            if($result){\r\n                $result | Should -Be $true -Because \"a policy requires compliant or domain joined devices.\"\r\n            }else{\r\n                Test-MtCisaManagedDevice -SkipHybridJoinCheck | Should -Be $true -Because \"a policy requires compliant devices.\"\r\n            }\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaManagedDevice.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because a policy requires compliant devices., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because a policy requires compliant devices., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaManagedDevice.Tests.ps1",
            "Line": "9",
            "LineText": "                Test-MtCisaManagedDevice -SkipHybridJoinCheck | Should -Be $true -Because \"a policy requires compliant devices.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaManagedDevice.Tests.ps1: line 9\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have any conditional access policies that require managed devices.\r\n",
        "TestDescription": "Managed devices SHOULD be required for authentication.\r\n\r\nRationale: The security risk of an adversary authenticating to the tenant from their own device is reduced by requiring a managed device to authenticate. Managed devices are under the provisioning and control of the agency. [OMB-22-09](https://www.whitehouse.gov/wp-content/uploads/2022/01/M-22-09.pdf) states, \"When authorizing users to access resources, agencies must consider at least one device-level signal alongside identity information about the authenticated user.\"\r\n\r\n#### Remediation action:\r\n\r\nCreate a conditional access policy requiring a user's device to be either Microsoft Entra hybrid joined or compliant during authentication. Configure the following policy settings in the new conditional access policy, per the values below:\r\n\r\n1. In **Entra** under **Protection** and **Conditional Access**, select **[Policies](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies/fromNav/)**.\r\n2. Click on **New policy**\r\n3. Under **New Conditional Access policy**, configure the following policy settings in the new conditional access policy, per the values below:\r\n    * Users > Include > **All users**\r\n    * Target resources > Cloud apps > **All cloud apps**\r\n    * Access controls > Grant > Grant Access > **Require device to be marked as compliant** and **Require Microsoft Entra hybrid joined device** > For multiple controls > **Require one of the selected controls**\r\n4. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Conditional Access | Policies](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies/fromNav/)\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.7v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad37v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L397)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.3.8: Managed Devices SHOULD be required to register MFA.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.3.8",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaManagedDeviceRegistration\r\n\r\n        if ($null -ne $result) {\r\n            if($result){\r\n                $result | Should -Be $true -Because \"a policy requires compliant or domain joined devices for registration.\"\r\n            }else{\r\n                Test-MtCisaManagedDeviceRegistration -SkipHybridJoinCheck | Should -Be $true -Because \"a policy requires compliant devices for registration.\"\r\n            }\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaManagedDeviceRegistration.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because a policy requires compliant devices for registration., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because a policy requires compliant devices for registration., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaManagedDeviceRegistration.Tests.ps1",
            "Line": "9",
            "LineText": "                Test-MtCisaManagedDeviceRegistration -SkipHybridJoinCheck | Should -Be $true -Because \"a policy requires compliant devices for registration.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaManagedDeviceRegistration.Tests.ps1: line 9\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have any conditional access policies that require managed devices for registration.\r\n",
        "TestDescription": "Managed Devices SHOULD be required to register MFA.\r\n\r\nRationale: Reduce risk of an adversary using stolen user credentials and then registering their own MFA device to access the tenant by requiring a managed device provisioned and controlled by the agency to perform registration actions. This prevents the adversary from using their own unmanaged device to perform the registration.\r\n\r\n#### Remediation action:\r\n\r\nCreate a conditional access policy requiring a user to be on a managed device when registering for MFA.\r\n\r\n1. In **Entra** under **Protection** and **Conditional Access**, select **[Policies](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies/fromNav/)**.\r\n2. Click on **New policy**\r\n3. Under **New Conditional Access policy**, configure the following policy settings in the new conditional access policy, per the values below:\r\n    * Users > Include > **All users**\r\n    * Target resources > User actions > **Register security information**\r\n    * Access controls > Grant > Grant Access > **Require device to be marked as compliant** and **Require Microsoft Entra hybrid joined device** > For multiple controls > **Require one of the selected controls**\r\n4. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Conditional Access | Policies](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies/fromNav/)\r\n* [CISA Strong Authentication & Secure Registration - MS.AAD.3.8v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad38v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L431)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.5.1: Only administrators SHALL be allowed to register applications.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.5.1",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaAppRegistration\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"default user authorization policy prevents app creation.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppRegistration.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because default user authorization policy prevents app creation., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because default user authorization policy prevents app creation., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppRegistration.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"default user authorization policy prevents app creation.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppRegistration.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant is configured with **[Users can register applications](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/UserSettings/menuId/UserSettings)** set to **Yes**. The recommended setting is **No**.\r\n",
        "TestDescription": "Only administrators SHALL be allowed to register applications.\r\n\r\nRationale: Application access for the tenant presents a heightened security risk compared to interactive user access because applications are typically not subject to critical security protections, such as MFA policies. Reduce risk of unauthorized users installing malicious applications into the tenant by ensuring that only specific privileged users can register applications.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra**, under **Identity** and **Users**, select **[User settings](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/UserSettings/menuId/UserSettings)**.\r\n2. For **Users can register applications**, select **No**.\r\n3. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - User settings](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/UserSettings/menuId/UserSettings)\r\n* [CISA Application Registration & Consent - MS.AAD.5.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad51v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L542)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.5.2: Only administrators SHALL be allowed to consent to applications.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.5.2",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaAppUserConsent\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"default user authorization policy prevents app consent.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppUserConsent.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because default user authorization policy prevents app consent., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because default user authorization policy prevents app consent., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppUserConsent.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"default user authorization policy prevents app consent.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppUserConsent.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant [allows users to consent for applications](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings). The recommended setting is **Do not allow user consent**.\r\n",
        "TestDescription": "Only administrators SHALL be allowed to consent to applications.\r\n\r\nRationale: Limiting applications consent to only specific privileged users reduces risk of users giving insecure applications access to their data via [consent grant attacks](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/detect-and-remediate-illicit-consent-grants?view=o365-worldwide).\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra** under **Identity** and **Applications**, select **Enterprise applications**.\r\n2. Under **Security**, select **Consent and permissions**.\r\n3. Under **Manage**, select **[User consent settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings)**.\r\n4. Under **User consent for applications**, select **Do not allow user consent**.\r\n5. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Consent and permissions | User consent settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings)\r\n* [CISA Application Registration & Consent - MS.AAD.5.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad52v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L575)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.5.3: An admin consent workflow SHALL be configured for applications.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.5.3",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaAppAdminConsent\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"admin consent policy is configured with reviewers.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppAdminConsent.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant admin consent request policy has at least 1 reviewer.\r\n",
        "TestDescription": "An admin consent workflow SHALL be configured for applications.\r\n\r\nRationale: Configuring an admin consent workflow reduces the risk of the previous policy by setting up a process for users to securely request access to applications necessary for business purposes. Administrators have the opportunity to review the permissions requested by new applications and approve or deny access based on a risk assessment.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra** create a new **Group** that contains admin users responsible for reviewing and adjudicating application consent requests. Group members will be notified when users request consent for new applications.\r\n2. Then in **Entra** under **Identity** and **Applications**, select **Enterprise applications**.\r\n3. Under **Security**, select **Consent and permissions**.\r\n3. Under **Manage**, select **[Admin consent settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)**.\r\n5. Under **Admin consent requests** and **Users can request admin consent to apps they are unable to consent to** select **Yes**.\r\n6. Under **Who can review admin consent requests**, select **+ Add groups** and select the **group** responsible for reviewing and adjudicating app requests **(created in step one above)**.\r\n7. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Consent and permissions | Admin consent settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/AdminConsentSettings)\r\n* [CISA Application Registration & Consent - MS.AAD.5.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad53v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L613)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.5.4: Group owners SHALL NOT be allowed to consent to applications.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.5.4",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaAppGroupOwnerConsent\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"group owner consent is disabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppGroupOwnerConsent.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because group owner consent is disabled., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because group owner consent is disabled., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppGroupOwnerConsent.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"group owner consent is disabled.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAppGroupOwnerConsent.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant allows group owners to consent to applications.\r\n",
        "TestDescription": "Group owners SHALL NOT be allowed to consent to applications.\r\n\r\nRationale: In M365, group owners and team owners can consent to applications accessing data in the tenant. By requiring consent requests to go through an approval workflow, risk of exposure to malicious applications is reduced.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra** under **Identity** and **Applications**, select **Enterprise applications**.\r\n2. Under **Security**, select **Consent and permissions**.\r\n3. Under **Manage**, select **[User consent settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings)**.\r\n4. Under **Group owner consent for apps accessing data**, select **Do not allow group owner consent**.\r\n5. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Consent and permissions | User consent settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings)\r\n* [CISA Application Registration & Consent - MS.AAD.5.4v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad54v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L665)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.6.1: User passwords SHALL NOT expire.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.6.1",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaPasswordExpiration\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"at least 1 domain has an password expiration policy of 100 years or more.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPasswordExpiration.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant password expiration policy is set to never expire.\r\n",
        "TestDescription": "User passwords SHALL NOT expire.\r\n\r\nThe National Institute of Standards and Technology (NIST), OMB, and Microsoft have published guidance indicating mandated periodic password changes make user accounts less secure. For example, OMB-22-09 states, \"Password policies must not require use of special characters or regular rotation.\"\r\n\r\n#### Remediation action:\r\n\r\nConfigure password policies to set passwords to never expire.\r\n1. In **[Microsoft 365 admin center](https://admin.cloud.microsoft/)** under **Settings** and **Org settings**, select the tab **Security & privacy**.\r\n2. Under **[Password expiration policy](https://admin.cloud.microsoft/?#/Settings/SecurityPrivacy/:/Settings/L1/PasswordPolicy)**, set **Set passwords to never expire**.\r\n3. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 admin center - Org settings | Password expiration policy](https://admin.cloud.microsoft/?#/Settings/SecurityPrivacy/:/Settings/L1/PasswordPolicy)\r\n* [Configure the **Password expiration policy** ](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/set-password-expiration-policy?view=o365-worldwide#set-password-expiration-policy)\r\n* [CISA Passwords - MS.AAD.6.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad61v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L723)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.1: A minimum of two users and a maximum of eight users SHALL be provisioned with the Global Administrator role.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.1",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaGlobalAdminCount\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"two or more and eight or fewer Global Administrators exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaGlobalAdminCount.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has two or more and eight or fewer Global Administrators:\n\n  - [Marc-Antoine Hébert](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/344c2ae8-9a84-456c-885e-dcb1c93bfded)\n  - [Gabriel Tessier](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/64f1291a-7b5b-4ca4-877b-ded034e94881)\n  - [The Notorious BGA](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/7a607eec-319a-491f-827a-9ebbb2d37c43)\n  - [Almighty Admin](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/9edf6b7c-8a6a-42ce-abc7-f606038ebb76)\n  - [Antoine Durocher](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/d31557a5-1e17-4077-b53d-dcaf34e6be8f)\n  - [Anthony Thurel](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/dbf3b44e-a607-4c4b-a637-7faef6e89aac)\n  - [Philippe De Ladurantaye](https://entra.microsoft.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/ea7b5440-5b2a-453a-8b9d-52af8d1ccb6d)\n\r\n",
        "TestDescription": "A minimum of two users and a maximum of eight users SHALL be provisioned with the Global Administrator role.\r\n\r\n**Rationale:** The Global Administrator role provides unfettered access to the tenant (Azure and Microsoft 365). Limiting the number of users with this level of access makes tenant compromise more challenging. Microsoft recommends fewer than five users in the Global Administrator role. However, additional user accounts, up to eight, may be necessary to support emergency access and some operational scenarios.\r\n\r\n#### Remediation action:\r\n\r\nWhen counting the number of users assigned to the Global Administrator role, **count each user only once**.\r\n\r\n1. In **Entra** under **Roles & adminis** and **[All roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles)**, search for **Global Administrator** and click on it to go to the role and see who is assiged. Count users that are assigned directly to the role and users assigned via group membership.\r\n\r\n    If you have **Entra ID PIM**, count both the **Eligible assignments** and **Active assignments**.\r\n\r\n    If any of the groups assigned to Global Administrator are enrolled in **PIM for Groups**, also count the number of group members from the PIM for Groups portal **Eligible** assignments.\r\n\r\n2. Validate that there are a total of two to eight users assigned to the Global Administrator role.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Roles and administrators | All roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles)\r\n* [CISA 7.1 Highly Privileged User Access - MS.AAD.7.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad71v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L761)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.2: Privileged users SHALL be provisioned with finer-grained roles instead of Global Administrator.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.2",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaGlobalAdminRatio\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"more granular role assignments exist than global admin assignments.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaGlobalAdminRatio.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because more granular role assignments exist than global admin assignments., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because more granular role assignments exist than global admin assignments., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaGlobalAdminRatio.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"more granular role assignments exist than global admin assignments.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaGlobalAdminRatio.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have enough granular [role assignments](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles).\n\nCurrent Ratio: 3.5 = 7 / 2\n\nRatio >= 1 - True\r\n",
        "TestDescription": "Privileged users SHALL be provisioned with finer-grained roles instead of Global Administrator.\r\n\r\nRationale: Many privileged administrative users do not need unfettered access to the tenant to perform their duties. By assigning them to roles based on least privilege, the risks associated with having their accounts compromised are reduced.\r\n\r\n#### Remediation action:\r\n\r\nThis policy is based on the ratio below:\r\n\r\n`X = (Number of users assigned to the Global Administrator role) / (Number of users assigned to other highly privileged roles)`\r\n\r\n1. Follow the instructions for policy MS.AAD.7.1v1 above to get a count of users assigned to the Global Administrator role.\r\n2. Follow the instructions for policy MS.AAD.7.1v1 above but get a count of users assigned to the other highly privileged roles (not Global Administrator). If a user is assigned to both Global Administrator and other roles, only count that user for the Global Administrator assignment.\r\n3. Divide the value from step 2 from the value from step 1 to calculate X. If X is less than or equal to 1 then the tenant is compliant with the policy.\r\n\r\n#### Related links\r\n\r\n* [CISA 7.2 Highly Privileged User Access - MS.AAD.7.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad72v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L792)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.3: Privileged users SHALL be provisioned cloud-only accounts separate from an on-premises directory or other federated identity providers.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.3",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaCloudGlobalAdmin\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"no hybrid Global Administrators exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaCloudGlobalAdmin.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has no hybrid Global Administrators.\r\n",
        "TestDescription": "Privileged users SHALL be provisioned cloud-only accounts separate from an on-premises directory or other federated identity providers.\r\n\r\nRationale: Many privileged administrative users do not need unfettered access to the tenant to perform their duties. By assigning them to roles based on least privilege, the risks associated with having their accounts compromised are reduced.\r\n\r\n#### Remediation action:\r\n\r\n1. Perform the steps below for each [highly privileged role](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles).\r\n2. Review the users listed that have an **OnPremisesImmutableId** and have **OnPremisesSyncEnabled** set.\r\n3. Create a cloud only user account for that individual and remove their hybrid identity from privileged roles.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Roles and administrators | All roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles)\r\n* [CISA 7.3 Highly Privileged User Access - MS.AAD.7.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad73v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L833)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.4: Permanent active role assignments SHALL NOT be allowed for highly privileged roles.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.4",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaPermanentRoleAssignment\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"no permanently active privileged role assignments exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPermanentRoleAssignment.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because no permanently active privileged role assignments exist., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because no permanently active privileged role assignments exist., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPermanentRoleAssignment.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"no permanently active privileged role assignments exist.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaPermanentRoleAssignment.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant has active assignments without expiration to privileged roles.\r\n",
        "TestDescription": "Permanent active role assignments SHALL NOT be allowed for highly privileged roles.\r\n\r\nRationale: Instead of giving users permanent assignments to privileged roles, provisioning access just in time lessens exposure if those accounts become compromised. In Azure AD PIM or an alternative PAM system, just in time access can be provisioned by assigning users to roles as eligible instead of perpetually active.\r\n\r\nNote: Exceptions to this policy are:\r\n* **Emergency access** accounts that need **perpetual access** to the tenant in the rare event of system degradation or other scenarios.\r\n* Some types of **service accounts** that require a user account with privileged roles; since these accounts are used by software programs, they **cannot** perform role activation.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **Show more** and **Roles & adminis** and then **[All roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles)**.\r\n\r\n    Perform the steps below for each highly privileged role. We reference the Global Administrator role as an example.\r\n\r\n2. Select the **Global administrator** role.\r\n3. Under **Manage**, select **Assignments** and click the **Active assignments** tab.\r\n4. Verify there are no users or groups with a value of **Permanent** in the **End time** column. If there are any, recreate those assignments to have an expiration date using Entra ID PIM or an alternative PAM system. If a group is identified and it is enrolled in PIM for Groups, see the exception cases below for details.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Roles and administrators | All roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles)\r\n* [CISA 7.4 Highly Privileged User Access - MS.AAD.7.4v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad74v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L856)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.5: Provisioning users to highly privileged roles SHALL NOT occur outside of a PAM system.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.5",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaUnmanagedRoleAssignment\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"no unmanaged active role assignments exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaUnmanagedRoleAssignments.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant has no unmanaged active role assignments.\r\n",
        "TestDescription": "Provisioning users to highly privileged roles SHALL NOT occur outside of a PAM system.\r\n\r\nRationale: Provisioning users to privileged roles within a PAM system enables enforcement of numerous privileged access policies and monitoring. If privileged users are assigned directly to roles in the M365 admin center or via PowerShell outside of the context of a PAM system, a significant set of critical security capabilities are bypassed.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **Show more** > **Roles & admins** and then select **[All roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles)**.\r\n\r\n    Perform the steps below for each highly privileged role. We reference the **Global Administrator** role as an example.\r\n\r\n2. Select the **Global administrator** role.\r\n3. Under **Manage**, select **Assignments** and click the **Active assignments** tab.\r\n4. For each user or group listed, examine the value in the Start time column. If it contains a value of -, this indicates the respective user/group was assigned to that role outside of Entra ID PIM. If the role was assigned outside of Entra ID PIM, delete the assignment and recreate it using Entra ID PIM.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Roles and administrators | All roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)\r\n* [CISA 7.5 Highly Privileged User Access - MS.AAD.7.5v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad75v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L907)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.6: Activation of the Global Administrator role SHALL require approval.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.6",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaRequireActivationApproval\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the Global Administrator role requires approval for activation.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaRequireActivationApproval.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because the Global Administrator role requires approval for activation., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because the Global Administrator role requires approval for activation., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaRequireActivationApproval.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"the Global Administrator role requires approval for activation.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaRequireActivationApproval.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant has active assignments without a start date.\r\n",
        "TestDescription": "Activation of the Global Administrator role SHALL require approval.\r\n\r\nRationale: Requiring approval for a user to activate Global Administrator, which provides unfettered access, makes it more challenging for an attacker to compromise the tenant with stolen credentials and it provides visibility of activities indicating a compromise is taking place.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **Identity governance** and **Privileged Identity Management**.\r\n2. Under **Manage**, select **Microsoft Entra roles**.\r\n3. Under **Manage**, select **[Roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)**.\r\n4. Select the **Global Administrator** role in the list.\r\n5. Click **Settings**.\r\n6. Click **Edit**.\r\n7. Select the **Require approval to activate** option.\r\n8. Click **Update**.\r\n9. Review the list of groups that are actively assigned to the **Global Administrator** role. If any of the groups are enrolled in PIM for Groups, then also apply the same configurations under step 2 above to each PIM group's Member settings.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Privileged Identity Management | Microsoft Entra roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)\r\n* [CISA 7.6 Highly Privileged User Access - MS.AAD.7.6v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad76v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L938)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.7: Eligible and Active highly privileged role assignments SHALL trigger an alert.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.7",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaAssignmentNotification\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"highly privileged roles are set to notify on assignment.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAssignmentNotification.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because highly privileged roles are set to notify on assignment., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because highly privileged roles are set to notify on assignment., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAssignmentNotification.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"highly privileged roles are set to notify on assignment.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaAssignmentNotification.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant has highly privileged roles without notifications.\r\n",
        "TestDescription": "Eligible and Active highly privileged role assignments SHALL trigger an alert.\r\n\r\nRationale: Closely monitor assignment of the highest privileged roles for signs of compromise. Send assignment alerts to enable the security monitoring team to detect compromise attempts.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **Identity governance** and **Privileged Identity Management**.\r\n2. Under **Manage**, select **Microsoft Entra roles**.\r\n3. Under **Manage**, select **[Roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)**.\r\n\r\n    Perform the steps below for each highly privileged role. We reference the Global Administrator role as an example.\r\n\r\n4. Click the **Global Administrator** role.\r\n5. Click **Settings** and then click **Edit**.\r\n6. Click the **Notifications** tab.\r\n7. Under **Send notifications when members are assigned as eligible to this role**, in the **Role assignment alert** > **Additional recipients** textbox, enter the email address of the security monitoring mailbox configured to receive privileged role assignment alerts.\r\n8. Under **Send notifications when members are assigned as active to this role**, in the **Role assignment alert** > **Additional recipients** textbox, enter the email address of the security monitoring mailbox configured to receive privileged role assignment alerts.\r\n9. Click **Update**.\r\n10. For each of the highly privileged roles, if they have any PIM groups actively assigned to them, then also apply the same configurations per the steps above to each PIM group's **Member** settings.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Privileged Identity Management | Microsoft Entra roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)\r\n* [CISA 7.7 Highly Privileged User Access - MS.AAD.7.7v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad77v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L974)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.8: User activation of the Global Administrator role SHALL trigger an alert.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.8",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaActivationNotification -GlobalAdminOnly\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"notifications are set for activation of the Global Admin role.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaActivationNotificationGlobalAdmin.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because notifications are set for activation of the Global Admin role., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because notifications are set for activation of the Global Admin role., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaActivationNotificationGlobalAdmin.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"notifications are set for activation of the Global Admin role.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaActivationNotificationGlobalAdmin.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have notifications on [role activations](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles).\n\n| Role Name | Result |\n| --- | --- |\n| Global Administrator | ❌ Fail |\n\r\n",
        "TestDescription": "User activation of the Global Administrator role SHALL trigger an alert.\r\n\r\nRationale: Closely monitor activation of the Global Administrator role for signs of compromise. Send activation alerts to enable the security monitoring team to detect compromise attempts.\r\n\r\nUser activation of other highly privileged roles SHOULD trigger an alert.\r\n\r\nRationale: Closely monitor activation of high-risk roles for signs of compromise. Send activation alerts to enable the security monitoring team to detect compromise attempts. In some environments, activating privileged roles can generate a significant number of alerts.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **Identity governance** and **Privileged Identity Management**.\r\n2. Under **Manage**, select **Microsoft Entra roles**.\r\n3. Under **Manage**, select **[Roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)**.\r\n4. Search and click the **Global Administrator** role.\r\n\r\n    For each of the highly privileged roles (other than Global Administrator), follow the same steps but enter a security monitoring mailbox different from the one used to monitor Global Administrator activations.\r\n\r\n5. Click **Settings** and then click **Edit**.\r\n6. Click the **Notifications** tab.\r\n7. Under **Send notifications when eligible members activate this role**, in the **Role activation alert** > **Additional recipients** textbox, enter the email address of the security monitoring mailbox configured to receive role activation alerts.\r\n8. Click **Update**.\r\n9. If the role has any PIM groups actively assigned to it, then also apply the same configurations per the steps above to each PIM group's **Member** settings.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Privileged Identity Management | Microsoft Entra roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)\r\n* [CISA 7.8 Highly Privileged User Access - MS.AAD.7.8v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad78v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1022)\r\n* [CISA 7.9 Highly Privileged User Access - MS.AAD.7.9v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad78v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1057)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.7.9: User activation of other highly privileged roles SHOULD trigger an alert.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.9",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaActivationNotification\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"notifications are set for activation of highly privileged roles.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaActivationNotificationOther.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because notifications are set for activation of highly privileged roles., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because notifications are set for activation of highly privileged roles., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaActivationNotificationOther.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"notifications are set for activation of highly privileged roles.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaActivationNotificationOther.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not have notifications on [role activations](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles).\n\n| Role Name | Result |\n| --- | --- |\n| User Administrator | ❌ Fail |\n| Exchange Administrator | ❌ Fail |\n| SharePoint Administrator | ❌ Fail |\n| Application Administrator | ❌ Fail |\n| Privileged Role Administrator | ❌ Fail |\n| Cloud Application Administrator | ❌ Fail |\n| Hybrid Identity Administrator | ❌ Fail |\n\r\n",
        "TestDescription": "User activation of the Global Administrator role SHALL trigger an alert.\r\n\r\nRationale: Closely monitor activation of the Global Administrator role for signs of compromise. Send activation alerts to enable the security monitoring team to detect compromise attempts.\r\n\r\nUser activation of other highly privileged roles SHOULD trigger an alert.\r\n\r\nRationale: Closely monitor activation of high-risk roles for signs of compromise. Send activation alerts to enable the security monitoring team to detect compromise attempts. In some environments, activating privileged roles can generate a significant number of alerts.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **Identity governance** and **Privileged Identity Management**.\r\n2. Under **Manage**, select **Microsoft Entra roles**.\r\n3. Under **Manage**, select **[Roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)**.\r\n4. Search and click the **Global Administrator** role.\r\n\r\n    For each of the highly privileged roles (other than Global Administrator), follow the same steps but enter a security monitoring mailbox different from the one used to monitor Global Administrator activations.\r\n\r\n5. Click **Settings** and then click **Edit**.\r\n6. Click the **Notifications** tab.\r\n7. Under **Send notifications when eligible members activate this role**, in the **Role activation alert** > **Additional recipients** textbox, enter the email address of the security monitoring mailbox configured to receive role activation alerts.\r\n8. Click **Update**.\r\n9. If the role has any PIM groups actively assigned to it, then also apply the same configurations per the steps above to each PIM group's **Member** settings.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - Privileged Identity Management | Microsoft Entra roles](https://entra.microsoft.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles)\r\n* [CISA 7.8 Highly Privileged User Access - MS.AAD.7.8v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad78v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1022)\r\n* [CISA 7.9 Highly Privileged User Access - MS.AAD.7.9v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad78v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1057)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.8.1: Guest users SHOULD have limited or restricted access to Azure AD directory objects.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.8.1",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaGuestUserAccess\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"guest users have appropriate role.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaGuestUserAccess.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Guest user access is restricted to properties and memberships of their own directory objects (most restrictive)\r\n",
        "TestDescription": "Guest users SHOULD have limited or restricted access to Azure AD directory objects.\r\n\r\nRationale: Limiting the amount of object information available to guest users in the tenant, reduces malicious reconnaissance exposure, should a guest account become compromised or be created by an adversary.\r\n\r\n#### Remediation action\r\n\r\n1. In **Entra ID** and **External Identities**, select **[External collaboration settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/CompanyRelationshipsMenuBlade/~/Settings/menuId/Settings)**.\r\n2. Under **Guest user access**, select either **Guest users have limited access to properties and memberships of directory objects** or **Guest user access is restricted to properties and memberships of their own directory objects (most restrictive)**.\r\n3. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - External Identities | External collaboration settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/CompanyRelationshipsMenuBlade/~/Settings/menuId/Settings)\r\n* [CISA Guest User Access - MS.AAD.8.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad81v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1100)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.8.2: Only users with the Guest Inviter role SHOULD be able to invite guest users.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.8.2",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaGuestInvitation\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"guest invitations are restricted to admins.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaGuestInvitation.Tests.ps1",
      "ErrorRecord": [],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nWell done. Your tenant restricts who can invite guests:\n\nallowInvitesFrom : adminsAndGuestInviters\r\n",
        "TestDescription": "Only users with the Guest Inviter role SHOULD be able to invite guest users.\r\n\r\nRationale: By only allowing an authorized group of individuals to invite external users to create accounts in the tenant, an agency can enforce a guest user account approval process, reducing the risk of unauthorized account creation.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra ID** and **External Identities**, select **[External collaboration settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/CompanyRelationshipsMenuBlade/~/Settings/menuId/Settings)**.\r\n2. Under **Guest invite settings**, select **Only users assigned to specific admin roles can invite guest users** or **No one in the organization can invite guest users including admins (most restrictive)**.\r\n\r\n3. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - External Identities | External collaboration settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/CompanyRelationshipsMenuBlade/~/Settings/menuId/Settings)\r\n* [CISA Guest User Access - MS.AAD.8.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad82v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1157)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.8.3: Guest invites SHOULD only be allowed to specific external domains that have been authorized by the agency for legitimate business purposes.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.8.3",
        "CISA",
        "Security",
        "All",
        "Entra ID Free"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $result = Test-MtCisaCrossTenantInboundDefault\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"default inbound cross-tenant access policy is set to block.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaCrossTenantInboundDefault.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because default inbound cross-tenant access policy is set to block., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because default inbound cross-tenant access policy is set to block., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaCrossTenantInboundDefault.Tests.ps1",
            "Line": "6",
            "LineText": "            $result | Should -Be $true -Because \"default inbound cross-tenant access policy is set to block.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaCrossTenantInboundDefault.Tests.ps1: line 6\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant's default cross-tenant inbound access policy is not set to block:\n\n| External Users & Groups | Applications |\n| --- | --- |\n| ❌ Fail | ❌ Fail |\n\r\n",
        "TestDescription": "Guest invites SHOULD only be allowed to specific external domains that have been authorized by the agency for legitimate business purposes.\r\n\r\nRationale: Limiting which domains can be invited to create guest accounts in the tenant helps reduce the risk of users from unauthorized external organizations getting access.\r\n\r\n> ⚠️ WARNING: This test utilizes a technical mechanism that differs from CISA's, though the outcome is the same.\r\n\r\n#### Remediation action:\r\n\r\n1. In **Entra admin center** select **External Identities** and **Cross-tenant access settings**.\r\n2. Under **Default settings**, select [**Edit inbound defaults**](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/InboundAccessSettings.ReactView/isDefault~/true/name//id/).\r\n3. Under **B2B collaboration**, and **External users and groups**, ensure **Access status** is set to **Block access**.\r\n4. Under **B2B collaboration**, and **Applications**, ensure **Access status** is set to **Block access**.\r\n\r\n> This configuration will **only** allow B2B collaboration with other Entra tenants.\r\n\r\n#### Related links\r\n\r\n* [Entra admin center - External Identities | Cross-tenant access settings](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/InboundAccessSettings.ReactView/isDefault~/true/name//id/)\r\n* [CISA 8 Guest User Access - MS.AAD.8.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad83v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L1190)\r\n\r\n"
      }
    },
    {
      "Name": "MS.SHAREPOINT.1.1: External sharing for SharePoint SHALL be limited to Existing guests or Only People in your organization.",
      "HelpUrl": "",
      "Tag": [
        "MS.SHAREPOINT",
        "MS.SHAREPOINT.1.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSharePointOnlineSharing\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"external sharing is limited.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\spo\\Test-MtCisaSpoSharing.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because external sharing is limited., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because external sharing is limited., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\spo\\Test-MtCisaSpoSharing.Tests.ps1",
            "Line": "7",
            "LineText": "            $result | Should -Be $true -Because \"external sharing is limited.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\spo\\Test-MtCisaSpoSharing.Tests.ps1: line 7\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not restrict SharePoint Online sharing.\n\n* externalUserSharingOnly\n",
        "TestDescription": "External sharing for SharePoint SHALL be limited to Existing guests or Only People in your organization.\r\n\r\nRationale: Sharing information outside the organization via SharePoint increases the risk of unauthorized access. By limiting external sharing, administrators decrease the risk of access to information.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to the [SharePoint admin center](https://go.microsoft.com/fwlink/?linkid=2185219).\r\n2. Select Policies > Sharing.\r\n3. Adjust external sharing slider for SharePoint to Existing guests or Only people in your organization.\r\n\r\n> ⚠️ WARNING: This will break existing sharing.\r\n\r\n4. Select Save.\r\n\r\n#### Related links\r\n\r\n* [CISA 1 External Sharing - MS.SHAREPOINT.1.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/sharepoint.md#mssharepoint11v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/SharepointConfig.rego#L68)\r\n\r\n"
      }
    },
    {
      "Name": "MS.SHAREPOINT.1.3: External sharing SHALL be restricted to approved external domains and/or users in approved security groups per interagency collaboration needs.",
      "HelpUrl": "",
      "Tag": [
        "MS.SHAREPOINT",
        "MS.SHAREPOINT.1.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSharePointOnlineSharingAllowedDomain\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"external sharing is limited.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\spo\\Test-MtCisaSpoSharingAllowedDomain.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because external sharing is limited., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because external sharing is limited., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\spo\\Test-MtCisaSpoSharingAllowedDomain.Tests.ps1",
            "Line": "7",
            "LineText": "            $result | Should -Be $true -Because \"external sharing is limited.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\spo\\Test-MtCisaSpoSharingAllowedDomain.Tests.ps1: line 7\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nYour tenant does not restrict SharePoint Online sharing to specific domains.",
        "TestDescription": "External sharing SHALL be restricted to approved external domains and/or users in approved security groups per interagency collaboration needs.\r\n\r\nRationale: By limiting sharing to domains or approved security groups used for interagency collaboration purposes, administrators help prevent sharing with unknown organizations and individuals.\r\n\r\n#### Remediation action:\r\n\r\nThis policy is only applicable if the external sharing slider on the admin page is set to any value other than Only People in your organization.\r\n1. Sign in to the [SharePoint admin center](https://go.microsoft.com/fwlink/?linkid=2185219).\r\n2. Select Policies > Sharing.\r\n3. Expand More external sharing settings.\r\n4. Select Limit external sharing by domain.\r\n5. Select Add domains.\r\n6. Add each approved external domain users are allowed to share files with.\r\n7. Select Manage security groups\r\n8. Add each approved security group. Members of these groups will be allowed to share files externally.\r\n9. Select Save.\r\n\r\n#### Related links\r\n\r\n* [CISA 1 External Sharing - MS.SHAREPOINT.1.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/sharepoint.md#mssharepoint13v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/SharepointConfig.rego#L130)\r\n\r\n"
      }
    },
    {
      "Name": "MT.1001: At least one Conditional Access policy is configured with device compliance.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1001",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1001"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaDeviceComplianceExists | Should -Be $true -Because \"there is no policy which requires device compliances\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These conditional access policies enforce the use of a compliant device :\n\n  - [[SharePoint admin center]Block access from apps on unmanaged devices - 2025/02/25](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/919a76a4-a289-4352-9100-bcaf21938401?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [Enforce MFA to Azure Key Vault - DISABLED](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/97d86c41-a278-46b6-a52d-09100495fb15?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [04_REQUIRE_COMPLIANT-DEVICE_TEST-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/535f8d68-5eae-4f85-82b0-a682ad38a94a?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n",
        "TestDescription": "\r\nIt is recommended to have at least one conditional access policy that enforces the use of a compliant device.\r\n\r\nSee [Require a compliant device, Microsoft Entra hybrid joined device, or MFA - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-compliant-device)"
      }
    },
    {
      "Name": "MT.1003: At least one Conditional Access policy is configured with All Apps.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1003",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1003"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaAllAppsExists -SkipCheckAllUsers | Should -Be $true -Because \"there is no policy scoped to All Apps\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These conditional access policies target all cloud apps:\n\n  - [CAAC - Test](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/e61f2899-56ed-4f2b-8a10-882189e7a992?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/7b9eb412-5671-46c9-bafd-ba6948b624a8?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/fd319abe-075c-4e98-b190-4954e8784d14?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [03_SESSION_DURATION_30-DAYS_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/d4b3ae44-a35f-4096-bcf0-f52db814fdb6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f92ab61f-ba58-45d4-a454-a352f0c8f721?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [01_REQUIRE_MFA_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/68d414a3-c27a-46e5-9391-3d6344e891bd?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [Microsoft-managed: Multifactor authentication for per-user multifactor authentication users](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/95e3da0f-c1ea-49fa-8d8d-398bbc55414c?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [04_REQUIRE_COMPLIANT-DEVICE_TEST-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/535f8d68-5eae-4f85-82b0-a682ad38a94a?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [08_BLOCK_ALL-GUESTS_ALL-APPS_EXCEPT_O365](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/22d7453b-a058-4473-ba85-20e8b9c242ab?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [09_BLOCK_ALL-LOCATIONS_SERVICE-ACCOUNT_EXCEPT_SPECIFIC-IP](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/d97f8d2f-c761-4e11-9eeb-6e6ac3f9d1d6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n",
        "TestDescription": "\r\n  Microsoft recommends creating at least one conditional access policy targetting all cloud apps and ideally all users.\r\n\r\n  See [Plan a Conditional Access deployment - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/plan-conditional-access#apply-conditional-access-policies-to-every-app)"
      }
    },
    {
      "Name": "MT.1004: At least one Conditional Access policy is configured with All Apps and All Users.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1004",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1004"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaAllAppsExists | Should -Be $true -Because \"there is no policy scoped to All Apps and All Users\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These conditional access policies target all cloud apps and all users:\n\n  - [02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/7b9eb412-5671-46c9-bafd-ba6948b624a8?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/fd319abe-075c-4e98-b190-4954e8784d14?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [03_SESSION_DURATION_30-DAYS_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/d4b3ae44-a35f-4096-bcf0-f52db814fdb6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f92ab61f-ba58-45d4-a454-a352f0c8f721?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [01_REQUIRE_MFA_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/68d414a3-c27a-46e5-9391-3d6344e891bd?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n",
        "TestDescription": "\r\n  Microsoft recommends creating at least one conditional access policy targetting all cloud apps and ideally all users.\r\n\r\n  See [Plan a Conditional Access deployment - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/plan-conditional-access#apply-conditional-access-policies-to-every-app)"
      }
    },
    {
      "Name": "MT.1005: All Conditional Access policies are configured to exclude at least one emergency/break glass account or group.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1005",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1005"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaEmergencyAccessExists | Should -Be $true -Because \"there is no emergency access account or group present in all enabled policies\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no emergency access account or group present in all enabled policies, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no emergency access account or group present in all enabled policies, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "12",
            "LineText": "        Test-MtCaEmergencyAccessExists | Should -Be $true -Because \"there is no emergency access account or group present in all enabled policies\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 12\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nAutomatically detected emergency access user: The Notorious BGA (7a607eec-319a-491f-827a-9ebbb2d37c43)\n\nThese conditional access policies don't have the emergency access user excluded:\n\n  - [[SharePoint admin center]Block access from apps on unmanaged devices - 2025/02/25](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/919a76a4-a289-4352-9100-bcaf21938401)\n  - [[SharePoint admin center]Use app-enforced Restrictions for browser access - 2025/02/25](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f3972dfb-eeeb-46b9-9429-892990c74cd4)\n  - [Enforce MFA to Azure Key Vault - DISABLED](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/97d86c41-a278-46b6-a52d-09100495fb15)\n  - [Microsoft-managed: Multifactor authentication for per-user multifactor authentication users](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/95e3da0f-c1ea-49fa-8d8d-398bbc55414c)\n  - [XX_BLOCK_SHAREPOINT_TEST](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/5883cbc2-2091-4f47-b1ec-ab14b117ee1e)\n",
        "TestDescription": "It is recommended to have at least one emergency/break glass account or account group excluded from all conditional access policies.\r\nThis allows for emergency access to the tenant in case of a misconfiguration or other issues.\r\n\r\nSee [Manage emergency access accounts in Microsoft Entra ID - Microsoft Learn](https://learn.microsoft.com/entra/identity/role-based-access-control/security-emergency-access)\r\n\r\n"
      }
    },
    {
      "Name": "MT.1006: At least one Conditional Access policy is configured to require MFA for admins.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1006",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1006"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaMfaForAdmin | Should -Be $true -Because \"there is no policy that requires MFA for admins\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\n\r\nThe following conditional access policies require multi-factor authentication for admins:\n\n  - [12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/fd319abe-075c-4e98-b190-4954e8784d14)\n  - [14_REQUIRE_PASSWORD-RESET_HIGH-USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/69d49cd7-b663-4d66-bd29-3784695d9524)\n  - [01_REQUIRE_MFA_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/68d414a3-c27a-46e5-9391-3d6344e891bd)\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6)\n",
        "TestDescription": "This test checks if the tenant has at least one conditional access policy requiring MFA for admins.\r\nThe following roles are considered as admin roles:\r\n\r\n- Global Administrator\r\n- Application Administrator\r\n- Authentication Administrator\r\n- Billing Administrator\r\n- Cloud Application Administrator\r\n- Conditional Access Administrator\r\n- Exchange Administrator\r\n- Helpdesk Administrator\r\n- Password Administrator\r\n- Privileged Authentication Administrator\r\n- Privileged Role Administrator\r\n- Security Administrator\r\n- SharePoint Administrator\r\n- User Administrator\r\n\r\nSee [Require MFA for administrators - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-admin-mfa)\"\r\n\r\n"
      }
    },
    {
      "Name": "MT.1007: At least one Conditional Access policy is configured to require MFA for all users.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1007",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1007"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaMfaForAllUsers | Should -Be $true -Because \"there is no policy that requires MFA for all users\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nThe following conditional access policies require multi-factor authentication for all users:\n\n  - [12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/fd319abe-075c-4e98-b190-4954e8784d14)\n  - [01_REQUIRE_MFA_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/68d414a3-c27a-46e5-9391-3d6344e891bd)\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6)\n",
        "TestDescription": "This test checks if the tenant has at least one conditional access policy requiring MFA for all users.\r\n\r\nSee [Require MFA for all users - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-all-users-mfa)\r\n"
      }
    },
    {
      "Name": "MT.1008: At least one Conditional Access policy is configured to require MFA for Azure management.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1008",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1008"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaMfaForAdminManagement | Should -Be $true -Because \"there is no policy that requires MFA for Azure management\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": null
    },
    {
      "Name": "MT.1009: At least one Conditional Access policy is configured to block other legacy authentication.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1009",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1009"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaBlockLegacyOtherAuthentication | Should -Be $true -Because \"there is no policy that blocks legacy authentication\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These conditional access policies block legacy authentication for other clients :\n\n  - [02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/7b9eb412-5671-46c9-bafd-ba6948b624a8?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n",
        "TestDescription": "\r\nLegacy authentication is an unsecure method to authenticate. This function checks if the tenant has at least one\r\nconditional access policy that blocks legacy authentication.\r\n\r\nSee [Block legacy authentication - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-block-legacy)"
      }
    },
    {
      "Name": "MT.1010: At least one Conditional Access policy is configured to block legacy authentication for Exchange ActiveSync.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1010",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1010"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaBlockLegacyExchangeActiveSyncAuthentication | Should -Be $true -Because \"there is no policy that blocks legacy authentication for Exchange ActiveSync\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These conditional access policies block legacy authentication for Exchange Active Sync:\n\n  - [02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/7b9eb412-5671-46c9-bafd-ba6948b624a8?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n",
        "TestDescription": "\r\nLegacy authentication is an unsecure method to authenticate. This function checks if the tenant has at least one\r\nconditional access policy that blocks legacy authentication.\r\n\r\nSee [Block legacy authentication - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-block-legacy)"
      }
    },
    {
      "Name": "MT.1011: At least one Conditional Access policy is configured to secure security info registration only from a trusted location.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1011",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1011"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaSecureSecurityInfoRegistration | Should -Be $true -Because \"there is no policy that secures security info registration\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that secures security info registration, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that secures security info registration, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "30",
            "LineText": "        Test-MtCaSecureSecurityInfoRegistration | Should -Be $true -Because \"there is no policy that secures security info registration\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 30\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nNo conditional access policy securing security info registration.",
        "TestDescription": "Checks if the tenant has at least one conditional access policy securing security info registration.\r\n\r\nSee [Securing security info registration - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-registration)\r\n"
      }
    },
    {
      "Name": "MT.1012: At least one Conditional Access policy is configured to require MFA for risky sign-ins.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1012",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1012"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaMfaForRiskySignIn | Should -Be $true -Because \"there is no policy that requires MFA for risky sign-ins\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nThe following conditional access policies require multi-factor authentication for risky sign-ins\n\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6)\n",
        "TestDescription": "Checks if the tenant has at least one conditional access policy requiring multifactor authentication for risky sign-ins.\r\n\r\nSee [Sign-in risk-based multifactor authentication - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-risk)\r\n"
      }
    },
    {
      "Name": "MT.1013: At least one Conditional Access policy is configured to require new password when user risk is high.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1013",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1013"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaRequirePasswordChangeForHighUserRisk | Should -Be $true -Because \"there is no policy that requires new password when user risk is high\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nThe following conditional access policies require password change for risky users\n\n  - [14_REQUIRE_PASSWORD-RESET_HIGH-USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/69d49cd7-b663-4d66-bd29-3784695d9524)\n",
        "TestDescription": "Checks if the tenant has at least one conditional access policy requiring password change for high user risk.\r\n\r\nSee [User risk-based password change - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-conditional-access-policy-risk-user)\r\n"
      }
    },
    {
      "Name": "MT.1014: At least one Conditional Access policy is configured to require compliant or Entra hybrid joined devices for admins.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1014",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1014"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaDeviceComplianceAdminsExists | Should -Be $true -Because \"there is no policy that requires compliant or Entra hybrid joined devices for admins\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that requires compliant or Entra hybrid joined devices for admins, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that requires compliant or Entra hybrid joined devices for admins, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "39",
            "LineText": "        Test-MtCaDeviceComplianceAdminsExists | Should -Be $true -Because \"there is no policy that requires compliant or Entra hybrid joined devices for admins\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 39\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "There was no conditional access policy requiring compliant or Microsoft Entra hybrid joined device for administrators.",
        "TestDescription": "\r\nMicrosoft recommends requiring device compliance for administrators that are members of the following roles:\r\n\r\n* Global administrator\r\n* Application administrator\r\n* Authentication Administrator\r\n* Billing administrator\r\n* Cloud application administrator\r\n* Conditional Access administrator\r\n* Exchange administrator\r\n* Helpdesk administrator\r\n* Password administrator\r\n* Privileged authentication administrator\r\n* Privileged Role Administrator\r\n* Security administrator\r\n* SharePoint administrator\r\n* User administrator\r\n\r\nSee [Require compliant or Microsoft Entra hybrid joined device for administrators - Microsoft Learn](https://aka.ms/CATemplatesAdminDevices)"
      }
    },
    {
      "Name": "MT.1015: At least one Conditional Access policy is configured to block access for unknown or unsupported device platforms.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1015",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1015"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaBlockUnknownOrUnsupportedDevicePlatform | Should -Be $true -Because \"there is no policy that blocks access for unknown or unsupported device platforms\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that blocks access for unknown or unsupported device platforms, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that blocks access for unknown or unsupported device platforms, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "42",
            "LineText": "        Test-MtCaBlockUnknownOrUnsupportedDevicePlatform | Should -Be $true -Because \"there is no policy that blocks access for unknown or unsupported device platforms\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 42\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "There was no conditional access policy blocking access for unknown or unsupported device platforms.",
        "TestDescription": "\r\nMicrosoft recommends blocking access for unknown or unsupported device platforms.\r\n\r\nSee [Block access for unknown or unsupported device platform - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-policy-unknown-unsupported-device)"
      }
    },
    {
      "Name": "MT.1016: At least one Conditional Access policy is configured to require MFA for guest access.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1016",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1016"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaMfaForGuest | Should -Be $true -Because \"there is no policy that requires MFA for guest access\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that requires MFA for guest access, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that requires MFA for guest access, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "45",
            "LineText": "        Test-MtCaMfaForGuest | Should -Be $true -Because \"there is no policy that requires MFA for guest access\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 45\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\nNo conditional access policy requires multi-factor authentication for guest accounts.",
        "TestDescription": "This check verifies if there is at least one conditional access policy that requires multifactor authentication for all guest accounts.\r\n\r\nSee [Require multifactor authentication for guest access - Microsoft Learn](https://learn.microsoft.com/entra/identity/conditional-access/howto-policy-guest-mfa)\r\n"
      }
    },
    {
      "Name": "MT.1017: At least one Conditional Access policy is configured to enforce non persistent browser session for non-corporate devices.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1017",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1017"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaEnforceNonPersistentBrowserSession | Should -Be $true -Because \"there is no policy that enforces non persistent browser session for non-corporate devices\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that enforces non persistent browser session for non-corporate devices, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that enforces non persistent browser session for non-corporate devices, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "48",
            "LineText": "        Test-MtCaEnforceNonPersistentBrowserSession | Should -Be $true -Because \"there is no policy that enforces non persistent browser session for non-corporate devices\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 48\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "There was no conditional access policy enforcing non persistent browser session for non-corporate devices.",
        "TestDescription": "\r\nMicrosoft recommends disabling browser persistence for users accessing the tenant from a unmanaged device.\r\n\r\nSee [Require reauthentication and disable browser persistence - Microsoft Learn](https://aka.ms/CATemplatesBrowserSession)"
      }
    },
    {
      "Name": "MT.1018: At least one Conditional Access policy is configured to enforce sign-in frequency for non-corporate devices.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1018",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1018"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaEnforceSignInFrequency | Should -Be $true -Because \"there is no policy that enforces sign-in frequency for non-corporate devices\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that enforces sign-in frequency for non-corporate devices, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that enforces sign-in frequency for non-corporate devices, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "51",
            "LineText": "        Test-MtCaEnforceSignInFrequency | Should -Be $true -Because \"there is no policy that enforces sign-in frequency for non-corporate devices\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 51\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "There was no conditional access policy enforcing sign-in frequency for non-corporate devices.",
        "TestDescription": "\r\nMicrosoft recommends disabling browser persistence for users accessing the tenant from a unmanaged device.\r\n\r\nSee [Require reauthentication and disable browser persistence - Microsoft Learn](https://aka.ms/CATemplatesBrowserSession)"
      }
    },
    {
      "Name": "MT.1019: At least one Conditional Access policy is configured to enable application enforced restrictions.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1019",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1019"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaApplicationEnforcedRestriction | Should -Be $true -Because \"there is no policy that enables application enforced restrictions\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that enables application enforced restrictions, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that enables application enforced restrictions, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "54",
            "LineText": "        Test-MtCaApplicationEnforcedRestriction | Should -Be $true -Because \"there is no policy that enables application enforced restrictions\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 54\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": null
    },
    {
      "Name": "MT.1020: All Conditional Access policies are configured to exclude directory synchronization accounts or do not scope them.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1020",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1020"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaExclusionForDirectorySyncAccount | Should -Be $true -Because \"there is no policy that excludes directory synchronization accounts\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there is no policy that excludes directory synchronization accounts, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there is no policy that excludes directory synchronization accounts, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "57",
            "LineText": "        Test-MtCaExclusionForDirectorySyncAccount | Should -Be $true -Because \"there is no policy that excludes directory synchronization accounts\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 57\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "The following conditional access policies are scoped to all users but don't exclude the directory synchronization accounts:\n\n  - [01_REQUIRE_MFA_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/68d414a3-c27a-46e5-9391-3d6344e891bd?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/7b9eb412-5671-46c9-bafd-ba6948b624a8?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [03_SESSION_DURATION_30-DAYS_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/d4b3ae44-a35f-4096-bcf0-f52db814fdb6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [04_REQUIRE_COMPLIANT-DEVICE_TEST-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/535f8d68-5eae-4f85-82b0-a682ad38a94a?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f92ab61f-ba58-45d4-a454-a352f0c8f721?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [09_BLOCK_ALL-LOCATIONS_SERVICE-ACCOUNT_EXCEPT_SPECIFIC-IP](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/d97f8d2f-c761-4e11-9eeb-6e6ac3f9d1d6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/fd319abe-075c-4e98-b190-4954e8784d14?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/958322bb-f0e3-40c5-9e33-c71af5f3b2e6?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [14_REQUIRE_PASSWORD-RESET_HIGH-USER-RISK_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/69d49cd7-b663-4d66-bd29-3784695d9524?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [CAAC - Test](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/e61f2899-56ed-4f2b-8a10-882189e7a992?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n  - [Microsoft-managed: Multifactor authentication for per-user multifactor authentication users](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/95e3da0f-c1ea-49fa-8d8d-398bbc55414c?%23view/Microsoft_AAD_ConditionalAccess/ConditionalAccessBlade/~/Policies?=)\n",
        "TestDescription": "It is recommended to exclude directory synchronization accounts from all conditional access policies scoped to all cloud apps."
      }
    },
    {
      "Name": "MT.1022: All users utilizing a P1 license should be licensed.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1022",
      "Tag": [
        "LicenseUtilization",
        "MT.1022"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n            $LicenseReport = Test-MtCaLicenseUtilization -License \"P1\"\r\n            $LicenseReport.TotalLicensesUtilized | Should -BeLessOrEqual $LicenseReport.EntitledLicenseCount -Because \"this is the maximium number of user that can utilize a P1 license\"\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "License utilization",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Total users entitled for Entra ID P1: **9**\n\nTotal P1 licenses utilized: **0**",
        "TestDescription": "This test checks the utilization of Entra ID P1 licenses in the tenant."
      }
    },
    {
      "Name": "MT.1023: All users utilizing a P2 license should be licensed.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1023",
      "Tag": [
        "LicenseUtilization",
        "MT.1023"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n            $LicenseReport = Test-MtCaLicenseUtilization -License \"P2\"\r\n            $LicenseReport.TotalLicensesUtilized | Should -BeLessOrEqual $LicenseReport.EntitledLicenseCount -Because \"this is the maximium number of user that can utilize a P2 license\"\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected the actual value to be less than or equal to 8, because this is the maximium number of user that can utilize a P2 license, but got 23.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected the actual value to be less than or equal to 8, because this is the maximium number of user that can utilize a P2 license, but got 23.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "75",
            "LineText": "            $LicenseReport.TotalLicensesUtilized | Should -BeLessOrEqual $LicenseReport.EntitledLicenseCount -Because \"this is the maximium number of user that can utilize a P2 license\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8193\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 75\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "License utilization",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Total users entitled for Entra ID P2: **8**\n\nTotal P2 licenses utilized: **23**",
        "TestDescription": "This test checks the utilization of Entra ID P2 licenses in the tenant."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Remove unused credentials from applications.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "staleAppCreds"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Removing unused application credentials helps reduce the attack surface area and helps declutter the app portfolio of a tenant., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Removing unused application credentials helps reduce the attack surface area and helps declutter the app portfolio of a tenant., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Your tenant has applications with credentials which have not been used in more than 30 days.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Remove unused credentials from applications](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_staleAppCreds) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [P2P Server](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/325c103e-06dc-4340-a7c5-fb4deca80e41/appId/6860509b-6280-4104-bc5f-5d9ca5000264) | 10/08/2024 10:00:59 | \n| ❌ Fail | [Michael Labrecque_app](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/acc3d7b1-4e06-4259-8382-b275a1944123/appId/ab288edb-c61d-4e77-b56f-fcb61ad932ed) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Michael Labrecque_app](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/acc3d7b1-4e06-4259-8382-b275a1944123/appId/ab288edb-c61d-4e77-b56f-fcb61ad932ed) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (2e6a60f2-e32a-4d09-804a-3abe8eb108f1)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/09c7050f-e07f-4a04-b289-2343fcb45a46/appId/52f7fd5d-84dc-4d97-aa30-d1c9cd56e9a4) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito Preprod](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/2dd5ca05-bae6-403c-b12c-88c7793a0fac/appId/94f1a4ed-7349-4f6d-ab2c-5829b0938873) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito Preprod](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/2dd5ca05-bae6-403c-b12c-88c7793a0fac/appId/94f1a4ed-7349-4f6d-ab2c-5829b0938873) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito Dev](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/15ee70cd-2dc2-4c48-9164-e6593335458b/appId/a9cad448-9ce7-4267-a462-19a7f25617eb) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito Dev](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/15ee70cd-2dc2-4c48-9164-e6593335458b/appId/a9cad448-9ce7-4267-a462-19a7f25617eb) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (f828a17c-3180-46db-bae3-5a192c9910e6)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/c54525ec-899a-4870-9c10-83649369e48a/appId/4fdca066-1825-4bb7-91e4-aa2dba8c3989) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (5cf30cff-73c9-4348-ae0c-a949c05c6c7e)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/5f137762-a85f-40f8-af93-6b92c09b82a8/appId/2701a515-64c3-4b2a-a10a-b0f3c071ae20) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (e323e3e7-2c3f-4082-9034-6fcae0240b93)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/adca08fa-07f9-45f4-87bb-9e230f70ba17/appId/3f3c561f-9060-4d87-bb12-154c367241a1) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail client portal.egyde.ca](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/8ec29e58-d5db-4d32-9f7d-a964b1be8b7f/appId/8cec9de9-6a3d-4e60-8866-6179c474ecf5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail client portal.egyde.ca](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/8ec29e58-d5db-4d32-9f7d-a964b1be8b7f/appId/8cec9de9-6a3d-4e60-8866-6179c474ecf5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (22e1e788-abd0-42b1-89fd-cbcb75845e7b)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/c5bed61f-14d4-481a-8d5c-660d327393d4/appId/bb6e57b3-24b7-4ff5-b3ec-50f83c0d4c3f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AWS Single-Account Access](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/c5ee6922-c477-4792-86db-6cc15daae21b/appId/37044706-de0b-4002-891d-91dbe6587387) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AWS Single-Account Access](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/c5ee6922-c477-4792-86db-6cc15daae21b/appId/37044706-de0b-4002-891d-91dbe6587387) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (b2d78e57-8913-43f0-a120-cbb1552f9641)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/013dee66-13b2-49de-b642-6c5c53a9aa65/appId/43d7c53d-1d05-4a6b-9ea3-1a17a8393be1) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (772dd61d-d061-49b0-995e-021be482904b)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/87874cc0-0989-4e9f-aabf-9fa1602613c7/appId/4646b477-7391-4345-822e-136c9385d7ff) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (04cacd4d-32af-4bf1-8980-7788b6a8600f)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/7caad492-b075-48b4-94b5-5ba6b50baccf/appId/80a282dd-7418-4396-b391-54304c364ec6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (c46b09a6-57b8-4a5c-b386-565a9e9cdcb9)](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/108acd0b-1f37-4b79-96ff-a6d3503a23b9/appId/668e6976-6ef1-4321-9a23-3375298d5c9b) | 08/09/2024 10:01:33 | \n| ✅ Pass | [Portail Client cognito staging + dev cmi](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/a1c5bbaa-aef2-425f-b96d-44d420d47a48/appId/c95eb8a4-1dd0-4ced-8cde-fc08e62414c8) | 08/09/2024 10:01:33 | \n| ✅ Pass | [Portail Client cognito staging + dev cmi](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/a1c5bbaa-aef2-425f-b96d-44d420d47a48/appId/c95eb8a4-1dd0-4ced-8cde-fc08e62414c8) | 08/09/2024 10:01:33 | \n\n\n#### Remediation actions:\n\n1. From the ‘Impacted resources’ table, select ‘More details’ to identify the Credential ID and the Origin of the credential.[]().\n\n2. Select ‘Update credential’ to go directly to the Application or Service principal area.[]().\n\n3. If the Origin of the credential is an application, select ‘Certificates & secrets’ then locate the unused credential and remove it.[]().\n\n4. If the Origin of the credential is a service principal, go to ‘Identity’ > ‘Enterprise applications’ > ‘Single sign-on’ > ‘SAML certificates’ then locate the unused credential and remove it.[]().\n\n5. In the instance where the origin of the credential in the recommendation is marked as service principal but there are no SAML certificates, you can use the Microsoft Graph API to query specific properties and remove the credential from the Service Principal. For more information, see [Recommendation to remove unused apps](https://go.microsoft.com/fwlink/?linkid=2285918).",
        "TestDescription": "Removing unused application credentials helps reduce the attack surface area and helps declutter the app portfolio of a tenant."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Convert from per-user MFA to Conditional Access MFA.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "turnOffPerUserMFA"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "3 users are currently configured for per-user Multi-Factor Authentication (MFA). However, there are 20 users configured for Conditional Access (CA) MFA. The per-user MFA configuration supersedes the MFA settings applied via CA policies, potentially creating unnecessary MFA prompts.\n\n➡️ Open [Recommendation - Convert from per-user MFA to Conditional Access MFA](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_turnOffPerUserMFA) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. To get started, confirm that there is an existing CA policy with an MFA requirement. Ensure that you are covering all resources and users you would like to secure with MFA. [Click here to view your CA policies](https://portal.azure.com/?Microsoft_AAD_IAM_enableAadvisorFeaturePreview=true&Microsoft_AAD_IAM_enableAadvisorFeature=true#blade/Microsoft_AAD_IAM/PoliciesTemplateBlade).\n\n2. To require MFA via a CA policy, follow the steps in this tutorial: [Secure user sign-in events with Microsoft Entra Multi-Factor Authentication](https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-azure-mfa?toc=/azure/active-directory/conditional-access/toc.json&bc=/azure/active-directory/conditional-access/breadcrumb/toc.json).\n\n3. Ensure that the per-user MFA configuration is turned off. [Navigate to MFA settings](https://account.activedirectory.windowsazure.com/UserManagement/MfaSettings.aspx).",
        "TestDescription": "Improve user productivity and minimize sign-in time with fewer MFA prompts. Ensure that your most sensitive resources can have the tighest controls, while your least sensitive resources can be more freely accessible."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Do not expire passwords.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "pwagePolicyNew"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Your current policy is set to never let passwords expire.\n\n➡️ Open [Recommendation - Do not expire passwords](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_pwagePolicyNew) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. In the Microsoft 365 admin center, go to Settings > Org Settings > Security & privacy > Password expiration policy. Then check the box \"Set passwords to never expire (recommended)\". You must be a global admin to edit the password policy. [Go to Password expiration policy in Microsoft 365](https://admin.microsoft.com/#/Settings/SecurityPrivacy/:/Settings/L1/PasswordPolicy).\n\n2. If your organization has an on-premises implementation, we recommend that you set the status for this action to “Completed” or “Resolved through alternate mitigation”.[]().",
        "TestDescription": "Research has found that when periodic password resets are enforced, passwords become less secure. Users tend to pick a weaker password and vary it slightly for each reset. If a user creates a strong password (long, complex and without any pragmatic words present), it should remain as strong in the future as it is today. It is Microsoft's official security position to not expire passwords periodically without a specific reason, and recommends that cloud-only tenants set the password policy to never expire."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Renew expiring application credentials.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "applicationCredentialExpiry"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Renewing an application’s credentials prior to their expiry date is crucial for maintaining uninterrupted operations and minimizing the risk of any downtime resulting from outdated credentials., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Renewing an application’s credentials prior to their expiry date is crucial for maintaining uninterrupted operations and minimizing the risk of any downtime resulting from outdated credentials., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Your tenant has applications with credentials that will expire soon.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Renew expiring application credentials](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_applicationCredentialExpiry) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ✅ Pass | [Microsoft-Extractor-Suite](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/a6014805-994d-45e8-98ef-306a7e2e2139) | 02/21/2025 10:02:38 | \n| ❌ Fail | [ServiceNowTest](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/a6014805-994d-45e8-98ef-306a7e2e2139) | 03/06/2025 10:03:27 | \n\n\n#### Remediation actions:\n\n1. From the impacted resources table, click on “More details” to see and note the ID of the credential.[]().\n\n2. Click the “Update credential” link to navigate to the Application registration blade.[]().\n\n3. Navigate to the Certificates & Secrets section of the app registration.[]().\n\n4. Pick the credential type that you want to rotate and navigate to either Certificates or Client Secret tab and follow the prompts to add a new credential of that type.[]().\n\n5. Once the certificate or secret is successfully added, update the service code to ensure it works with the new credential.[]().\n\n6. Use the Microsoft Entra sign-in logs to validate that the Key ID of the credential matches the one that was recently added.[]().\n\n7. After validating the new credential, navigate back to App registrations > Certificates and Secrets for the app and remove the old credential.[]().",
        "TestDescription": "Renewing an application’s credentials prior to their expiry date is crucial for maintaining uninterrupted operations and minimizing the risk of any downtime resulting from outdated credentials."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Renew expiring service principal credentials.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "servicePrincipalKeyExpiry"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Renewing the service principal credential(s) before expiration ensures the application continues to function and reduces the possibility of downtime due to an expired credential., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Renewing the service principal credential(s) before expiration ensures the application continues to function and reduces the possibility of downtime due to an expired credential., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Your tenant has service principals with credentials that will expire soon.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Renew expiring service principal credentials](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_servicePrincipalKeyExpiry) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ✅ Pass | [Portail Client cognito staging + dev cmi](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/a6014805-994d-45e8-98ef-306a7e2e2139/appId/c95eb8a4-1dd0-4ced-8cde-fc08e62414c8) | 02/21/2025 10:02:38 | \n| ❌ Fail | [Portail Client cognito Preprod](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/a6014805-994d-45e8-98ef-306a7e2e2139/appId/94f1a4ed-7349-4f6d-ab2c-5829b0938873) | 03/23/2025 10:02:35 | \n\n\n#### Remediation actions:\n\n1. Navigate to the Enterprise applications section and locate the Enterprise application for which the credential needs to be rotated.[]().\n\n2. Navigate to the “Single sign-on” blade.[]().\n\n3. Edit the 'SAML signing certificate' section and follow prompts to add a new certificate.[]().\n\n4. After adding the certificate, change its properties to make certificate active. This will make the previous certificate inactive.[]().\n\n5. Once the certificate is successfully added and activated, validate that your service is working with the new credential, and remove the old credential.[]().\n\n6. If the service principal does not show any credentials after navigating to the enterprise apps blade, we recommend checking the 'passwordCredentials' and 'keyCredentials' property of the service principal object using PowerShell or Microsoft Graph service principal API and use the Microsoft Graph API to rotate credentials.[]().",
        "TestDescription": "Renewing the service principal credential(s) before expiration ensures the application continues to function and reduces the possibility of downtime due to an expired credential. "
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Require multifactor authentication for administrative roles.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "adminMFAV2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Requiring multifactor authentication (MFA) for administrative roles makes it harder for attackers to access accounts. Administrative roles have higher permissions than typical users. If any of those accounts are compromised, your entire organization is exposed. At a minimum, protect the following roles: Global administrator, Authentication administrator, Billing administrator, Conditional Access administrator, Exchange administrator, Helpdesk administrator, Security administrator, SharePoint administrator, User administrator., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Requiring multifactor authentication (MFA) for administrative roles makes it harder for attackers to access accounts. Administrative roles have higher permissions than typical users. If any of those accounts are compromised, your entire organization is exposed. At a minimum, protect the following roles: Global administrator, Authentication administrator, Billing administrator, Conditional Access administrator, Exchange administrator, Helpdesk administrator, Security administrator, SharePoint administrator, User administrator., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 2 of 5 users with administrative roles that aren’t registered and protected with MFA.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Require multifactor authentication for administrative roles](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_adminMFAV2) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [admin@klabmtl.onmicrosoft.com]() | 10/19/2024 08:13:01 | \n| ❌ Fail | [notoriousbga@klabmtl.ca]() | 10/19/2024 08:13:01 | \n| ✅ Pass | [testadmin@klabmtl.ca]() | 05/30/2024 08:10:14 | \n\n\n#### Remediation actions:\n\n1. We provide step-by-step guidance to select and enable the right MFA method for your organization in the Microsoft 365 admin center. [Go to the Microsoft 365 MFA wizard](https://admin.microsoft.com/adminportal/home?Q=SecureScore#/featureexplorer/security/ConditionalAccess).\n\n2. If you would like to perform the implementation yourself, first check what Microsoft Entra ID license you have under “Prerequisites” in Microsoft Secure Score or [see your license type under \"Basic information\" in the Microsoft Entra ID Overview.](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview).\n\n3. If you’ve invested in Microsoft Entra ID Premium P1 or P2 licenses, you can create a Conditional Access policy from scratch or by using a template. [Follow these steps to create a Conditional Access policy from scratch or by using a template](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-admin-mfa).\n\n4. If you would like to perform the implementation yourself and you’re using Microsoft Entra ID Free, turn on security defaults. Note: Security defaults and Conditional Access can’t be used side by side. [Enable security defaults](https://docs.microsoft.com/azure/active-directory/fundamentals/concept-fundamentals-security-defaults).\n\n5. Keep track of your admin’s progress of registering authentication methods by going to Microsoft Entra ID > Security > Authentication methods > User registration details (requires Microsoft Entra ID Premium P1 or P2 licenses). [Go to User registration details](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/UserRegistrationDetails).",
        "TestDescription": "Requiring multifactor authentication (MFA) for administrative roles makes it harder for attackers to access accounts. Administrative roles have higher permissions than typical users. If any of those accounts are compromised, your entire organization is exposed. At a minimum, protect the following roles: Global administrator, Authentication administrator, Billing administrator, Conditional Access administrator, Exchange administrator, Helpdesk administrator, Security administrator, SharePoint administrator, User administrator."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Enable policy to block legacy authentication.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "blockLegacyAuthentication"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Today, most compromising sign-in attempts come from legacy authentication. Older office clients such as Office 2010 don’t support modern authentication and use legacy protocols such as IMAP, SMTP, and POP3. Legacy authentication doesn’t support multifactor authentication (MFA). Even if an MFA policy is configured in your environment, bad actors can bypass these enforcements through legacy protocols., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Today, most compromising sign-in attempts come from legacy authentication. Older office clients such as Office 2010 don’t support modern authentication and use legacy protocols such as IMAP, SMTP, and POP3. Legacy authentication doesn’t support multifactor authentication (MFA). Even if an MFA policy is configured in your environment, bad actors can bypass these enforcements through legacy protocols., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 2 of 68 users that don’t have legacy authentication blocked. \n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Enable policy to block legacy authentication](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_blockLegacyAuthentication) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [notoriousbga@klabmtl.ca]() | 09/20/2024 04:13:14 | \n| ❌ Fail | [admin@klabmtl.onmicrosoft.com]() | 08/25/2024 00:33:09 | \n| ❌ Fail | [admin@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n\n\n#### Remediation actions:\n\n1. We provide step-by-step guidance to select and enable the right method to block legacy authentication for your organization in the Microsoft 365 admin center (part of the MFA wizard). [Go to the Microsoft 365 MFA wizard](https://admin.microsoft.com/adminportal/home?Q=SecureScore#/featureexplorer/security/ConditionalAccess).\n\n2. If you would like to perform the implementation yourself, first check what Microsoft Entra ID license you have under “Prerequisites” in Microsoft Secure Score or [see your license type under \"Basic information\" in the Microsoft Entra ID Overview.](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview).\n\n3. If you’ve invested in Microsoft Entra ID Premium P1 or P2 licenses, you can create a Conditional Access policy from scratch or by using a template. [Follow these steps to create a Conditional Access policy from scratch or by using a template](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-block-legacy).\n\n4. If you would like to perform the implementation yourself and you’re using Microsoft Entra ID Free, turn on security defaults. Note: Security defaults and Conditional Access can’t be used side by side. [Enable security defaults](https://docs.microsoft.com/azure/active-directory/fundamentals/concept-fundamentals-security-defaults).",
        "TestDescription": "Today, most compromising sign-in attempts come from legacy authentication. Older office clients such as Office 2010 don’t support modern authentication and use legacy protocols such as IMAP, SMTP, and POP3. Legacy authentication doesn’t support multifactor authentication (MFA). Even if an MFA policy is configured in your environment, bad actors can bypass these enforcements through legacy protocols."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Do not allow users to grant consent to unreliable applications.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "integratedApps"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because To reduce the risk of malicious applications attempting to trick users into granting them access to your organization's data, we recommend that you allow user consent only for applications that have been published by a verified publisher., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because To reduce the risk of malicious applications attempting to trick users into granting them access to your organization's data, we recommend that you allow user consent only for applications that have been published by a verified publisher., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have no user consent policy in place.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Do not allow users to grant consent to unreliable applications](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_integratedApps) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. Go to Microsoft Entra ID > Enterprise applications > Consent and permissions. [Go to Consent and permissions](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/UserSettings).\n\n2. Select “Allow user consent for apps from verified publishers, for selected permissions (Recommended)” to follow Microsoft’s best practice. [Learn more](https://docs.microsoft.com/azure/active-directory/manage-apps/consent-and-permissions-overview).\n\n3. Configure the low-impact permissions that users are allowed to consent to. Click “Select permissions to classify as low impact”. [Learn more](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-permission-classifications?tabs=azure-portal).\n\n4. Optionally, you can help your users to consent to apps that require admin consent by setting up the admin consent workflow. This step is recommended but not required to get full score. [Learn how to configure the admin consent workflow](https://docs.microsoft.com/azure/active-directory/manage-apps/configure-admin-consent-workflow).",
        "TestDescription": "To reduce the risk of malicious applications attempting to trick users into granting them access to your organization's data, we recommend that you allow user consent only for applications that have been published by a verified publisher."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Ensure all users can complete multifactor authentication.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "mfaRegistrationV2"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Multifactor authentication (MFA) helps protect devices and data that are accessible to these users. Adding more authentication methods, such as the Microsoft Authenticator app or a phone number, increases the level of protection if one factor is compromised., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Multifactor authentication (MFA) helps protect devices and data that are accessible to these users. Adding more authentication methods, such as the Microsoft Authenticator app or a phone number, increases the level of protection if one factor is compromised., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 27 of 68 users that aren’t registered with MFA. \n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Ensure all users can complete multifactor authentication](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_mfaRegistrationV2) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [danassif_egyde.ca#EXT#@klabmtl.onmicrosoft.com]() | 08/25/2024 00:33:09 | \n| ❌ Fail | [xlandrylemieux_kpmg.ca#EXT#@klabmtl.onmicrosoft.com]() | 08/25/2024 00:33:09 | \n| ❌ Fail | [testadmin@klabmtl.ca]() | 08/25/2024 00:33:09 | \n| ❌ Fail | [jboucher_egyde.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [ScannerServiceAcc@POCScanner.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [Sync_ATY-DC-WinSrv20_bc0a345e65d9@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [xlandrylemieux_kpmg.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [kpmg-spamservice@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [momo@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [testPLAYBOOK@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [svcaccount-test@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [SRV_EDMUploadAgent@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [alzadmin@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [danassif_egyde.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [Sync_TESTSCANFP1_563a5bbd79f9@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ✅ Pass | [jajishing@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [vm-egyde-purview@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [arnaudlandry_kpmg.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [testadmin@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [cthibault@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [Sync_sccmdc01_757c3545b161@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [rbouchard_kpmg.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ✅ Pass | [gabrielchabot_kpmg.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/20/2024 04:13:14 | \n| ❌ Fail | [admin@klabmtl.onmicrosoft.com]() | 10/18/2024 08:13:01 | \n| ❌ Fail | [notoriousbga@klabmtl.ca]() | 10/18/2024 08:13:01 | \n| ❌ Fail | [Sync_YOAN-W2K19-WVM1_6b02f6a5b9ac@klabmtl.onmicrosoft.com]() | 12/13/2024 08:08:52 | \n| ❌ Fail | [jmichallet@klabmtl.ca]() | 01/16/2025 08:11:46 | \n| ❌ Fail | [bphilippe@klabmtl.ca]() | 01/16/2025 08:11:46 | \n| ❌ Fail | [Yoan-Shared@klabmtl.ca]() | 01/31/2025 08:17:05 | \n| ❌ Fail | [datashielddivine@klabmtl.ca]() | 02/07/2025 08:19:32 | \n| ❌ Fail | [kpmg-spamservice@klabmtl.ca]() | 08/25/2024 00:33:09 | \n| ❌ Fail | [Sync_ATY-DC-WinSrv20_bc0a345e65d9@klabmtl.onmicrosoft.com]() | 08/25/2024 00:33:09 | \n| ❌ Fail | [lowprivilegedaccount@klabmtl.ca]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [jonathanboucher_kpmg.ca#EXT#@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n\n\n#### Remediation actions:\n\n1. We provide step-by-step guidance to select and enable the right MFA method for your organization in the Microsoft 365 admin center. [Go to the Microsoft 365 MFA wizard](https://admin.microsoft.com/adminportal/home?Q=SecureScore\" \\l \"/featureexplorer/security/ConditionalAccess).\n\n2. If you would like to perform the implementation yourself, first check what Microsoft Entra ID license you have under “Prerequisites” in Microsoft Secure Score or [see your license type under \"Basic information\" in the Microsoft Entra ID Overview.](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview).\n\n3. If you’ve invested in Microsoft Entra ID Premium P1 or P2 licenses, you can create a Conditional Access policy from scratch or by using a template. [Follow these steps to create a Conditional Access policy from scratch or by using a template](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-registration).\n\n4. If you would like to perform the implementation yourself and you’re using Microsoft Entra ID Free, turn on security defaults. Note: Security defaults and Conditional Access can’t be used side by side. [Enable security defaults](https://docs.microsoft.com/azure/active-directory/fundamentals/concept-fundamentals-security-defaults).\n\n5. Keep track of your user’s progress of registering authentication methods by going to Microsoft Entra ID > Security > Authentication methods > User registration details (requires Microsoft Entra ID Premium P1 or P2 licenses). [Go to User registration details](https://portal.azure.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/UserRegistrationDetails).\n\n6. Use registration campaign to nudge users to set up specific authentication methods by going to Microsoft Entra ID > Protection > Authentication methods > Registration campaign. [Go to registration campaign](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/AuthenticationMethodsMenuBlade/~/RegistrationCampaign/fromNav/Identity).",
        "TestDescription": "Multifactor authentication (MFA) helps protect devices and data that are accessible to these users. Adding more authentication methods, such as the Microsoft Authenticator app or a phone number, increases the level of protection if one factor is compromised."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Remove unused applications.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "staleApps"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Removing unused applications helps reduce the attack surface area and helps declutter the app portfolio of a tenant., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Removing unused applications helps reduce the attack surface area and helps declutter the app portfolio of a tenant., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "This recommendation will surface if your tenant has applications that have not been used for over 90 days. Applications that were created but never used, client applications which have not been issued a token or resource apps that have not been a target of a token request, will show under this recommendation.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Remove unused applications](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_staleApps) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [Portail Client cognito Dev](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/a9cad448-9ce7-4267-a462-19a7f25617eb) | 08/28/2024 10:01:13 | \n| ❌ Fail | [Misp2Sentinel](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/1b3bec4e-fd9a-4d0d-b5d7-618ed55b5a82) | 08/28/2024 10:01:13 | \n| ❌ Fail | [ vm-egyde-purview](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/e796a12f-2491-4402-929e-1e254ef1944f) | 08/28/2024 10:01:13 | \n| ❌ Fail | [cribl-office365-activity](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/01666618-6cdb-4bf2-ac6b-06c8084b0ed5) | 08/28/2024 10:01:13 | \n| ❌ Fail | [OneDrive Recovery bot](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/67e20368-ac4e-40c4-ab41-b3d8789433af) | 08/28/2024 10:01:13 | \n| ❌ Fail | [test-create-app-reg](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/2e78933b-9aa4-46b6-8424-9f717ed6f2d6) | 08/28/2024 10:01:13 | \n| ❌ Fail | [Fabric-Workspace-Test-XPC](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/6fee40a0-4763-4c09-a189-7083c8305c15) | 10/30/2024 10:01:52 | \n| ❌ Fail | [AWS IAM Identity Center (successor to AWS Single Sign-On)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/b9aac326-5a17-4f5b-ae32-c373c42e4720) | 11/18/2024 10:05:04 | \n| ❌ Fail | [Microsoft-Extractor-Suite](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/880af3eb-0ee3-427d-8331-afa24a3493c6) | 11/25/2024 10:20:23 | \n| ❌ Fail | [m365-defender-api](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/61714a3f-6432-4fb1-b0ac-f97804f917f3) | 01/06/2025 10:01:24 | \n| ❌ Fail | [Purview_Tool_Test_Jack_001](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/272e20ff-8e1e-48f7-9c6a-f62cac498647) | 02/07/2025 10:45:24 | \n| ❌ Fail | [IntunePolicyBackup](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/ad65cbfd-70d0-4565-9635-3dc63453d2ce) | 03/14/2025 10:02:45 | \n| ❌ Fail | [Intezer](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/0fb023e0-50c7-4047-bfda-f1b5f4f85132) | 03/20/2025 10:02:35 | \n| ❌ Fail | [CloudGuard-Connect](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/4c174e94-94f3-452c-83c9-08af7c68e753) | 03/21/2025 10:03:18 | \n| ❌ Fail | [tazar-application](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/f62de0c3-b9b3-47f2-85fe-1fa91f24239b) | 08/09/2024 10:01:33 | \n| ❌ Fail | [automation-account-egyde_3MJSZgvlCPsOk+wcn7U/1Xw9WXkmGwduTAeLlz5pBhE=](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/886622c2-2bb3-4c27-89cf-1d6178b9f20d) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AzureADGroupCreation](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/eb0f67c6-53e5-4fc8-8315-efbfb2d12ba2) | 08/09/2024 10:01:33 | \n| ❌ Fail | [ConfigMgrSvc_94267752-f1ae-4578-9259-d58587416cc5](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/07b06a71-aa4d-47b4-bf55-ae864fcd1585) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (c46b09a6-57b8-4a5c-b386-565a9e9cdcb9)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/668e6976-6ef1-4321-9a23-3375298d5c9b) | 08/09/2024 10:01:33 | \n| ❌ Fail | [alandry0547-Demo546461651-arnaud](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/00e099a7-4b47-4abd-b586-53f5a0b12a10) | 08/09/2024 10:01:33 | \n| ❌ Fail | [qohash-m365-preview](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/caf6c369-46c8-47ee-8e04-144e2d263680) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (5cf30cff-73c9-4348-ae0c-a949c05c6c7e)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/2701a515-64c3-4b2a-a10a-b0f3c071ae20) | 08/09/2024 10:01:33 | \n| ❌ Fail | [V2V-test](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/3385d001-9970-475a-b398-287af43c108c) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AzSentinelConnectors](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/77185a13-573e-4455-b775-05f1aa7b6221) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito Preprod](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/94f1a4ed-7349-4f6d-ab2c-5829b0938873) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Steampipe-Read](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/b0ee9e29-ad7a-47c4-a069-d0c029d705c5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [ALZ1-alz-ALZ1](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/dedac66f-6cfc-4a46-a3e1-459cb9e1ac3f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AWS Single-Account Access](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/37044706-de0b-4002-891d-91dbe6587387) | 08/09/2024 10:01:33 | \n| ❌ Fail | [alandry0547-Demo546461651-46c811be-12f2-4081-934f-ccb90dd2b900](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/cc986649-2788-49d0-94dc-2dda1cbc990f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Microsoft365DSC](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/19c7de8d-db30-4454-be80-4c7a987049a8) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Siemplify-Test-SpamAnalysis-2023](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/2aafc340-3563-4355-8ae6-9c8c0cefe56c) | 08/09/2024 10:01:33 | \n| ❌ Fail | [TestAzureMonitor](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/82237da0-e686-4270-8d01-2142f53ce458) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (e323e3e7-2c3f-4082-9034-6fcae0240b93)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/3f3c561f-9060-4d87-bb12-154c367241a1) | 08/09/2024 10:01:33 | \n| ❌ Fail | [steampipe](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/68a1b7c0-8680-4b5e-8952-3acdc910b460) | 08/09/2024 10:01:33 | \n| ❌ Fail | [MPIPSCANNERFP](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/b62137ce-8e42-40ba-b9ec-f479f7e405f4) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Google Cloud (provisioning) [STOPPED]](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/4f54ea44-70ee-4e0f-8cd9-bf2252d9973a) | 08/09/2024 10:01:33 | \n| ❌ Fail | [MDATP-Automated-DeviceIsolation](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/6b4f0c0f-1c2c-43b9-b067-a4ba7c882158) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AIPScanAppSVR1](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/9d20ae7e-3c9b-4db7-b767-c9d4db5df8f6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Test231012](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/1ca81ba8-f731-41fa-a542-5a39f8c41725) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (2e6a60f2-e32a-4d09-804a-3abe8eb108f1)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/52f7fd5d-84dc-4d97-aa30-d1c9cd56e9a4) | 08/09/2024 10:01:33 | \n| ❌ Fail | [test-function-app-egyde](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/44bc8a65-5bac-4098-9402-a37d4bcc06af) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure AD SAML Toolkit](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/8834be19-e035-43cf-a1d0-e3a819ecd137) | 08/09/2024 10:01:33 | \n| ❌ Fail | [TufinApp](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/c973816c-3961-4b0c-bdc8-ce94f7dd330a) | 08/09/2024 10:01:33 | \n| ❌ Fail | [egyde-test-azure-ad-read](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/b3320daf-e06a-4a02-b1bd-d1a2be2ae886) | 08/09/2024 10:01:33 | \n| ❌ Fail | [GetRingGroupEmailList](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/47e82dae-1e20-4be1-9b82-79984b72059d) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Cisco AnyConnect](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/789690e3-88ac-46fb-8674-fb508a69a519) | 08/09/2024 10:01:33 | \n| ❌ Fail | [KPMGPSAudit_Test](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/d6e5c2f8-c22c-4a42-8d00-55e8e0c62501) | 08/09/2024 10:01:33 | \n| ❌ Fail | [SentinelAPI](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/dae5109e-06bb-4494-ad69-e250ba472ac1) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Test_M365DSC](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/74cf3c26-e303-419a-bc74-eba8c16803c8) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (47a65058-9638-4c70-ba84-d4aca8d6539f)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/2c70e60b-4649-406c-a19a-e7c927afad33) | 08/09/2024 10:01:33 | \n| ❌ Fail | [MicrosoftSentinelLogsAPI](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/e3389050-59ff-4721-a114-f5c0c942d2bc) | 08/09/2024 10:01:33 | \n| ❌ Fail | [OpenShift](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/318037eb-c570-4be0-a226-44ca3d733f05) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Test-Sharepoint](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/8aac67bd-3705-43fa-add3-29f8faafe8bd) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (b2d78e57-8913-43f0-a120-cbb1552f9641)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/43d7c53d-1d05-4a6b-9ea3-1a17a8393be1) | 08/09/2024 10:01:33 | \n| ❌ Fail | [DevOps Vault](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/632b2e83-5848-41c0-8474-98dd53a69e2f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [POCAPPSCANNER](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/cbf2a1e1-f8e3-4a52-899c-bd8e8ce46bcb) | 08/09/2024 10:01:33 | \n| ❌ Fail | [DEMO](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/57483b5f-aa28-486c-9e36-05b002b9d4f5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Siemplify_Test_Connector_2023](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/d2528de3-7184-4642-b14a-7fdbabfce8d5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Tests_apps_permissions](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/6c0276c5-e81b-45ef-92c3-68785386c36c) | 08/09/2024 10:01:33 | \n| ❌ Fail | [ContosoSIEMConnector](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/afd0ddb9-f5ce-4d2b-a9a3-0bfebeb3386f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [purview](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/3ba776a1-6e1a-4204-9c50-9f5e257e4139) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AzureADUserDevices](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/ecbed5f0-6335-4180-a3e7-0819c3ce05d0) | 08/09/2024 10:01:33 | \n| ❌ Fail | [ComplianceTowerApp](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/d8e10851-ef15-4495-91cb-979fcdb281bc) | 08/09/2024 10:01:33 | \n| ❌ Fail | [TestMCAS_hW1S19ZAL8kdaxja4Ujc2vBUzPc2NQVCfPIw6DNajfU=](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/94e7a6a9-1007-4c1c-be7c-6389256262bd) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AzurePipeline](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/75b90f8e-58b1-4439-964b-5c7d7eba56d6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (b80c26e1-8a31-498f-98c9-f1f42949cbb7)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/0525718a-7477-4774-81c2-a5d59f3063df) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Sentinel-MDE-Scan](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/964163cc-0210-4d6e-a7fa-f4382667b6e5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [test23](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/0505bea9-acca-42ec-a5e3-65520cf37776) | 08/09/2024 10:01:33 | \n| ❌ Fail | [KPMG_AUDIT_TEST](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/d1482e41-7e5c-457e-a414-0293ab5e9ff3) | 08/09/2024 10:01:33 | \n| ❌ Fail | [test-ado-workload-identity](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/c2c4bae0-bc9a-4801-b83a-e36c1b0686cb) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Graph Powershell](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/d5f1696c-3b9b-4f20-b5d5-225764d17fa3) | 08/09/2024 10:01:33 | \n| ❌ Fail | [sp-azurearc](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/05331032-a953-4154-ae9b-5e625208acf9) | 08/09/2024 10:01:33 | \n| ❌ Fail | [WindowsDefenderATPSiemConnector](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/1ee309ef-d67f-4c06-84e3-f9840c740cef) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Michael Labrecque_app](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/ab288edb-c61d-4e77-b56f-fcb61ad932ed) | 08/09/2024 10:01:33 | \n| ❌ Fail | [APP-Test](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/e2a7f25d-491d-4e0a-ad11-05f8596fa75f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [WPNinjas.eu Automatic Documentation](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/75964f96-001f-4a42-8439-a7cc4966d101) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Kofax](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/2155d8c2-2e4d-4a51-9ebe-d9738076e398) | 08/09/2024 10:01:33 | \n| ❌ Fail | [GraphRunner_test_app](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/16c54477-2d98-4774-b21a-269b39484772) | 08/09/2024 10:01:33 | \n| ❌ Fail | [KPMG-Egyde](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/e82d4b32-ee9f-4f3c-a5d2-7f182ca88775) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure-DevOps-Egyde](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/b75a05b6-bca0-4ce6-97ee-a244254f8fd3) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (f202c453-8f11-45a1-bcd7-34f55d3d663d)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/b3f38fe4-a2ca-4179-8385-af55491d9408) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Terraform](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/f35378b2-02f3-42c5-ba01-52321cd8bed6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Qostodian-Monitor](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/ad3d7719-db8e-4a69-8341-e3cd7ee1eaf4) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Egyde-Cloudees-es_ADO-SC](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/7652f2dd-ac7f-40e7-be9d-d199846b0023) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Google Cloud - Klabmtl-Org](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/3e385896-9b68-4eb2-be49-664ac1b7b1b6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Test](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/84b4ffc8-2f41-457d-9915-4d4585cc4678) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Qostodian-SSO](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/cfc430da-bdbe-41c0-8bed-08dd859f9d41) | 08/09/2024 10:01:33 | \n| ❌ Fail | [klabmtl-KLabMtl-d9d00b33-6de0-4956-a115-26a403d76373](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/f414748c-241c-44b0-9b7d-824ffd4d8609) | 08/09/2024 10:01:33 | \n| ❌ Fail | [soc-graph-mfa-registration](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/22f0921b-81cf-4240-9d5b-d96f6e2e83eb) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Qostodian-Keyvault](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/876deeed-1e2a-479d-b988-86411d6156e6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Sonic Wall](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/ddf104f7-75c2-4907-8882-61fc0257a0c8) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (f828a17c-3180-46db-bae3-5a192c9910e6)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/4fdca066-1825-4bb7-91e4-aa2dba8c3989) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (772dd61d-d061-49b0-995e-021be482904b)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/4646b477-7391-4345-822e-136c9385d7ff) | 08/09/2024 10:01:33 | \n| ❌ Fail | [SentinelApiTest](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/3aca3fee-ff68-4276-af5d-a145b0050a82) | 08/09/2024 10:01:33 | \n| ❌ Fail | [ComplianceCenterApp](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/7dd76519-4c24-4956-bcda-ea8e4e8a7022) | 08/09/2024 10:01:33 | \n| ❌ Fail | [POCScannerGT](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/bbebbe76-e109-41ed-a609-70362d87d952) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (22e1e788-abd0-42b1-89fd-cbcb75845e7b)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/bb6e57b3-24b7-4ff5-b3ec-50f83c0d4c3f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Kofax ](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/1a5d7572-ff00-4703-87b5-cc1350bd8ea9) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail client portal.egyde.ca](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/8cec9de9-6a3d-4e60-8866-6179c474ecf5) | 08/09/2024 10:01:33 | \n| ❌ Fail | [InnovationApp](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/ced8e0e8-a4e1-4dff-b8ff-1485267e9344) | 08/09/2024 10:01:33 | \n| ❌ Fail | [WorkbookApiManagedSiem](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/6e80019f-ee6c-4095-9b12-99a041542285) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Global_Reader_App](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/138ecea4-c251-4d69-bcec-55a7eab4652c) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito - Michael Labrecque](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/1f7b40ec-8526-4875-b9fc-e1a028e4b3a8) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (04cacd4d-32af-4bf1-8980-7788b6a8600f)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/80a282dd-7418-4396-b391-54304c364ec6) | 08/09/2024 10:01:33 | \n| ❌ Fail | [tst](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/260d9536-e733-4f5c-b99d-ab6bc7925c8f) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Portail Client cognito staging + dev cmi](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/c95eb8a4-1dd0-4ced-8cde-fc08e62414c8) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Test_MDE_Tags](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/53f484e0-f61c-4960-b826-ffdf8f511253) | 08/09/2024 10:01:33 | \n| ❌ Fail | [MitreMappingZK](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/4cb1328b-6fa7-4cfb-8914-f37fd49a57d2) | 08/09/2024 10:01:33 | \n| ❌ Fail | [KPMG-EGYDE](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/3cc4fdf8-f34e-46ea-adf7-f747d9fda7dd) | 08/09/2024 10:01:33 | \n| ❌ Fail | [GetRingGroupEmailList51](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/92e4b258-2464-4aff-959c-64303d1dcbc4) | 08/09/2024 10:01:33 | \n| ❌ Fail | [Azure Sentinel Content Deployment App (0685d0ba-0ba8-4749-8e60-7fcc65a505df)](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/40966b65-b039-44c4-9da4-c34e3eeae776) | 08/09/2024 10:01:33 | \n| ❌ Fail | [AzureArcLinux](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/93f71053-135f-4a81-866b-49ff6df8eba7) | 08/09/2024 10:01:33 | \n\n\n#### Remediation actions:\n\n1. From the Impacted resources table, select More details to identify the impacted resources.[]().\n\n2. Select the Resource link to go directly to the associated App registration page.[]().\n\n3. Determine if the identified application is needed based on the application usage scenario. For example, an application could have usage gaps due to being deprecated or intentional long intermittent use through the year. []().\n\n4. If the application is no longer needed, remove it from your tenant by first soft deleting it, wait 15 days, and then remove it permanently. Find more details on how to soft or permanently delete applications, see [How to: Restore or remove a recently deleted application with the Microsoft identity platform](https://learn.microsoft.com/en-us/entra/identity-platform/howto-restore-app).\n\n5. If the application is needed, you have the option to update the status of the recommendation for that application as Dismissed or Postponed. For more information, see [How to update a recommendation.](https://learn.microsoft.com/en-us/entra/identity/monitoring-health/howto-use-recommendations#how-to-update-a-recommendation&tabs=http).\n\n6. For more information, see [Recommendation to remove unused apps.](https://learn.microsoft.com/en-us/entra/identity/monitoring-health/recommendation-remove-unused-apps).",
        "TestDescription": "Removing unused applications helps reduce the attack surface area and helps declutter the app portfolio of a tenant."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Enable password hash sync if hybrid.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "passwordHashSync"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have enabled password hash sync.\n\n➡️ Open [Recommendation - Enable password hash sync if hybrid](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_passwordHashSync) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. To use password hash synchronization in your organization, you need to install Microsoft Entra Connect and configure directory synchronization between your on-premises Microsoft Entra Connect instance and your Microsoft Entra Connect cloud sync instance. [Follow these steps to enable password hash synchronization](https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization#enable-password-hash-synchronization).",
        "TestDescription": "Password hash synchronization is one of the sign-in methods used to accomplish hybrid identity. Microsoft Entra Connect synchronizes a hash of the hash of a user's password from an on-premises Microsoft Entra Connect instance to a cloud-based Microsoft Entra Connect cloud sync instance. Password hash synchronization helps by reducing the number of passwords your users need to maintain to just one. Enabling password hash synchronization also allows for leaked credential reporting."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Migrate from the retiring MSOnline and AzureAD PowerShell usage to Microsoft Graph PowerShell.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "becRetirement"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because The legacy MSOnline and AzureAD PowerShell modules are currently being deprecated and are scheduled to retire. MSOnline PowerShell will retire, and stop working, between April and May 2025. AzureAD PowerShell will no longer be supported after April 1, 2025, and its retirement will start after July 1, 2025. \n    \nThe replacement for these modules is the Microsoft Graph PowerShell SDK or the new Microsoft Entra PowerShell module, both of which use only Microsoft Graph APIs. The Microsoft Graph PowerShell SDK and Microsoft Entra PowerShell modules are fully supported and are continually being improved. The Microsoft Entra PowerShell modules support PowerShell version 7, cross-platform support (Windows, Linux, and macOS), modern authentication, and many more features and resource cmdlets., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because The legacy MSOnline and AzureAD PowerShell modules are currently being deprecated and are scheduled to retire. MSOnline PowerShell will retire, and stop working, between April and May 2025. AzureAD PowerShell will no longer be supported after April 1, 2025, and its retirement will start after July 1, 2025. \n    \nThe replacement for these modules is the Microsoft Graph PowerShell SDK or the new Microsoft Entra PowerShell module, both of which use only Microsoft Graph APIs. The Microsoft Graph PowerShell SDK and Microsoft Entra PowerShell modules are fully supported and are continually being improved. The Microsoft Entra PowerShell modules support PowerShell version 7, cross-platform support (Windows, Linux, and macOS), modern authentication, and many more features and resource cmdlets., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "The deprecated MSOnline or AzureAD PowerShell module is being used in your tenant. These modules will retire soon and should migrate to Microsoft Graph PowerShell SDK or Microsoft Entra PowerShell.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Migrate from the retiring MSOnline and AzureAD PowerShell usage to Microsoft Graph PowerShell](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_becRetirement) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [MSOnline]() | 03/14/2025 11:14:23 | \n\n\n#### Remediation actions:\n\n1. Review the legacy PowerShell module(s) being used in your environment under **Impacted Resources**.[]().\n\n2. Select the **More details** link to view the details about the activity associated with the selected legacy PowerShell module.[]().\n\n3. Review the interactive and non-interactive sign-in logs. Set the filter to **Application: Azure Active Directory PowerShell**. Both the MSOnline and AzureAD modules fall under this category.[Customize and filter activity logs.](https://go.microsoft.com/fwlink/?linkid=2300139).\n\n4. Migrate your MSOnline and Azure AD PowerShell modules to the Microsoft Graph PowerShell modules. Detailed guidance is available to help with this process.[Migrate from Azure AD PowerShell to Microsoft Graph PowerShell.](https://go.microsoft.com/fwlink/?linkid=2299936).\n\n5. Learn more about migrating AzureAD PowerShell cmdlets to Microsoft Graph PowerShell.[Find Azure AD and MSOnline cmdlets in Microsoft Graph PowerShell.](https://go.microsoft.com/fwlink/?linkid=2300140).",
        "TestDescription": "The legacy MSOnline and AzureAD PowerShell modules are currently being deprecated and are scheduled to retire. MSOnline PowerShell will retire, and stop working, between April and May 2025. AzureAD PowerShell will no longer be supported after April 1, 2025, and its retirement will start after July 1, 2025. \n    \nThe replacement for these modules is the Microsoft Graph PowerShell SDK or the new Microsoft Entra PowerShell module, both of which use only Microsoft Graph APIs. The Microsoft Graph PowerShell SDK and Microsoft Entra PowerShell modules are fully supported and are continually being improved. The Microsoft Entra PowerShell modules support PowerShell version 7, cross-platform support (Windows, Linux, and macOS), modern authentication, and many more features and resource cmdlets."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Use least privileged administrative roles .",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "roleOverlap"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You currently have 30 users with privileged administrative roles. \n\n➡️ Open [Recommendation - Use least privileged administrative roles ](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_roleOverlap) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. Identify the users in your organization with a persistent global administrator role assigned. Go to Microsoft Entra ID > Roles and administrators and select the Global administrator role in the table. Identify the global admins you want to reassign to a different role. [Go to Roles and administrators in Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RolesAndAdministrators).\n\n2. Assign these users to roles where they can complete necessary tasks with the least amount of privilege required. For example, if a user is primarily responsible for Exchange Online administration, they should be assigned that role instead of global administrator. Be sure to have at least two global admins designated to allow for full access to the network if one of the accounts is locked out or compromised. [Check out this overview of available limited administrative roles](https://docs.microsoft.com/azure/active-directory/roles/delegate-by-task).\n\n3. After these persistent global admins have been reassigned new roles, return to Roles and administrators and select the Global administrator role. Select the users that no longer need persistent access and then click Remove. [Go to Roles and administrators in Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RolesAndAdministrators).\n\n4. Emergency access accounts: If the only other global admin accounts your organization has set up are for \"break-glass\" scenarios, which are ineligible for role reassignment, we recommend that you set the status of this action to “Dismissed” or “Risk accepted”. [Learn more about emergency access accounts](https://docs.microsoft.com/azure/active-directory/roles/security-emergency-access).",
        "TestDescription": "Ensure that your administrators can accomplish their work with the least amount of privilege assigned to their account. Assigning users roles like Password Administrator or Exchange Online Administrator, instead of Global Administrator, reduces the likelihood of a global administrative privileged account being breached."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Enable self-service password reset.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "selfServicePasswordReset"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 0 of  users who don't have self-service password reset enabled. \n\n➡️ Open [Recommendation - Enable self-service password reset](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_selfServicePasswordReset) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. Follow our [step-by-step guidance to enable self-service password reset](https://docs.microsoft.com/azure/active-directory/authentication/tutorial-enable-sspr).\n\n2. If you have users that are synced from on-premises Microsoft Entra Connect using Microsoft Entra Connect, you may also need to enable the password writeback feature. [For more information, see this article](https://docs.microsoft.com/azure/active-directory/authentication/tutorial-enable-sspr-writeback?WT.mc_id=Portal-Microsoft_AAD_IAM).",
        "TestDescription": "With self-service password reset in Microsoft Entra ID, users no longer need to engage helpdesk to reset passwords. This feature works well with Microsoft Entra ID dynamically banned passwords, which prevents easily guessable passwords from being used."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Protect all users with a sign-in risk policy.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "signinRiskPolicy"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Turning on the sign-in risk policy ensures that suspicious sign-ins are challenged for multifactor authentication (MFA)., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Turning on the sign-in risk policy ensures that suspicious sign-ins are challenged for multifactor authentication (MFA)., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 2 of 68 users that don't have a sign-in risk policy turned on.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Protect all users with a sign-in risk policy](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_signinRiskPolicy) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [admin@klabmtl.onmicrosoft.com]() | 09/09/2024 17:59:43 | \n| ❌ Fail | [notoriousbga@klabmtl.ca]() | 09/20/2024 21:34:14 | \n\n\n#### Remediation actions:\n\n1. To implement this recommendation, you need Microsoft Entra ID Premium P2 licenses. Check what Microsoft Entra ID license you have under “Prerequisites” in Microsoft Secure Score or [see your license type under \"Basic information\" in the Microsoft Entra ID Overview.](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview).\n\n2. If you’ve invested in Microsoft Entra ID Premium P2 licenses, you can create a Conditional Access policy from scratch or by using a template. [Follow these steps to create a Conditional Access policy from scratch or by using a template](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-risk-user).\n\n3. If you’re not using Microsoft Entra ID Premium P2 licenses, we recommend you set this action to “Dismissed” or “Risk accepted”.[]().",
        "TestDescription": "Turning on the sign-in risk policy ensures that suspicious sign-ins are challenged for multifactor authentication (MFA). "
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Protect all users with a user risk policy .",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "userRiskPolicy"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because With the user risk policy turned on, Microsoft Entra ID detects the probability that a user account has been compromised. As an administrator, you can configure a user risk Conditional Access policy to automatically respond to a specific user risk level. For example, you can block access to your resources or require a password change to get a user account back into a clean state., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because With the user risk policy turned on, Microsoft Entra ID detects the probability that a user account has been compromised. As an administrator, you can configure a user risk Conditional Access policy to automatically respond to a specific user risk level. For example, you can block access to your resources or require a password change to get a user account back into a clean state., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 2 of 68 users that don’t have a user risk policy enabled. \n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Protect all users with a user risk policy ](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_userRiskPolicy) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [admin@klabmtl.onmicrosoft.com]() | 09/10/2024 22:16:15 | \n| ❌ Fail | [notoriousbga@klabmtl.ca]() | 09/20/2024 04:13:14 | \n\n\n#### Remediation actions:\n\n1. To implement this recommendation, you need Microsoft Entra ID Premium P2 licenses. Check what Microsoft Entra ID license you have under “Prerequisites” in Microsoft Secure Score or [see your license type under \"Basic information\" in the Microsoft Entra ID Overview.](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview).\n\n2. If you’ve invested in Microsoft Entra ID Premium P2 licenses, you can create a Conditional Access policy from scratch or by using a template. Note: Classic Conditional Access policies aren’t scored. Use the recommended steps to receive credit. [Follow these steps to create a Conditional Access policy from scratch or by using a template](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-risk-user).\n\n3. If you’re not using Microsoft Entra ID Premium P2 licenses, we recommend you set the status for this action to “Dismissed” or “Risk accepted”. []().",
        "TestDescription": "With the user risk policy turned on, Microsoft Entra ID detects the probability that a user account has been compromised. As an administrator, you can configure a user risk Conditional Access policy to automatically respond to a specific user risk level. For example, you can block access to your resources or require a password change to get a user account back into a clean state."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Migrate your applications that use the ADAL Library to the MSAL Library.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "adalToMsalMigration"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because We strongly recommend migrating to the Microsoft Authentication Library (MSAL), which replaces ADAL. Applications using ADAL will not be able to utilize the latest security features, leaving them vulnerable to future security threats. Below, you will find a list of applications currently utilizing ADAL. Additionally, you can identify these ADAL applications and learn how to migrate them to MSAL by following the Action Plan outlined below., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because We strongly recommend migrating to the Microsoft Authentication Library (MSAL), which replaces ADAL. Applications using ADAL will not be able to utilize the latest security features, leaving them vulnerable to future security threats. Below, you will find a list of applications currently utilizing ADAL. Additionally, you can identify these ADAL applications and learn how to migrate them to MSAL by following the Action Plan outlined below., but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Your tenant includes one or more applications that either use the Azure Active Directory Library (ADAL) directly or rely on services that utilize ADAL. Please be aware that support for ADAL will end on June 30, 2023. While applications using ADAL will continue to function beyond this date, Microsoft will cease to release security updates for ADAL, potentially exposing these applications to security risks.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Migrate your applications that use the ADAL Library to the MSAL Library](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_adalToMsalMigration) in the Entra admin portal.\n\n#### Impacted resources\n\n | Status | Name | First detected| \n| --- | --- | --- |\n| ❌ Fail | [SentinelOne CNS Scan App lmdmn](https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/Overview/appId/2539d159-9098-4b8b-af36-94482e1679bc) | 11/21/2024 06:01:49 | \n\n\n#### Remediation actions:\n\nInvestigate ADAL Apps:[]().\n\n1. To obtain detailed insights into each ADAL application please use [Sign-ins Workbook](https://aka.ms/SignInWorkBook).\n\n2. If you have not enabled the Sign-ins Workbook, please refer to the documentation for setup instructions [here](https://learn.microsoft.com/en-us/entra/identity-platform/howto-get-list-of-all-auth-library-apps).\n\nList Applications via PowerShell:[]().\n\n1. Open PowerShell as an administrator.[]().\n\n2. Connect to Microsoft Graph by executing: Connect-MgGraph -Tenant <YOUR_TENANT_ID>[]().\n\n3. Select your profile with: Select-MgProfile beta[]().\n\n4. Retrieve a list of recommendations by running: Get-MgDirectoryRecommendation | Format-List[]().\n\nFor detailed action plan, please go to Recommendation [guide.](https://aka.ms/adalrecommendation).",
        "TestDescription": "We strongly recommend migrating to the Microsoft Authentication Library (MSAL), which replaces ADAL. Applications using ADAL will not be able to utilize the latest security features, leaving them vulnerable to future security threats. Below, you will find a list of applications currently utilizing ADAL. Additionally, you can identify these ADAL applications and learn how to migrate them to MSAL by following the Action Plan outlined below."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Migrate Service Principals from the retiring Azure AD Graph APIs to Microsoft Graph.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "aadGraphDeprecationServicePrincipal"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "0 Service Principals in your tenant are calling one or more retiring APIs from Azure AD Graph and need to be migrated to Microsoft Graph.\n\n➡️ Open [Recommendation - Migrate Service Principals from the retiring Azure AD Graph APIs to Microsoft Graph](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_aadGraphDeprecationServicePrincipal) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. Review the list of Service Principals calling Azure AD Graph under Impacted Resources.[]().\n\n2. Working with the owner or publisher of the corresponding application, identify steps required to update the application to a version that is using Microsoft Graph APIs instead of Azure AD Graph APIs.[]().\n\n3. Learn more about Azure AD Graph retirement. [Azure AD Graph Retirement](https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/important-azure-ad-graph-retirement-and-powershell-module/ba-p/3848270#:~:text=Azure%20AD%20Graph%20Updates%3A%201%20No%20changes%20will,cycle%20for%20Azure%20AD%20Graph%20APIs.%20More%20items).\n\n4. Learn more about Microsoft Graph. [Microsoft Graph](https://docs.microsoft.com/en-us/graph/overview).",
        "TestDescription": "Azure AD Graph APIs are in the retirement cycle and have no SLA or maintenance commitment beyond security-related fixes. Applications that continue to use Azure AD Graph APIs and have not migrated to Microsoft Graph will be impacted by future retirement activity for Azure AD Graph. Microsoft Graph offers a single unified endpoint to access Microsoft Entra services and Microsoft 365 services. Microsoft Graph has all the capabilities that have been available in Azure AD Graph and many newer APIs and features. Its client libraries offer built-in support for features like retry handling, secure redirects, transparent authentication, and payload compression."
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Protect your tenant with Insider Risk condition in Conditional Access policy.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "insiderRiskPolicy"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected strings to be the same, because Enabling an Insider Risk-based Conditional Access policy offers crucial benefits, including early detection of anomalies, adaptive access controls, and real-time responses to insider threats. It prevents unauthorized access, enforces compliance, and reduces the impact of insider incidents. By fostering a security-aware culture, the policy integrates with the broader security ecosystem, providing a comprehensive approach to mitigate risks originating from within the organization, safeguarding sensitive data, and enhancing overall security posture.​, but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected strings to be the same, because Enabling an Insider Risk-based Conditional Access policy offers crucial benefits, including early detection of anomalies, adaptive access controls, and real-time responses to insider threats. It prevents unauthorized access, enforces compliance, and reduces the impact of insider incidents. By fostering a security-aware culture, the policy integrates with the broader security ecosystem, providing a comprehensive approach to mitigate risks originating from within the organization, safeguarding sensitive data, and enhancing overall security posture.​, but they were different.\nExpected length: 17\nActual length:   6\nStrings differ at index 0.\nExpected: 'completedBySystem'\nBut was:  'active'\n           ^",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
            "Line": "64",
            "LineText": "        $status | Should -Be \"completedBySystem\" -Because $benefits",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1: line 64\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You have 68 of 68 users that aren’t covered by the Insider Risk condition in a Conditional Access policy.\n\nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. \n\n➡️ Open [Recommendation - Protect your tenant with Insider Risk condition in Conditional Access policy](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_insiderRiskPolicy) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. Enable Adaptive Protection in Microsoft Purview. You must be a member of the Insider Risk Management or Insider Risk Management Admins role group in Microsoft Purview to configure Adaptive Protection. [Go to Adaptive Protection.](https://go.microsoft.com/fwlink/?linkid=2261736).\n\n2. Create a Conditional Access policy that includes the Insider Risk condition. [Use this risk policy template](https://go.microsoft.com/fwlink/?linkid=2261903).\n\n3. For more information about this recommendation and the associated features, see [Adaptive Protection and Insider Risk Conditional Access recommendation.](https://go.microsoft.com/fwlink/?linkid=2260505).",
        "TestDescription": "Enabling an Insider Risk-based Conditional Access policy offers crucial benefits, including early detection of anomalies, adaptive access controls, and real-time responses to insider threats. It prevents unauthorized access, enforces compliance, and reduces the impact of insider incidents. By fostering a security-aware culture, the policy integrates with the broader security ecosystem, providing a comprehensive approach to mitigate risks originating from within the organization, safeguarding sensitive data, and enhancing overall security posture.​"
      }
    },
    {
      "Name": "MT.1024: Entra Recommendation - Designate more than one global admin.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1024",
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation",
        "MT.1024",
        "oneAdmin"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n\r\n        $EntraPremiumRecommendations = @(\r\n            \"insiderRiskPolicy\",\r\n            \"userRiskPolicy\",\r\n            \"signinRiskPolicy\"\r\n        )\r\n        $recommendationUrl = \"https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/$id\"\r\n        $recommendationLinkMd = \"`n`n➡️ Open [Recommendation - $displayName]($recommendationUrl) in the Entra admin portal.\"\r\n\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product \"EntraID\"\r\n        if ( $EntraIDPlan -ne \"P2\" ) {\r\n            $EntraPremiumRecommendations | ForEach-Object {\r\n                if ( $id -match \"$($_)$\" ) {\r\n                    Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n                    return $null\r\n                }\r\n            }\r\n        }\r\n\r\n        if ( $status -match \"dismissed\" ) {\r\n            Add-MtTestResultDetail -Description $benefits -SkippedBecause Custom -SkippedCustomReason \"This recommendation has been **Dismissed** by an administrator.`n`nIf this test is valid for your tenant you can change it's state from **Dismissed** to **Active**. $recommendationLinkMd\"\r\n            return $null\r\n        }\r\n\r\n        #region Add detailed test description\r\n        $ActionSteps = $actionSteps | Sort-Object -Property 'stepNumber' | ForEach-Object {\r\n            $_.text + \"[$($_.actionUrl.displayName)]($($_.actionUrl.url)).\"\r\n        }\r\n        $ActionSteps = $ActionSteps -join \"`n`n\"\r\n        if ($status -ne 'completedBySystem' -and $impactedResources) {\r\n            $impactedResourcesList = \"`n`n#### Impacted resources`n`n | Status | Name | First detected| `n\"\r\n            $impactedResourcesList += \"| --- | --- | --- |`n\"\r\n            foreach ($resource in $impactedResources) {\r\n                if ($resource.status -eq 'completedBySystem') {\r\n                    $resourceResult = \"✅ Pass\"\r\n                } else {\r\n                    $resourceResult = \"❌ Fail\"\r\n                }\r\n                $impactedResourcesList += \"| $($resourceResult) | [$($resource.displayName)]($($resource.portalUrl)) | $($resource.addedDateTime) | `n\"\r\n            }\r\n        }\r\n\r\n        if( $status -eq 'completedBySystem' ) {\r\n            $deepLink = $recommendationLinkMd\r\n        } else {\r\n            $deepLink = \"`n`nIf the recommendation is not applicable for your tenant, it can be marked as **Dismissed** for Maester to skip it in the future. $recommendationLinkMd\"\r\n        }\r\n\r\n        $ResultMarkdown = $insights + $deepLink + $impactedResourcesList + \"`n`n#### Remediation actions:`n`n\" + $ActionSteps\r\n        Add-MtTestResultDetail -Description $benefits -Result $ResultMarkdown\r\n        #endregion\r\n        # Actual test\r\n        $status | Should -Be \"completedBySystem\" -Because $benefits\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-EntraRecommendations.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Entra Recommendations",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "You currently have 4 global admins.\n\n➡️ Open [Recommendation - Designate more than one global admin](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/RecommendationDetails.ReactView/recommendationId/a6014805-994d-45e8-98ef-306a7e2e2139_oneAdmin) in the Entra admin portal.\n\n#### Remediation actions:\n\n1. Assign more than one user a global administrator role in your organization. Go to Microsoft Entra ID > Roles and administrators and select the Global administrator role in the table. Then click Add assignments. [Go to the Global administrator role in Microsoft Entra ID](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/UserRolesViewModelMenuBlade/members/roleObjectId/62e90394-69f5-4237-9190-012177145e10/roleId/62e90394-69f5-4237-9190-012177145e10/roleTemplateId/62e90394-69f5-4237-9190-012177145e10/roleName/Global%20administrator/isRoleCustom//resourceScopeId/%2F/resourceId/26497ce3-3756-4f53-ac9d-f4d438ca62e7).",
        "TestDescription": "Having more than one global administrator helps if you’re unable to fulfill the needs or obligations of your organization. It's important to have a delegate or an emergency access account that someone from your team can access if necessary. It also allows admins the ability to monitor each other for signs of a breach."
      }
    },
    {
      "Name": "MT.1025: No external user with permanent role assignment on Control Plane.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1025",
      "Tag": [
        "Maester",
        "Privileged",
        "Security",
        "All",
        "MT.1025"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $Check = Test-MtPrivPermanentDirectoryRole -FilteredAccessLevel \"ControlPlane\" -FilterPrincipal \"ExternalUser\"\r\n        $Check | Should -Be $false -Because \"External user shouldn't have high-privileged roles\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Directory Roles - Permanent assignments",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Well done!",
        "TestDescription": "\r\nTake attention on B2B collaboration user with Entra ID directory role assignments on ControlPlane.\r\nVerify the affected external users, the user source (e.g., MSSP/partner or managing tenant) and if the privileged accounts pass your requirements for Conditional Access, Lifecycle Workflow and Identity Protection.\r\nLearn more about the best practices for privileges users:\r\n  - [Securing privileged access for hybrid and cloud deployments in Microsoft Entra ID](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-planning#ensure-separate-user-accounts-and-mail-forwarding-for-global-administrator-accounts)"
      }
    },
    {
      "Name": "MT.1026: No hybrid user with permanent role assignment on Control Plane.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1026",
      "Tag": [
        "Maester",
        "Privileged",
        "Security",
        "All",
        "MT.1026"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        $Check = Test-MtPrivPermanentDirectoryRole -FilteredAccessLevel \"ControlPlane\" -FilterPrincipal \"HybridUser\"\r\n        $Check | Should -Be $false -Because \"Hybrid user with access to high-privileged directory roles which should be avoided\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Directory Roles - Permanent assignments",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "Well done!",
        "TestDescription": "\r\nIt's recommended to use cloud-only accounts for privileges with ControlPlane privileges to avoid attack paths from on-premises environment.\r\nLearn more about the best practices for privileges users:\r\n  - [Securing privileged access for hybrid and cloud deployments in Microsoft Entra ID](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-planning#ensure-separate-user-accounts-and-mail-forwarding-for-global-administrator-accounts)\r\n  - [Protecting Microsoft 365 from on-premises attacks](https://learn.microsoft.com/en-us/entra/architecture/protect-m365-from-on-premises-attacks#isolate-privileged-identities)\r\n"
      }
    },
    {
      "Name": "MT.1027: No Service Principal with Client Secret and permanent role assignment on Control Plane.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1027",
      "Tag": [
        "Maester",
        "Privileged",
        "Security",
        "All",
        "MT.1027"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $Check = Test-MtPrivPermanentDirectoryRole -FilteredAccessLevel \"ControlPlane\" -FilterPrincipal \"ServicePrincipalClientSecret\"\r\n        $Check | Should -Be $false -Because \"Service Principal with assignments to high-privileged roles should not using Client Secret\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $false, because Service Principal with assignments to high-privileged roles should not using Client Secret, but got $true.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $false, because Service Principal with assignments to high-privileged roles should not using Client Secret, but got $true.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
            "Line": "16",
            "LineText": "        $Check | Should -Be $false -Because \"Service Principal with assignments to high-privileged roles should not using Client Secret\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1: line 16\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Directory Roles - Permanent assignments",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These directory role assignments for ServicePrincipalClientSecret exists:\n\n  - [AIPScanAppSVR1](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/0cebe6d6-b088-4f94-84a6-48ee934cdf42) with Security Reader on scope directory (tenant-wide)\n  - [AzSentinelConnectors](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/88199e0d-391c-4105-9d6f-0b0d7bcb9734) with Global Administrator on scope directory (tenant-wide)\n  - [KPMG-Egyde_M365_Assessment](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/9ad5f619-7e6d-4544-86a3-4c9fa6e67c5e) with Global Reader on scope directory (tenant-wide)\n  - [SentinelAPI](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/dfe8e2eb-9f96-4cff-bae7-a8b84d517ec7) with Security Administrator on scope directory (tenant-wide)\n  - [SentinelAPI](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/dfe8e2eb-9f96-4cff-bae7-a8b84d517ec7) with Security Reader on scope directory (tenant-wide)\n  - [SentinelAPI](https://portal.azure.com/#view/Microsoft_AAD_IAM/ManagedAppMenuBlade/~/Overview/objectId/dfe8e2eb-9f96-4cff-bae7-a8b84d517ec7) with Security Operator on scope directory (tenant-wide)\n",
        "TestDescription": "\r\nReview your Service Principals with Client Secrets and ControlPlane privileges.\r\nIt's recommended to use certificates for Service Principals. Review if you can replace client secrets by certificates or use managed identities instead of a Service Principal.\r\nLearn more about the best practices for issuing certificates for Service Principals:\r\n  - [Securing service principals in Microsoft Entra ID](https://learn.microsoft.com/en-us/entra/architecture/service-accounts-principal#service-principal-authentication)\r\n  - [Best practices for all isolation architectures - Service Principal Credentials](https://learn.microsoft.com/en-us/entra/architecture/secure-best-practices#service-principals-credentials)\r\n"
      }
    },
    {
      "Name": "MT.1028: No user with mailbox and permanent role assignment on Control Plane.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1028",
      "Tag": [
        "Maester",
        "Privileged",
        "Security",
        "All",
        "MT.1028"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        $Check = Test-MtPrivPermanentDirectoryRole -FilteredAccessLevel \"ControlPlane\" -FilterPrincipal \"UserMailbox\"\r\n        $Check | Should -Be $false -Because \"Privileged user with assignment to high-privileged roles should not be mail-enabled which could be a risk for phishing attacks\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $false, because Privileged user with assignment to high-privileged roles should not be mail-enabled which could be a risk for phishing attacks, but got $true.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $false, because Privileged user with assignment to high-privileged roles should not be mail-enabled which could be a risk for phishing attacks, but got $true.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
            "Line": "20",
            "LineText": "        $Check | Should -Be $false -Because \"Privileged user with assignment to high-privileged roles should not be mail-enabled which could be a risk for phishing attacks\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1: line 20\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Directory Roles - Permanent assignments",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These directory role assignments for UserMailbox exists:\n\n  - [Marc-Antoine Hébert](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/344c2ae8-9a84-456c-885e-dcb1c93bfded) with Global Administrator on scope directory (tenant-wide)\n  - [Marc-Antoine Hébert](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/344c2ae8-9a84-456c-885e-dcb1c93bfded) with Global Reader on scope directory (tenant-wide)\n  - [Gabriel Tessier](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/64f1291a-7b5b-4ca4-877b-ded034e94881) with Global Administrator on scope directory (tenant-wide)\n  - [Gabriel Tessier](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/64f1291a-7b5b-4ca4-877b-ded034e94881) with Global Reader on scope directory (tenant-wide)\n  - [Almighty Admin](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/9edf6b7c-8a6a-42ce-abc7-f606038ebb76) with Global Administrator on scope directory (tenant-wide)\n  - [Almighty Admin](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/9edf6b7c-8a6a-42ce-abc7-f606038ebb76) with Azure AD Joined Device Local Administrator on scope directory (tenant-wide)\n  - [×º°”˜”°º×_Gabriel_Chabot_×º°”˜”°º×](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/a4bc4fb4-0224-4770-8f0f-4b36af2ce00e) with Global Reader on scope directory (tenant-wide)\n  - [Antoine Durocher](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/d31557a5-1e17-4077-b53d-dcaf34e6be8f) with Global Administrator on scope directory (tenant-wide)\n  - [Antoine Durocher](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/d31557a5-1e17-4077-b53d-dcaf34e6be8f) with Global Reader on scope directory (tenant-wide)\n  - [Xavier Pinet-Chevalier](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/e65e00d2-9577-44c4-9263-f43dac309c4e) with Global Reader on scope directory (tenant-wide)\n  - [Philippe De Ladurantaye](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/ea7b5440-5b2a-453a-8b9d-52af8d1ccb6d) with Global Administrator on scope directory (tenant-wide)\n  - [Philippe De Ladurantaye](https://portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/ea7b5440-5b2a-453a-8b9d-52af8d1ccb6d) with Privileged Authentication Administrator on scope directory (tenant-wide)\n",
        "TestDescription": "\r\nTake attention on mail-enabled administrative accounts with ControlPlane privileges.\r\nIt's recommended to use mail forwarding to regular work account which allows to avoid direct mail access and phishing attacks on privileged user.\r\nLearn more about the best practices for securing privileged user accounts:\r\n  - [Securing privileged access for hybrid and cloud deployments in Microsoft Entra ID](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/security-planning#ensure-separate-user-accounts-and-mail-forwarding-for-global-administrator-accounts)\r\n"
      }
    },
    {
      "Name": "MT.1029: Stale accounts are not assigned to privileged roles.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1029",
      "Tag": [
        "Privileged",
        "Security",
        "All",
        "MT.1029"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        if ( ( Get-MtLicenseInformation EntraID ) -ne \"P2\" ) {\r\n            Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n        } else {\r\n            $Check = Test-MtPimAlertsExists -AlertId \"StaleSignInAlert\"\r\n            $check.numberOfAffectedItems -eq \"0\" | Should -Be $true -Because $check.securityImpact\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "ErrorRecord": "You cannot call a method on a null-valued expression.",
            "WasThrownFromThrowStatement": false,
            "TargetSite": "Void CheckActionPreference(System.Management.Automation.Language.FunctionContext, System.Exception)",
            "Message": "You cannot call a method on a null-valued expression.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": "System.Management.Automation",
            "HResult": -2146233087,
            "StackTrace": "   at System.Management.Automation.ExceptionHandlingOps.CheckActionPreference(FunctionContext funcContext, Exception exception)\r\n   at System.Management.Automation.Interpreter.ActionCallInstruction`2.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.Interpreter.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.LightLambda.RunVoid1[T0](T0 arg0)\r\n   at System.Management.Automation.ScriptBlock.InvokeWithPipeImpl(ScriptBlockClauseToInvoke clauseToInvoke, Boolean createLocalScope, Dictionary`2 functionsToDefine, List`1 variablesToDefine, ErrorHandlingBehavior errorHandlingBehavior, Object dollarUnder, Object input, Object scriptThis, Pipe outputPipe, InvocationInfo invocationInfo, Object[] args)\r\n   at System.Management.Automation.ScriptBlock.InvokeWithPipe(Boolean useLocalScope, ErrorHandlingBehavior errorHandlingBehavior, Object dollarUnder, Object input, Object scriptThis, Pipe outputPipe, InvocationInfo invocationInfo, Boolean propagateAllExceptionsToTop, List`1 variablesToDefine, Dictionary`2 functionsToDefine, Object[] args)\r\n   at Microsoft.PowerShell.Commands.ForEachObjectCommand.ProcessScriptBlockParameterSet()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()"
          },
          "TargetObject": null,
          "CategoryInfo": {
            "Category": 7,
            "Activity": "ForEach-Object",
            "Reason": "RuntimeException",
            "TargetName": "",
            "TargetType": ""
          },
          "FullyQualifiedErrorId": "InvokeMethodOnNull,Microsoft.PowerShell.Commands.ForEachObjectCommand",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": "ForEach-Object",
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 46,
            "OffsetInLine": 56,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1",
            "Line": "    $AffectedRoleAssignments = $Alert.additionalData | ForEach-Object {\r\n",
            "Statement": "ForEach-Object {\r\n      $CurrentItem = $_.item\r\n      $result = New-Object psobject\r\n      foreach ($entry in $CurrentItem.GetEnumerator()) {\r\n        $result | Add-Member -MemberType NoteProperty -Name $entry.key -Value $entry.value -Force\r\n      }\r\n      $result\r\n    }",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1:46 char:56\r\n+ …   $AffectedRoleAssignments = $Alert.additionalData | ForEach-Object {\r\n+                                                        ~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1",
            "InvocationName": "ForEach-Object",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1: line 49\r\nat Test-MtPimAlertsExists<Process>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1: line 46\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1: line 29\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Privileged Identity Management (PIM) - Alerts",
      "ResultDetail": null
    },
    {
      "Name": "MT.1030: Eligible role assignments on Control Plane are in use by administrators.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1030",
      "Tag": [
        "Privileged",
        "Security",
        "All",
        "MT.1030"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        if ( ( Get-MtLicenseInformation EntraID ) -ne \"P2\" ) {\r\n            Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n        } else {\r\n            $Check = Test-MtPimAlertsExists -AlertId \"RedundantAssignmentAlert\" -FilteredAccessLevel \"ControlPlane\"\r\n            $check.numberOfAffectedItems -eq \"0\" | Should -Be $true -Because $check.securityImpact\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because Users that have been assigned privileged roles they don't need increases the chance of an attack. It is also easier for attackers to remain unnoticed in accounts that are not actively being used., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because Users that have been assigned privileged roles they don't need increases the chance of an attack. It is also easier for attackers to remain unnoticed in accounts that are not actively being used., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
            "Line": "38",
            "LineText": "            $check.numberOfAffectedItems -eq \"0\" | Should -Be $true -Because $check.securityImpact",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1: line 38\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Privileged Identity Management (PIM) - Alerts",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "31 user(s) haven't activated their privileged roles in the past 30 days\n\n\r\n  -  Benoît Rioux with Global Administrator by AssigneeId ed54b1c4-029c-47a5-8017-2696fbfd6207\n   -  Xavier Landry-Lemieux with User Administrator by AssigneeId 585831d0-f2e1-4469-bc3e-f39ca1251bf9\n   -  Gabriel Tessier with Azure AD Joined Device Local Administrator by AssigneeId 64f1291a-7b5b-4ca4-877b-ded034e94881\n   -  Almighty Admin with Billing Administrator by AssigneeId 9edf6b7c-8a6a-42ce-abc7-f606038ebb76\n   -  Charles Hamilton with Application Administrator by AssigneeId 60558184-891f-4f15-b6e5-9c407d0aeb43\n   -  Marc-Antoine Hébert with Application Administrator by AssigneeId 344c2ae8-9a84-456c-885e-dcb1c93bfded\n   -  Michael Labrecque with Application Administrator by AssigneeId b12410e3-644e-44b7-8cc0-550780ab5403\n   -  François Besson with Application Administrator by AssigneeId e2868788-5b11-44fd-a6f1-7886f71795f1\n   -  Dany Abi Nassif with Application Administrator by AssigneeId 10fe52aa-c59e-42d0-8bde-78877376fa32\n   -  Anthony Thurel with Application Administrator by AssigneeId dbf3b44e-a607-4c4b-a637-7faef6e89aac\n   -  Benoît Rioux with Application Administrator by AssigneeId ed54b1c4-029c-47a5-8017-2696fbfd6207\n   -  Maxim Roger with Security Reader by AssigneeId b12c5f4c-f07e-4bbd-abc1-1e8178f0fa73\n   -  Arnaud Landry with Security Reader by AssigneeId c4d9703c-72ab-43de-afd3-3d99566e316c\n   -  Philippe Darveau with Security Reader by AssigneeId 9ddda072-1bdd-4e62-89d5-48b70456ae48\n   -  Ricardo Eugene with Security Reader by AssigneeId d3763c58-f080-4961-a0b6-58ed7e1a433c\n   -  Emmanuel Fernandes-Domingues with Application Administrator by AssigneeId 6ef68a27-b85c-4a08-9488-ee2cda3ccaa8\n   -  Xavier Landry-Lemieux with Application Administrator by AssigneeId 585831d0-f2e1-4469-bc3e-f39ca1251bf9\n   -  Martin Desrosiers with Application Administrator by AssigneeId 07fa22e7-2149-4187-b197-ffccd05c2794\n   -  Jordan Michallet with Security Reader by AssigneeId bcdfcd7e-357d-47fc-9774-6adebd9046d4\n   -  Dany Abi Nassif with Security Reader by AssigneeId 10fe52aa-c59e-42d0-8bde-78877376fa32\n   -  Arnaud Landry (Test) with Security Reader by AssigneeId 8b782aa3-b4d4-4d42-9d8d-970536d8c335\n   -  Robin Penrat with Security Reader by AssigneeId 56b668b2-b33f-4bc4-be52-c2baf7e51e1f\n   -  Charles Hamilton with Security Administrator by AssigneeId 60558184-891f-4f15-b6e5-9c407d0aeb43\n   -  Etienne côté with Security Administrator by AssigneeId bf639425-f943-4c90-9717-a7980485bbc4\n   -  Robin Penrat with Security Administrator by AssigneeId 56b668b2-b33f-4bc4-be52-c2baf7e51e1f\n   -  Anthony Thurel with Security Administrator by AssigneeId dbf3b44e-a607-4c4b-a637-7faef6e89aac\n   -  François Besson with Security Administrator by AssigneeId e2868788-5b11-44fd-a6f1-7886f71795f1\n   -  Jacquelin Martineau-Rousseau with Security Administrator by AssigneeId 99f3d5a4-dba8-4207-ae40-05eac82deed3\n   -  Bénédict Brossard with Security Administrator by AssigneeId f9f3de36-7958-42d6-80a0-08742b9e3ded\n   -  Benoît Rioux with Security Administrator by AssigneeId ed54b1c4-029c-47a5-8017-2696fbfd6207\n   -  Arnaud Landry with Security Administrator by AssigneeId c4d9703c-72ab-43de-afd3-3d99566e316c\n   -  Philippe Darveau with Security Administrator by AssigneeId 9ddda072-1bdd-4e62-89d5-48b70456ae48\n   -  Yoan Schinck with Security Administrator by AssigneeId 38b05075-df3b-49ec-91e2-5189a1256f73\n   -  Réjean Thiboutot with Security Administrator by AssigneeId ee3bdff8-834d-4635-9d47-5897d3f4c927\n   -  Ricardo Eugene with Security Administrator by AssigneeId d3763c58-f080-4961-a0b6-58ed7e1a433c\n   -  ×º°”˜”°º×_Gabriel_Chabot_×º°”˜”°º× with Intune Administrator by AssigneeId a4bc4fb4-0224-4770-8f0f-4b36af2ce00e\n   -  Anthony Thurel with Intune Administrator by AssigneeId dbf3b44e-a607-4c4b-a637-7faef6e89aac\n   -  Jacquelin Martineau-Rousseau with Cloud Device Administrator by AssigneeId 99f3d5a4-dba8-4207-ae40-05eac82deed3\n   -  Jacquelin Martineau-Rousseau with Authentication Administrator by AssigneeId 99f3d5a4-dba8-4207-ae40-05eac82deed3\n   -  Réjean Thiboutot with Security Operator by AssigneeId ee3bdff8-834d-4635-9d47-5897d3f4c927\n   -  Kari Tontarski with Security Operator by AssigneeId 7619f842-51f2-4efd-8fbd-875af7455f52\n   -  Bruno Philippe with Security Reader by AssigneeId 2e6ab899-c628-4729-ae52-d4ba63b7fdf1\n   -  Gabriel Tessier with Security Administrator by AssigneeId 64f1291a-7b5b-4ca4-877b-ded034e94881\n   -  Jean-Francois Charette with Security Administrator by AssigneeId 046cb730-edea-41e8-8595-ef9150a81765\n   -  Xavier Landry-Lemieux with Security Administrator by AssigneeId 585831d0-f2e1-4469-bc3e-f39ca1251bf9\n   -  Xavier Landry-Lemieux with Intune Administrator by AssigneeId 585831d0-f2e1-4469-bc3e-f39ca1251bf9\n   -  Marc-Antoine Hébert with Intune Administrator by AssigneeId 344c2ae8-9a84-456c-885e-dcb1c93bfded\n   -  Almighty Admin with Cloud Application Administrator by AssigneeId 9edf6b7c-8a6a-42ce-abc7-f606038ebb76\n   -  Marc-Antoine Hébert with Compliance Data Administrator by AssigneeId 344c2ae8-9a84-456c-885e-dcb1c93bfded\n   -  François Painchaud-Tremblay with Security Operator by AssigneeId 002f2cec-e603-45f1-a415-d4f607865c31\n   -  Arnaud Landry with Global Reader by AssigneeId c4d9703c-72ab-43de-afd3-3d99566e316c\n   -  Philippe Darveau with Global Reader by AssigneeId 9ddda072-1bdd-4e62-89d5-48b70456ae48\n   -  Michael Labrecque with Global Reader by AssigneeId b12410e3-644e-44b7-8cc0-550780ab5403\n   -  Andrei Kravtchenko with Global Reader by AssigneeId bb33a4d9-02bd-47dd-b78c-b96bcb6cf478\n   -  Xavier Landry-Lemieux with Global Reader by AssigneeId 585831d0-f2e1-4469-bc3e-f39ca1251bf9\n   -  Michael Labrecque with Groups Administrator by AssigneeId b12410e3-644e-44b7-8cc0-550780ab5403\n   -  Anthony Thurel with Hybrid Identity Administrator by AssigneeId dbf3b44e-a607-4c4b-a637-7faef6e89aac\n   -  Jacquelin Martineau-Rousseau with Authentication Policy Administrator by AssigneeId 99f3d5a4-dba8-4207-ae40-05eac82deed3\n\r\nGet more details from the PIM alert [Eligible administrators aren't activating their privileged role](https://portal.azure.com/#view/Microsoft_Azure_PIMCommon/AlertDetail/providerId/aadroles/alertId/RedundantAssignmentAlert/resourceId/a6014805-994d-45e8-98ef-306a7e2e2139) in the Azure Portal.\r\n",
        "TestDescription": "\r\n\r\n**Security Impact**\n\n\r\nUsers that have been assigned privileged roles they don't need increases the chance of an attack. It is also easier for attackers to remain unnoticed in accounts that are not actively being used.\r\n\r\n**Mitigation steps**\n\n\r\nReview the users in the list and remove them from privileged roles they do not need.\r\n\r\n**How to prevent**\n\n\r\n·Assign privileged roles to users that have a business justification.\r\n·Schedule regular access reviews to verify that users still need their access.\r\n"
      }
    },
    {
      "Name": "MT.1031: Privileged role on Control Plane are managed by PIM only.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1031",
      "Tag": [
        "Privileged",
        "Security",
        "All",
        "MT.1031"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        if ( ( Get-MtLicenseInformation EntraID ) -ne \"P2\" ) {\r\n            Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n        } else {\r\n            $Check = Test-MtPimAlertsExists -AlertId \"RolesAssignedOutsidePimAlert\" -FilteredAccessLevel \"ControlPlane\"\r\n            $check.numberOfAffectedItems -eq \"0\" | Should -Be $true -Because $check.securityImpact\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "ErrorRecord": "You cannot call a method on a null-valued expression.",
            "WasThrownFromThrowStatement": false,
            "TargetSite": "Void CheckActionPreference(System.Management.Automation.Language.FunctionContext, System.Exception)",
            "Message": "You cannot call a method on a null-valued expression.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": "System.Management.Automation",
            "HResult": -2146233087,
            "StackTrace": "   at System.Management.Automation.ExceptionHandlingOps.CheckActionPreference(FunctionContext funcContext, Exception exception)\r\n   at <ScriptBlock>(Closure, FunctionContext)\r\n   at System.Management.Automation.ScriptBlock.InvokeWithPipeImpl(ScriptBlockClauseToInvoke clauseToInvoke, Boolean createLocalScope, Dictionary`2 functionsToDefine, List`1 variablesToDefine, ErrorHandlingBehavior errorHandlingBehavior, Object dollarUnder, Object input, Object scriptThis, Pipe outputPipe, InvocationInfo invocationInfo, Object[] args)\r\n   at System.Management.Automation.ScriptBlock.InvokeWithPipe(Boolean useLocalScope, ErrorHandlingBehavior errorHandlingBehavior, Object dollarUnder, Object input, Object scriptThis, Pipe outputPipe, InvocationInfo invocationInfo, Boolean propagateAllExceptionsToTop, List`1 variablesToDefine, Dictionary`2 functionsToDefine, Object[] args)\r\n   at Microsoft.PowerShell.Commands.ForEachObjectCommand.ProcessScriptBlockParameterSet()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()"
          },
          "TargetObject": null,
          "CategoryInfo": {
            "Category": 7,
            "Activity": "ForEach-Object",
            "Reason": "RuntimeException",
            "TargetName": "",
            "TargetType": ""
          },
          "FullyQualifiedErrorId": "InvokeMethodOnNull,Microsoft.PowerShell.Commands.ForEachObjectCommand",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": "ForEach-Object",
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 46,
            "OffsetInLine": 56,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1",
            "Line": "    $AffectedRoleAssignments = $Alert.additionalData | ForEach-Object {\r\n",
            "Statement": "ForEach-Object {\r\n      $CurrentItem = $_.item\r\n      $result = New-Object psobject\r\n      foreach ($entry in $CurrentItem.GetEnumerator()) {\r\n        $result | Add-Member -MemberType NoteProperty -Name $entry.key -Value $entry.value -Force\r\n      }\r\n      $result\r\n    }",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1:46 char:56\r\n+ …   $AffectedRoleAssignments = $Alert.additionalData | ForEach-Object {\r\n+                                                        ~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1",
            "InvocationName": "ForEach-Object",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1: line 49\r\nat Test-MtPimAlertsExists<Process>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1: line 46\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1: line 45\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Privileged Identity Management (PIM) - Alerts",
      "ResultDetail": null
    },
    {
      "Name": "MT.1032: Limited number of Global Admins are assigned.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1032",
      "Tag": [
        "Privileged",
        "Security",
        "All",
        "MT.1032"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        if ( ( Get-MtLicenseInformation EntraID ) -ne \"P2\" ) {\r\n            Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP2\r\n        } else {\r\n            $Check = Test-MtPimAlertsExists -AlertId \"TooManyGlobalAdminsAssignedToTenantAlert\"\r\n            $check.numberOfAffectedItems -eq \"0\" | Should -Be $true -Because $check.securityImpact\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "ErrorRecord": "You cannot call a method on a null-valued expression.",
            "WasThrownFromThrowStatement": false,
            "TargetSite": "Void CheckActionPreference(System.Management.Automation.Language.FunctionContext, System.Exception)",
            "Message": "You cannot call a method on a null-valued expression.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": "System.Management.Automation",
            "HResult": -2146233087,
            "StackTrace": "   at System.Management.Automation.ExceptionHandlingOps.CheckActionPreference(FunctionContext funcContext, Exception exception)\r\n   at <ScriptBlock>(Closure, FunctionContext)\r\n   at System.Management.Automation.ScriptBlock.InvokeWithPipeImpl(ScriptBlockClauseToInvoke clauseToInvoke, Boolean createLocalScope, Dictionary`2 functionsToDefine, List`1 variablesToDefine, ErrorHandlingBehavior errorHandlingBehavior, Object dollarUnder, Object input, Object scriptThis, Pipe outputPipe, InvocationInfo invocationInfo, Object[] args)\r\n   at System.Management.Automation.ScriptBlock.InvokeWithPipe(Boolean useLocalScope, ErrorHandlingBehavior errorHandlingBehavior, Object dollarUnder, Object input, Object scriptThis, Pipe outputPipe, InvocationInfo invocationInfo, Boolean propagateAllExceptionsToTop, List`1 variablesToDefine, Dictionary`2 functionsToDefine, Object[] args)\r\n   at Microsoft.PowerShell.Commands.ForEachObjectCommand.ProcessScriptBlockParameterSet()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()"
          },
          "TargetObject": null,
          "CategoryInfo": {
            "Category": 7,
            "Activity": "ForEach-Object",
            "Reason": "RuntimeException",
            "TargetName": "",
            "TargetType": ""
          },
          "FullyQualifiedErrorId": "InvokeMethodOnNull,Microsoft.PowerShell.Commands.ForEachObjectCommand",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": "ForEach-Object",
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 46,
            "OffsetInLine": 56,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1",
            "Line": "    $AffectedRoleAssignments = $Alert.additionalData | ForEach-Object {\r\n",
            "Statement": "ForEach-Object {\r\n      $CurrentItem = $_.item\r\n      $result = New-Object psobject\r\n      foreach ($entry in $CurrentItem.GetEnumerator()) {\r\n        $result | Add-Member -MemberType NoteProperty -Name $entry.key -Value $entry.value -Force\r\n      }\r\n      $result\r\n    }",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1:46 char:56\r\n+ …   $AffectedRoleAssignments = $Alert.additionalData | ForEach-Object {\r\n+                                                        ~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1",
            "InvocationName": "ForEach-Object",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1: line 49\r\nat Test-MtPimAlertsExists<Process>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtPimAlertsExists.ps1: line 46\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-PrivilegedAssignments.Tests.ps1: line 53\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Privileged Identity Management (PIM) - Alerts",
      "ResultDetail": null
    },
    {
      "Name": "MT.1035: All security groups assigned to Conditional Access Policies should be protected by RMAU.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1035",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1035"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaGroupsRestricted | Should -Be $true -Because \"there are one or more policies without protection of included or excluded groups\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there are one or more policies without protection of included or excluded groups, but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there are one or more policies without protection of included or excluded groups, but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "60",
            "LineText": "        Test-MtCaGroupsRestricted | Should -Be $true -Because \"there are one or more policies without protection of included or excluded groups\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 60\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "These security groups with assignments in Conditional Access are not protected by Restricted Management Admin Units or Role Assignable groups.\n\n#### Impacted Conditional Access Policies\n\n | Security Group | Condition | Policy name | \n| --- | --- | --- |\n| [All Share Mailbox](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/GroupDetailsMenuBlade/~/Overview/groupId/887924a6-df6b-45eb-b809-97b673cbaa6d) | include | [[SharePoint admin center]Block access from apps on unmanaged devices - 2025/02/25](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/919a76a4-a289-4352-9100-bcaf21938401) | \n| [All Share Mailbox](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/GroupDetailsMenuBlade/~/Overview/groupId/887924a6-df6b-45eb-b809-97b673cbaa6d) | exclude | [[SharePoint admin center]Use app-enforced Restrictions for browser access - 2025/02/25](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f3972dfb-eeeb-46b9-9429-892990c74cd4) | \n| [MCSS](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/GroupDetailsMenuBlade/~/Overview/groupId/427b15c0-b9ce-4ee8-a125-ff7470f33264) | exclude | [06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f92ab61f-ba58-45d4-a454-a352f0c8f721) | \n| [MCSS](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/GroupDetailsMenuBlade/~/Overview/groupId/427b15c0-b9ce-4ee8-a125-ff7470f33264) | exclude | [07_BLOCK_ALL-USERS_MICROSOFT-ADMIN-PORTALS_EXCEPT_ADMIN](https://entra.microsoft.com/#view/Microsoft_AAD_ConditionalAccess/PolicyBlade/policyId/f493d0f5-bd0d-4a0c-9a00-e5f588abe751) | \n",
        "TestDescription": ""
      }
    },
    {
      "Name": "MT.1036: All excluded objects should have a fallback include in another policy.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1036",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1036",
        "Warning"
      ],
      "Result": "Failed",
      "ScriptBlock": "\r\n        Test-MtCaGap | Should -Be $true -Because \"there are one or more objects excluded without a corresponding fallback in another policy.\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "Expected $true, because there are one or more objects excluded without a corresponding fallback in another policy., but got $false.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "Expected $true, because there are one or more objects excluded without a corresponding fallback in another policy., but got $false.",
            "File": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
            "Line": "63",
            "LineText": "        Test-MtCaGap | Should -Be $true -Because \"there are one or more objects excluded without a corresponding fallback in another policy.\"",
            "Terminating": true,
            "ShouldResult": "Pester.ShouldResult"
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterAssertionFailed",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 8250,
            "OffsetInLine": 13,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "            throw $errorRecord\r\n",
            "Statement": "throw $errorRecord",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:8250 char:13\r\n+             throw $errorRecord\r\n+             ~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Invoke-Assertion, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8250\r\nat Should<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 8189\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 63\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "The following user objects did not have a fallback:\n\n    - 9edf6b7c-8a6a-42ce-abc7-f606038ebb76\n\n        - Excluded in policy 'CAAC - Test'\n\n        - Excluded in policy '02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '03_SESSION_DURATION_30-DAYS_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '14_REQUIRE_PASSWORD-RESET_HIGH-USER-RISK_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '01_REQUIRE_MFA_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '05_REQUIRE_MAM_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '04_REQUIRE_COMPLIANT-DEVICE_TEST-USERS_ALL-APPS'\n\n        - Excluded in policy '08_BLOCK_ALL-GUESTS_ALL-APPS_EXCEPT_O365'\n\n        - Excluded in policy '09_BLOCK_ALL-LOCATIONS_SERVICE-ACCOUNT_EXCEPT_SPECIFIC-IP'\n\n    - 7a607eec-319a-491f-827a-9ebbb2d37c43\n\n        - Excluded in policy 'CAAC - Test'\n\n        - Excluded in policy '02_BLOCK_LEGACY-AUTH_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '12_REQUIRE_MFA_LOW_&_MEDIUM_USER-RISK_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '03_SESSION_DURATION_30-DAYS_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '14_REQUIRE_PASSWORD-RESET_HIGH-USER-RISK_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '01_REQUIRE_MFA_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '13_REQUIRE_MFA_SIGN-IN-RISK_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '05_REQUIRE_MAM_ALL-USERS_ALL-APPS'\n\n        - Excluded in policy '04_REQUIRE_COMPLIANT-DEVICE_TEST-USERS_ALL-APPS'\n\n        - Excluded in policy '08_BLOCK_ALL-GUESTS_ALL-APPS_EXCEPT_O365'\n\n        - Excluded in policy '09_BLOCK_ALL-LOCATIONS_SERVICE-ACCOUNT_EXCEPT_SPECIFIC-IP'\n\n    - 1fb6d0cf-0a0d-4ac6-a5d0-5b543309f40b\n\n        - Excluded in policy '01_REQUIRE_MFA_ALL-USERS_ALL-APPS'\n\nThe following group objects did not have a fallback:\n\n    - 427b15c0-b9ce-4ee8-a125-ff7470f33264\n\n        - Excluded in policy '06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS'\n\nThe following application objects did not have a fallback:\n\n    - 2793995e-0a7d-40d7-bd35-6968ba142197\n\n        - Excluded in policy '08_BLOCK_ALL-GUESTS_ALL-APPS_EXCEPT_O365'\n\nThe following location objects did not have a fallback:\n\n    - 6292be6f-689b-4fd0-afbf-9239c7c324b0\n\n        - Excluded in policy '06_BLOCK_ALL-LOCATIONS_EXCEPT_APPROVED-COUNTRIES_ALL-USERS_ALL-APPS'\n\n    - AllTrusted\n\n        - Excluded in policy 'Microsoft-managed: Multifactor authentication for per-user multifactor authentication users'\n\n        - Excluded in policy '09_BLOCK_ALL-LOCATIONS_SERVICE-ACCOUNT_EXCEPT_SPECIFIC-IP'\n\n",
        "TestDescription": "All excluded objects should have a fallback include in another policy"
      }
    },
    {
      "Name": "MT.1038: Conditional Access policies should not include or exclude deleted groups.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1038",
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All",
        "MT.1038",
        "Warning"
      ],
      "Result": "Passed",
      "ScriptBlock": "\r\n        Test-MtCaReferencedGroupsExist | Should -Be $true -Because \"there are one or more policies relying on deleted groups.\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Conditional Access Baseline Policies",
      "ResultDetail": {
        "TestSkipped": "",
        "SkippedReason": null,
        "TestResult": "\r\n\r\nWell done! All Conditional Access policies are targeting active groups.\n\nNote: Names are not available for deleted groups. If the group was deleted in the last 30 days it may be available under [Entra admin centre - Deleted groups](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/GroupsManagementMenuBlade/~/DeletedGroups/menuId/DeletedGroups).\n\n",
        "TestDescription": "This test checks if there are any Conditional Access policies that target deleted security groups.\r\n\r\nThis usually happens when a group is deleted but is still referenced in a Conditional Access policy.\r\n\r\nDeleted groups in your policy can lead to unexpected gaps. This may result in Conditional Access policies not being applied to the users you intended or the policy not being applied at all.\r\n\r\nTo fix this issue:\r\n\r\n* Open the impacted Conditional access policy.\r\n* If the group is no longer needed, click Save to remove the referenced group from the policy.\r\n* If the group is still needed, update the policy to target a valid group.\r\n\r\n"
      }
    },
    {
      "Name": "CIS 1.2.2 (L1) Ensure sign-in to shared mailboxes is blocked",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.2.2",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisSharedMailboxSignIn\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"Sign ins are blocked for shared mailboxes\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSharedMailboxSignIn.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisSharedMailboxSignIn, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisSharedMailboxSignIn.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSharedMailboxSignIn.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "1.2.2 (L1) Ensure sign-in to shared mailboxes is blocked\r\n\r\nThe intent of the shared mailbox is the only allow delegated access from other mailboxes. An admin could reset the password, or an attacker could potentially gain access to the shared mailbox allowing the direct sign-in to the shared mailbox and subsequently the sending of email from a sender that does not have a unique identity. To prevent this, block sign-in for the account that is associated with the shared mailbox.\r\n\r\n#### Remediation action:\r\n\r\nBlock sign-in to shared mailboxes in the UI:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Click to expand **Teams & groups** and select **Shared mailboxes**.\r\n3. Take note of all shared mailboxes.\r\n4. Click to expand **Users** and select **Active users**.\r\n5. Select a shared mailbox account to open it's properties pane and then select **Block sign-in**.\r\n6. Check the box for Block this user from signing in.\r\n7. Repeat for any additional shared mailboxes.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 33](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 1.3.1 (L1) Ensure the 'Password expiration policy' is set to 'Set passwords to never expire (recommended)'",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.3.1",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisPasswordExpiry\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"passwords are not set to expire\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisPasswordExpiry.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Missing Scope Domain.Read.All",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Missing Scope Domain.Read.All",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisPasswordExpiry, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisPasswordExpiry.ps1: line 30\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisPasswordExpiry.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "Custom",
        "SkippedReason": "Missing Scope Domain.Read.All",
        "TestResult": "\r\nSkipped. Missing Scope Domain.Read.All",
        "TestDescription": "1.3.1 (L1) Ensure the 'Password expiration policy' is set to 'Set passwords to never expire (recommended)'\r\n\r\nOrganizations such as NIST and Microsoft have updated their password policy recommendations to not arbitrarily require users to change their passwords after a specific amount of time, unless there is evidence that the password is compromised, or the user forgot it.\r\n\r\n#### Remediation action:\r\n\r\nTo set Office 365 passwords are set to never expire:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Click to expand **Settings** select **Org Settings**.\r\n3. Click on **Security & privacy**.\r\n4. Check the **Set passwords to never expire (recommended)** box.\r\n5. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 37](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 1.3.3 (L2) Ensure 'External sharing' of calendars is not available",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.3.3",
        "L2",
        "CIS E3 Level 2",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisCalendarSharing\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"calendar sharing is disabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisCalendarSharing.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisCalendarSharing, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisCalendarSharing.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisCalendarSharing.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "1.3.3 (L2) Ensure 'External sharing' of calendars is not available\r\n\r\nAttackers often spend time learning about organizations before launching an attack. Publicly available calendars can help attackers understand organizational relationships and determine when specific users may be more vulnerable to an attack, such as when they are traveling.\r\n\r\n#### Remediation action:\r\n\r\nTo remediate using the UI:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Click to expand **Settings** select **Org settings**.\r\n3. In the **Services** section click **Calendar**.\r\n4. Uncheck **Let your users share their calendars with people outside of\r\nyour organization who have Office 365 or Exchange**.\r\n5. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 44](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 1.3.6 (L2) Ensure the customer lockbox feature is enabled",
      "HelpUrl": "",
      "Tag": [
        "CIS 1.3.6",
        "L2",
        "CIS E5 Level 2",
        "CIS E5",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisCustomerLockBox\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the customer lockbox feature is enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisCustomerLockBox.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisCustomerLockBox, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisCustomerLockBox.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisCustomerLockBox.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "1.3.6 (L2) Ensure the customer lockbox feature is enabled\r\n\r\nCustomer Lockbox is a security feature that provides an additional layer of control and transparency to customer data in Microsoft 365. Enabling this feature protects organizational data against data spillage and exfiltration.\r\n\r\nTest implementation checks Exchange Online service only.\r\n\r\n#### Remediation action:\r\n\r\nTo enable the Customer Lockbox feature:\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Click to expand **Settings** then select **Org settings**.\r\n3. Select **Security & privacy** tab.\r\n4. Click **Customer lockbox**.\r\n5. Check the box **Require approval for all data access requests**.\r\n6. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 52](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.1 (L2) Ensure Safe Links for Office Applications is Enabled (Only Checks Default Policy)",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.1",
        "L2",
        "CIS E5 Level 2",
        "CIS E5",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisSafeLink\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the default safe link policy matches CIS recommendations\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeLink.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisSafeLink, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisSafeLink.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeLink.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.1 (L2) Ensure Safe Links for Office Applications is Enabled\r\n\r\nSafe Links for Office applications extends phishing protection to documents and emails that contain hyperlinks, even after they have been delivered to a user.\r\n\r\n#### Remediation action:\r\n\r\nTo create a Safe Links policy:\r\n\r\n1. Navigate to Microsoft 365 admin center [https://admin.microsoft.com](https://admin.microsoft.com).\r\n2. Under **Email & collaboration** select **Policies & rules**\r\n3. Select **Threat policies** then **Safe Links**\r\n4. Click on **+Create**\r\n5. Name the policy then click **Next**\r\n6. In Domains select all valid domains for the organization and Next\r\n7. Ensure the following **URL & click protection settings** are defined:\r\n\r\n**Email**\r\n* Checked **On: Safe Links checks a list of known, malicious links when users click links in email. URLs are rewritten by default**\r\n* Checked **Apply Safe Links to email messages sent within the organization**\r\n* Checked **Apply real-time URL scanning for suspicious links and links that point to files**\r\n* Checked **Wait for URL scanning to complete before delivering the message**\r\n* Unchecked **Do not rewrite URLs, do checks via Safe Links API only**.\r\n\r\n**Teams**\r\n* Checked **On: Safe Links checks a list of known, malicious links when users click links in Microsoft Teams. URLs are not rewritten**.\r\n\r\n**Office 365 Apps**\r\n* Checked On: **Safe Links checks a list of known, malicious links when users click links in Microsoft Office apps. URLs are not rewritten**\r\n\r\n**Click protection settings**\r\n* Checked: **Track user clicks**\r\n* Unchecked: **Let users click through the original URL**\r\n* There is no recommendation for organization branding\r\n8. Click **Next** twice and finally Submit.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Admin Center](https://admin.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 61](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.2 (L1) Ensure the Common Attachment Types Filter is enabled (Only Checks Default Policy)",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.2",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisAttachmentFilter\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the default malware filter policy has the common attachment file filter is enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisAttachmentFilter.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisAttachmentFilter, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisAttachmentFilter.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisAttachmentFilter.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.2 (L1) Ensure the Common Attachment Types Filter is enabled\r\n\r\n**Rationale:**\r\nBlocking known malicious file types can help prevent malware-infested files from infecting a host.\r\n\r\n#### Remediation action:\r\n\r\nTo enable the Common Attachment Types Filter:\r\n1. Navigate to Microsoft 365 Defender [https://security.microsoft.com](https://security.microsoft.com).\r\n2. Click to expand **Email & collaboration** select **Policies & rules**.\r\n3. On the Policies & rules page select **Threat policies**.\r\n4. Under polices select **Anti-malware** and click on the **Default (Default)** policy.\r\n5. On the Policy page that appears on the right hand pane scroll to the bottom and click on **Edit protection settings**, check the **Enable the common attachments filter**.\r\n6. Click Save.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Defender](https://security.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 65](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.3 (L1) Ensure notifications for internal users sending malware is Enabled (Only Checks Default Policy)",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.3",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisInternalMalwareNotification\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the default malware filter policy has malware notifications enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisInternalMalwareNotification.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisInternalMalwareNotification, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisInternalMalwareNotification.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisInternalMalwareNotification.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.3 (L1) Ensure notifications for internal users sending malware is Enabled\r\n\r\n**Rationale:**\r\nThis setting alerts administrators that an internal user sent a message that contained malware. This may indicate an account or machine compromise that would need to be investigated.\r\n\r\n#### Remediation action:\r\n\r\nTo enable notifications for internal users sending malware:\r\n1. Navigate to Microsoft 365 Defender [https://security.microsoft.com](https://security.microsoft.com).\r\n2. Click to expand **E-mail & Collaboration** select **Policies & rules**.\r\n3. On the Policies & rules page select **Threat policies**.\r\n4. Under Policies select **Anti-malware**.\r\n5. Click on the **Default (Default)** policy.\r\n6. Click on **Edit protection settings** and change the settings for **Notify an admin about undelivered messages from internal senders** to **On** and enter the email address of the administrator who should be notified under **Administrator email address**.\r\n7. Click Save.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Defender](https://security.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 68](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.4 (L2) Ensure Safe Attachments policy is enabled (Only Checks Default Policy)",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.4",
        "L2",
        "CIS E5 Level 2",
        "CIS E5",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisSafeAttachment\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the default Safe Attachement policy matches CIS recommendations.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeAttachment.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisSafeAttachment, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisSafeAttachment.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeAttachment.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.4 (L2) Ensure Safe Attachments policy is enabled\r\n\r\n**Rationale:**\r\nEnabling Safe Attachments policy helps protect against malware threats in email attachments by analyzing suspicious attachments in a secure, cloud-based environment before they are delivered to the user's inbox. This provides an additional layer of security and can prevent new or unseen types of malware from infiltrating the organization's network.\r\n\r\n#### Remediation action:\r\n\r\nTo enable the Safe Attachments policy:\r\n1. Navigate to Microsoft 365 Defender [https://security.microsoft.com](https://security.microsoft.com).\r\n2. Click to expand **E-mail & Collaboration** select **Policies & rules**.\r\n3. On the Policies & rules page select **Threat policies**.\r\n4. Under **Policies** select **Safe Attachments**.\r\n5. Click + **Create**.\r\n6. Create a Policy Name and Description, and then click **Next**.\r\n7. Select all valid domains and click Next.\r\n8. Select **Block**.\r\n9. Quarantine policy is **AdminOnlyAccessPolicy**.\r\n10. Leave **Enable redirect** unchecked.\r\n11. Click **Next** and finally **Submit**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Defender](https://security.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 71](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.5 (L2) Ensure Safe Attachments for SharePoint, OneDrive, and Microsoft Teams is Enabled",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.5",
        "L2",
        "CIS E5 Level 2",
        "CIS E5",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisSafeAttachmentsAtpPolicy\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the Safe Attachement policies for SharePoint, OneDrive, and Microsoft Teams are Enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeAttachmentsAtpPolicy.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisSafeAttachmentsAtpPolicy, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisSafeAttachmentsAtpPolicy.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeAttachmentsAtpPolicy.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.5 (L2) Ensure Safe Attachments for SharePoint, OneDrive, and Microsoft Teams is Enabled\r\n\r\nDescription: Safe Attachments for SharePoint, OneDrive, and Microsoft Teams scans these services for malicious files.\r\n\r\n#### Remediation action:\r\n\r\nTo enable Safe Attachments for SharePoint, OneDrive, and Microsoft Teams:\r\n\r\n1. Navigate to Microsoft 365 Defender [https://security.microsoft.com](https://security.microsoft.com)\r\n2. Under **Email & collaboration** select **Policies & rules**\r\n3. Select **Threat policies** then **Safe Attachments**\r\n4. Click on **Global settings**\r\n5. Click to **Enable Turn on Defender for Office 365 for SharePoint, OneDrive, and Microsoft Teams**\r\n6. Click to **Enable Turn on Safe Documents for Office clients**\r\n7. Click to **Disable Allow people to click through Protected View even if Safe Documents identified the file as malicious**\r\n8. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Defender](https://security.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 73](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.6 (L1) Ensure Exchange Online Spam Policies are set to notify administrators (Only Checks Default Policy)",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.6",
        "L1",
        "CIS E3 Level 1",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisOutboundSpamFilterPolicy\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the default Exchange Online Spam policy is set to notify administrators.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisOutboundSpamFilterPolicy.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisOutboundSpamFilterPolicy, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisOutboundSpamFilterPolicy.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisOutboundSpamFilterPolicy.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.6 (L1) Ensure Exchange Online Spam Policies are set to notify administrators\r\n\r\nDescription: Configure Exchange Online Spam Policies to copy emails and notify someone when a sender in the organization has been blocked for sending spam emails.\r\n\r\n#### Remediation action:\r\n\r\nTo set the Exchange Online Spam Policies:\r\n\r\n1. Navigate to Microsoft 365 Defender [https://security.microsoft.com](https://security.microsoft.com)\r\n2. Under **Email & collaboration** select **Policies & rules**\r\n3. Select **Threat policies** then **Anti-spam**\r\n4. Click on the **Anti-spam outbound policy (default)**\r\n5. Select **Edit protection settings** then under **Notifications**\r\n6. Check **Send a copy of outbound messages that exceed these limits to these users and groups** then enter the desired email addresses\r\n7. Check **Notify these users and groups if a sender is blocked due to sending outbound spam** then enter the desired email addresses.\r\n8. Click **Save**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Defender](https://security.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 76](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "CIS 2.1.7 (L1) Ensure that an anti-phishing policy has been created (Only Checks Default Policy)",
      "HelpUrl": "",
      "Tag": [
        "CIS 2.1.7",
        "L1",
        "CIS E5 Level 1",
        "CIS E5",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisSafeAntiPhishingPolicy\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"the default anti-phishing policy is enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeAntiPhishingPolicy.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisSafeAntiPhishingPolicy, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cis\\Test-MtCisSafeAntiPhishingPolicy.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cis\\Test-MtCisSafeAntiPhishingPolicy.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CIS",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "2.1.7 (L1) Ensure that an anti-phishing policy has been created\r\n\r\nDescription: Set up anti-phishing polices to increase this protection, for example by refining\r\nsettings to better detect and prevent impersonation and spoofing attacks.\r\n\r\n#### Remediation action:\r\n\r\nTo enable Safe Attachments for SharePoint, OneDrive, and Microsoft Teams:\r\n\r\n1. Navigate to Microsoft 365 Defender [https://security.microsoft.com](https://security.microsoft.com)\r\n2. Under **Email & collaboration** select **Policies & rules**\r\n3. Select **Threat policies** then **Anti-Phishing**\r\n4. Select the **Office365 AntiPhish Default (Default)** policy and click **Edit protection settings**\r\n5. Set the **Phishing email threshold** to at least **2 - Aggressive**.\r\n\r\n#### Related links\r\n\r\n* [Microsoft 365 Defender](https://security.microsoft.com)\r\n* [CIS Microsoft 365 Foundations Benchmark v3.1.0 - Page 80](https://www.cisecurity.org/benchmark/microsoft_365)\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AF05: Authentication Method - FIDO2 security key - Restricted.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AF05",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF05"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\"\r\n            .keyRestrictions.aaGuids -notcontains $null -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AF05 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtEidscaAF05, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\internal\\eidsca\\Test-MtEidscaAF05.ps1: line 25\r\nat Test-MtEidscaControl, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\eidsca\\Test-MtEidscaControl.ps1: line 28\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 324\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - FIDO2 security key",
      "ResultDetail": {
        "TestSkipped": "Custom",
        "SkippedReason": "Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.",
        "TestResult": "\r\nSkipped. Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.\r\n",
        "TestDescription": "You can work with your Security key provider to determine the AAGuids of their devices for allowing or blocking usage.\r\n\r\n\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\r\n.keyRestrictions.aaGuids -notcontains $null -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [fido2AuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/fido2authenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AF06: Authentication Method - FIDO2 security key - Restrict specific keys.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AF06",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF06"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\"\r\n            .keyRestrictions.aaGuids -notcontains $null -and ($result.keyRestrictions.enforcementType -eq 'allow' -or $result.keyRestrictions.enforcementType -eq 'block') -eq 'true'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AF06 | Should -Be 'true'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtEidscaAF06, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\internal\\eidsca\\Test-MtEidscaAF06.ps1: line 25\r\nat Test-MtEidscaControl, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\eidsca\\Test-MtEidscaControl.ps1: line 28\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 333\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - FIDO2 security key",
      "ResultDetail": {
        "TestSkipped": "Custom",
        "SkippedReason": "Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.",
        "TestResult": "\r\nSkipped. Authentication method of FIDO2 security keys is not enabled and key restriction not enforced.\r\n",
        "TestDescription": "Defines if list of AADGUID will be used to allow or block registration.\r\n\r\nYou should use Block or Allow as value to allow- or blocklisting of AAGuids.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')\r\n.keyRestrictions.aaGuids -notcontains $null -and ($result.keyRestrictions.enforcementType -eq 'allow' -or $result.keyRestrictions.enforcementType -eq 'block') -eq 'true'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Fido2')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [fido2AuthenticationMethodConfiguration resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/fido2authenticationmethodconfiguration)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.AS04: Authentication Method - SMS - Use for sign-in.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.AS04",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AS04"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Sms')\"\r\n            .includeTargets.isUsableForSignIn -eq 'false'\r\n        #>\r\n        Test-MtEidscaControl -CheckId AS04 | Should -Be 'false'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Authentication method of Sms is not enabled.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Authentication method of Sms is not enabled.",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtEidscaAS04, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\internal\\eidsca\\Test-MtEidscaAS04.ps1: line 25\r\nat Test-MtEidscaControl, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\eidsca\\Test-MtEidscaControl.ps1: line 28\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 372\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Authentication Method - SMS",
      "ResultDetail": {
        "TestSkipped": "Custom",
        "SkippedReason": "Authentication method of Sms is not enabled.",
        "TestResult": "\r\nSkipped. Authentication method of Sms is not enabled.\r\n",
        "TestDescription": "Determines if users can use this authentication method to sign in to Microsoft Entra ID. true if users can use this method for primary authentication, otherwise false.\r\n\r\nAvoid to use SMS as primary sign in factor (instead of a password) and consider to implement a MFA or passwordless option also for your special user groups, such as front-line workers.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Sms')\r\n.includeTargets.isUsableForSignIn -eq 'false'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=policies/authenticationMethodsPolicy/authenticationMethodConfigurations('Sms')&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [phoneAuthenticationMethod resource type - Microsoft Graph v1.0 | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/phoneauthenticationmethod)\r\n\r\n\r\n"
      }
    },
    {
      "Name": "EIDSCA.CP01: Default Settings - Consent Policy Settings - Group owner consent for apps accessing data.",
      "HelpUrl": "https://maester.dev/docs/tests/EIDSCA.CP01",
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CP01"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        <#\r\n            Check if \"https://graph.microsoft.com/beta/settings\"\r\n            .values | where-object name -eq 'EnableGroupSpecificConsent' | select-object -expand value -eq 'False'\r\n        #>\r\n        Test-MtEidscaControl -CheckId CP01 | Should -Be 'False'\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Settings value is not available. This may be due to the change that this API is no longer available for recent created tenants.",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Settings value is not available. This may be due to the change that this API is no longer available for recent created tenants.",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtEidscaCP01, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\internal\\eidsca\\Test-MtEidscaCP01.ps1: line 25\r\nat Test-MtEidscaControl, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\eidsca\\Test-MtEidscaControl.ps1: line 28\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\EIDSCA\\Test-EIDSCA.Generated.Tests.ps1: line 94\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Default Settings - Consent Policy Settings",
      "ResultDetail": {
        "TestSkipped": "Custom",
        "SkippedReason": "Settings value is not available. This may be due to the change that this API is no longer available for recent created tenants.",
        "TestResult": "\r\nSkipped. Settings value is not available. This may be due to the change that this API is no longer available for recent created tenants.\r\n",
        "TestDescription": "Group and team owners can authorize applications, such as applications published by third-party vendors, to access your organization's data associated with a group. For example, a team owner in Microsoft Teams can allow an app to read all Teams messages in the team, or list the basic profile of a group's members.\r\n\r\nCISA SCuBA 2.7: Non-Admin Users SHALL Be Prevented From Providing Consent To Third-Party Applications.\r\n\r\n#### Test script\r\n```\r\nhttps://graph.microsoft.com/beta/settings\r\n.values | where-object name -eq 'EnableGroupSpecificConsent' | select-object -expand value -eq 'False'\r\n```\r\n\r\n#### Related links\r\n\r\n- [Open in Graph Explorer](https://developer.microsoft.com/en-us/graph/graph-explorer?request=settings&method=GET&version=beta&GraphUrl=https://graph.microsoft.com)\r\n- [directorySetting resource type - Microsoft Graph beta | Microsoft Learn](https://learn.microsoft.com/en-us/graph/api/resources/directorysetting)\r\n- [View in Microsoft Entra admin center](https://portal.azure.com/#view/Microsoft_AAD_IAM/ConsentPoliciesMenuBlade/~/UserSettings)\r\n\r\n"
      }
    },
    {
      "Name": "MS.AAD.4.1: Security logs SHALL be sent to the agency's security operations center for monitoring.",
      "HelpUrl": "",
      "Tag": [
        "MS.AAD",
        "MS.AAD.4.1",
        "CISA",
        "Security",
        "All",
        "Entra ID P1"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaDiagnosticSettings = Test-MtCisaDiagnosticSettings\r\n\r\n        if ($null -ne $cisaDiagnosticSettings) {\r\n            $cisaDiagnosticSettings | Should -Be $true -Because \"diagnostic settings are configured for all logs.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaDiagnosticSettings.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Azure. See [Connecting to Azure](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Azure. See [Connecting to Azure](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDiagnosticSettings, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\entra\\Test-MtCisaDiagnosticSettings.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\entra\\Test-MtCisaDiagnosticSettings.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedAzure",
        "SkippedReason": "Not connected to Azure. See [Connecting to Azure](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Azure. See [Connecting to Azure](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)\r\n",
        "TestDescription": "Security logs SHALL be sent to the agency's security operations center for monitoring.\r\n\r\nRationale: The security risk of not having visibility into cyber attacks is reduced by collecting logs in the agency’s centralized security detection infrastructure. This makes security events available for auditing, query, and incident response.\r\n\r\nNote: The following logs (configured in Entra diagnostic settings), are required: `AuditLogs`, `SignInLogs`, `RiskyUsers`, `UserRiskEvents`, `NonInteractiveUserSignInLogs`, `ServicePrincipalSignInLogs`, `ADFSSignInLogs`, `RiskyServicePrincipals`, `ServicePrincipalRiskEvents`, `EnrichedOffice365AuditLogs`, `MicrosoftGraphActivityLogs`. If managed identities are used for Azure resources, also send the `ManagedIdentitySignInLogs` log type. If the Entra ID Provisioning Service is used to provision users to software-as-a-service (SaaS) apps or other systems, also send the `ProvisioningLogs` log type.\r\n\r\nNote: Agencies can benefit from security detection capabilities offered by the CISA Cloud Log Aggregation Warehouse (CLAW) system. Agencies are urged to send the logs to CLAW. Contact CISA at cyberliason@cisa.dhs.gov to request integration instructions.\r\n\r\n#### Remediation action:\r\n\r\nFollow the configuration instructions unique to the products and integration patterns at your organization to send the security logs to the security operations center for monitoring.\r\n\r\n#### Related links\r\n\r\n* [CISA 4. Centralized Log Collection - MS.AAD.4.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/aad.md#msaad41v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/AADConfig.rego#L523)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.01.1: Automatic forwarding to external domains SHALL be disabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.1.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaAutoExternalForwarding = Test-MtCisaAutoExternalForwarding\r\n\r\n        if($null -ne $cisaAutoExternalForwarding) {\r\n            $cisaAutoExternalForwarding | Should -Be $true -Because \"auto forwarding is not enabled for any domains\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAutoExternalForwarding.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAutoExternalForwarding, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAutoExternalForwarding.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAutoExternalForwarding.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Automatic forwarding to external domains SHALL be disabled.\r\n\r\nRationale: Adversaries can use automatic forwarding to gain persistent access to a victim's email. Disabling forwarding to external domains prevents this technique when the adversary is external to the organization but does not impede legitimate internal forwarding.\r\n\r\n#### Remediation action:\r\n\r\nTo disable automatic forwarding to external domains:\r\n\r\n1. Sign in to the **Exchange admin center**.\r\n2. Select **Mail flow**, then **[Remote domains](https://admin.exchange.microsoft.com/#/remotedomains)**.\r\n3. Select **Default**.\r\n4. Under **Email reply types**, select **Edit reply types**.\r\n5. Clear the checkbox next to **Allow automatic forwarding**, then click **Save**.\r\n6. Return to **Remote domains** and repeat steps 4 and 5 for each additional remote domain in the list.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Remote domains](https://admin.exchange.microsoft.com/#/remotedomains)\r\n* [CISA 1 Automatic Forwarding to External Domains - MS.EXO.1.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo11v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L28)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.02.1: A list of approved IP addresses for sending mail SHALL be maintained.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.2.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaSpfRestriction = Test-MtCisaSpfRestriction\r\n\r\n        if ($null -ne $cisaSpfRestriction) {\r\n            $cisaSpfRestriction | Should -Be $true -Because \"SPF record should restrict authorized senders.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpfRestriction.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSpfRestriction, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSpfRestriction.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpfRestriction.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "A list of approved IP addresses for sending mail SHALL be maintained.\r\n\r\nRationale: Failing to maintain an accurate list of authorized IP addresses may result in spoofed email messages or failure to deliver legitimate messages when SPF is enabled. Maintaining such a list helps ensure that unauthorized servers sending spoofed messages can be detected, and permits message delivery from legitimate senders.\r\n\r\n#### Remediation action:\r\n\r\n* Identify any approved senders specific to your agency.\r\n* Perform regular review of SPF record and update as necessary.\r\n* Additionally, see [External DNS records required for SPF](https://learn.microsoft.com/en-us/microsoft-365/enterprise/external-domain-name-system-records?view=o365-worldwide#external-dns-records-required-for-spf) for inclusions required for Microsoft to send email on behalf of your domain.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Accepted domains](https://admin.exchange.microsoft.com/#/accepteddomains)\r\n* [CISA 2 Sender Policy Framework - MS.EXO.2.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo21v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L58)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.02.2: An SPF policy SHALL be published for each domain, designating only these addresses as approved senders.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.2.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaSpfDirective = Test-MtCisaSpfDirective\r\n\r\n        if ($null -ne $cisaSpfDirective) {\r\n            $cisaSpfDirective | Should -Be $true -Because \"SPF record should restrict authorized senders.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpfDirective.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSpfDirective, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSpfDirective.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpfDirective.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "An SPF policy SHALL be published for each domain, designating only these addresses as approved senders.\r\n\r\nRationale: An adversary may modify the `FROM` field of an email such that it appears to be a legitimate email sent by an agency, facilitating phishing attacks. Publishing an SPF policy for each agency domain mitigates forged `FROM` fields by providing a means for recipients to detect emails spoofed in this way. SPF is required for FCEB departments and agencies by Binding Operational Directive (BOD) 18-01, \"Enhance Email and Web Security\".\r\n\r\n#### Remediation action:\r\n\r\nSPF is not configured through the Exchange admin center, but rather via DNS records hosted by the agency's domain. Thus, the exact steps needed to set up SPF varies from agency to agency. See [Add or edit an SPF TXT record to help prevent email spam (Outlook, Exchange Online) | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/admin/get-help-with-domains/create-dns-records-at-any-dns-hosting-provider?view=o365-worldwide#add-or-edit-an-spf-txt-record-to-help-prevent-email-spam-outlook-exchange-online) for more details.\r\n\r\nTo test your SPF configuration, consider using a web-based tool, such as those listed under [How can I validate SPF records for my domain? | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/admin/setup/domains-faq?view=o365-worldwide#how-can-i-validate-spf-records-for-my-domain). Additionally, SPF records can be requested using the PowerShell tool `Resolve-DnsName`. For example:\r\n\r\n`Resolve-DnsName example.onmicrosoft.com txt`\r\n\r\nIf SPF is configured, you will see a response resembling `v=spf1 include:spf.protection.outlook.com -all` returned; though by necessity, the contents of the SPF policy may vary by agency. In this example, the SPF policy indicates the IP addresses listed by the policy for \"spf.protection.outlook.com\" are the only approved senders for \"example.onmicrosoft.com.\" These IPs can be determined via an additional SPF lookup, this time for \"spf.protection.outlook.com.\" Ensure the IP addresses listed as approved senders for your domain are those identified for MS.EXO.2.1v1. [See SPF TXT record syntax for Microsoft 365 | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-anti-spoofing?view=o365-worldwide#spf-txt-record-syntax-for-microsoft-365) for a more in-depth discussion of SPF record syntax.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Accepted domains](https://admin.exchange.microsoft.com/#/accepteddomains)\r\n* [CISA 2 Sender Policy Framework - MS.EXO.2.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo22v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L75)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.03.1: DKIM SHOULD be enabled for all domains.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.3.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaDkim = Test-MtCisaDkim\r\n\r\n        if ($null -ne $cisaDkim) {\r\n            $cisaDkim | Should -Be $true -Because \"DKIM record should exist and be configured.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDkim.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDkim, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDkim.ps1: line 25\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDkim.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "DKIM SHOULD be enabled for all domains.\r\n\r\nRationale: An adversary may modify the `FROM` field of an email such that it appears to be a legitimate email sent by an agency, facilitating phishing attacks. Enabling DKIM is another means for recipients to detect spoofed emails and verify the integrity of email content.\r\n\r\n#### Remediation action:\r\n\r\nTo enable DKIM, follow the instructions listed on [Steps to Create, enable and disable DKIM from Microsoft 365 Defender portal | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dkim-configure?view=o365-worldwide#steps-to-create-enable-and-disable-dkim-from-microsoft-365-defender-portal).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Email authentication settings](https://security.microsoft.com/authentication?viewid=DKIM)\r\n* [CISA 3 Sender Policy Framework - MS.EXO.3.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo31v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L107)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.04.1: A DMARC policy SHALL be published for every second-level domain.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.4.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaDmarcRecordExist = Test-MtCisaDmarcRecordExist\r\n\r\n        if ($null -ne $cisaDmarcRecordExist) {\r\n            $cisaDmarcRecordExist | Should -Be $true -Because \"DMARC record should exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDmarcRecordExist.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDmarcRecordExist, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDmarcRecordExist.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDmarcRecordExist.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "A DMARC policy SHALL be published for every second-level domain.\r\n\r\nRationale: Without a DMARC policy available for each domain, recipients may improperly handle SPF and DKIM failures, possibly enabling spoofed emails to reach end users' mailboxes. Publishing DMARC records at the second-level domain protects the second-level domains and all subdomains.\r\n\r\n#### Remediation action:\r\n\r\nDMARC is not configured through the Exchange admin center, but rather via DNS records hosted by the agency's domain. As such, implementation varies depending on how an agency manages its DNS records. See [Form the DMARC TXT record for your domain | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/email-authentication-dmarc-configure?view=o365-worldwide#step-4-form-the-dmarc-txt-record-for-your-domain) for Microsoft guidance.\r\n\r\nA DMARC record published at the second-level domain will protect all subdomains. In other words, a DMARC record published for `example.com` will protect both `a.example.com` and `b.example.com`, but a separate record would need to be published for `c.example.gov`.\r\n\r\nTo test your DMARC configuration, consider using one of many publicly available web-based tools. Additionally, DMARC records can be requested using the PowerShell tool `Resolve-DnsName`. For example:\r\n\r\n`Resolve-DnsName _dmarc.example.com txt`\r\n\r\nIf DMARC is configured, a response resembling `v=DMARC1; p=reject; pct=100; rua=mailto:reports@dmarc.cyber.dhs.gov, mailto:reports@example.com; ruf=mailto:reports@example.com` will be returned, though by necessity, the contents of the record will vary by agency. In this example, the policy indicates all emails failing the SPF/DKIM checks are to be rejected and aggregate reports sent to reports@dmarc.cyber.dhs.gov and reports@example.com. Failure reports will be sent to reports@example.com.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Accepted domains](https://admin.exchange.microsoft.com/#/accepteddomains)\r\n* [CISA 4 Domain-Based Message Authentication, Reporting, and Conformance (DMARC) - MS.EXO.4.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo41v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L147)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.04.2: The DMARC message rejection option SHALL be p=reject.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.4.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaDmarcRecordReject = Test-MtCisaDmarcRecordReject\r\n\r\n        if ($null -ne $cisaDmarcRecordReject) {\r\n            $cisaDmarcRecordReject | Should -Be $true -Because \"DMARC record policy should be reject.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDmarcRecordReject.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDmarcRecordReject, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDmarcRecordReject.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDmarcRecordReject.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The DMARC message rejection option SHALL be p=reject.\r\n\r\nRationale: Of the three policy options (i.e., none, quarantine, and reject), reject provides the strongest protection. Reject is the level of protection required by BOD 18-01 for FCEB departments and agencies.\r\n\r\n#### Remediation action:\r\n\r\n* See MS.EXO.4.1v1 Instructions for an overview of how to publish and check a DMARC record.\r\n* Ensure the record published includes p=reject.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Accepted domains](https://admin.exchange.microsoft.com/#/accepteddomains)\r\n* [CISA 4 Domain-Based Message Authentication, Reporting, and Conformance (DMARC) - MS.EXO.4.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo42v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L176)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.04.3: The DMARC point of contact for aggregate reports SHALL include reports@dmarc.cyber.dhs.gov.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.4.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $cisaDmarcAggregateCisa = Test-MtCisaDmarcAggregateCisa\r\n\r\n        if ($null -ne $cisaDmarcAggregateCisa) {\r\n            $cisaDmarcAggregateCisa | Should -Be $true -Because \"DMARC record includes proper aggregate target.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDmarcAggregateCisa.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDmarcAggregateCisa, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDmarcAggregateCisa.ps1: line 30\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDmarcAggregateCisa.Tests.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The DMARC point of contact for aggregate reports SHALL include `reports@dmarc.cyber.dhs.gov`.\r\n\r\nRationale: Email spoofing attempts are not inherently visible to domain owners. DMARC provides a mechanism to receive reports of spoofing attempts. Including reports@dmarc.cyber.dhs.gov as a point of contact for these reports gives CISA insight into spoofing attempts and is required by BOD 18-01 for FCEB departments and agencies.\r\n\r\n**Note: Only federal, executive branch, departments and agencies should include this email address in their DMARC record.**\r\n\r\n> For other organization's there are many services that offer managed DMARC analysis and reporting, though ensure you properly align your implementation with your organization's policies for data handling.\r\n\r\n#### Remediation action:\r\n\r\n* See MS.EXO.4.1v1 Instructions for an overview of how to publish and check a DMARC record.\r\n* Ensure the record published includes reports@dmarc.cyber.dhs.gov as one of the emails for the RUA field.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Accepted domains](https://admin.exchange.microsoft.com/#/accepteddomains)\r\n* [CISA 4 Domain-Based Message Authentication, Reporting, and Conformance (DMARC) - MS.EXO.4.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo43v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L207)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.05.1: SMTP AUTH SHALL be disabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.5.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaSmtpAuthentication = Test-MtCisaSmtpAuthentication\r\n\r\n        if ($null -ne $cisaSmtpAuthentication) {\r\n            $cisaSmtpAuthentication | Should -Be $true -Because \"SMTP Authentication is disabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSmtpAuthentication.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSmtpAuthentication, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSmtpAuthentication.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSmtpAuthentication.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "SMTP AUTH SHALL be disabled.\r\n\r\nRationale: SMTP AUTH is not used or needed by modern email clients. Therefore, disabling it as the global default conforms to the principle of least functionality.\r\n\r\n#### Remediation action:\r\n\r\n1. To disable SMTP AUTH for the organization:\r\n2. Sign in to the **Exchange admin center**.\r\n3. On the left hand pane, select [**Settings**](https://admin.exchange.microsoft.com/#/settings); then from the settings list, select **Mail Flow**.\r\n4. Make sure the setting **Turn off SMTP AUTH protocol for your organization** is checked.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Settings](https://admin.exchange.microsoft.com/#/settings)\r\n* [CISA 5 Simple Mail Transfer Protocol Authentication - MS.EXO.5.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo51v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L306)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.06.1: Contact folders SHALL NOT be shared with all domains.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.6.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaContactSharing = Test-MtCisaContactSharing\r\n\r\n        if($null -ne $cisaContactSharing) {\r\n            $cisaContactSharing | Should -Be $true -Because \"contact sharing is disabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaContactSharing.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaContactSharing, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaContactSharing.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaContactSharing.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Contact folders SHALL NOT be shared with all domains.\r\n\r\nRationale: Contact folders may contain information that should not be shared by default with all domains. Disabling sharing with all domains closes an avenue for data exfiltration while still allowing for specific legitimate use as needed.\r\n\r\n#### Remediation action:\r\n\r\nTo restrict sharing with all domains:\r\n1. Sign in to the **Exchange admin center**.\r\n2. On the left-hand pane under **Organization**, select **Sharing**.\r\n3. Select [**Individual Sharing**](https://admin.exchange.microsoft.com/#/individualsharing).\r\n4. For all existing policies, select the policy, then select **Manage domains**.\r\n5. For all sharing rules under all existing policies, ensure **Sharing with everyone** and **Anonymous** do not include ContactsSharing.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Individual Sharing](https://admin.exchange.microsoft.com/#/individualsharing)\r\n* [CISA 6 Calendar and Contact Sharing - MS.EXO.6.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo61v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L335)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.06.2: Calendar details SHALL NOT be shared with all domains.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.6.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaCalendarSharing = Test-MtCisaCalendarSharing\r\n\r\n        if($null -ne $cisaCalendarSharing) {\r\n            $cisaCalendarSharing | Should -Be $true -Because \"calendar sharing is disabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaCalendarSharing.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaCalendarSharing, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaCalendarSharing.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaCalendarSharing.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Calendar details SHALL NOT be shared with all domains.\r\n\r\nRationale: Calendar details may contain information that should not be shared by default with all domains. Disabling sharing with all domains closes an avenue for data exfiltration while still allowing for legitimate use as needed.\r\n\r\n#### Remediation action:\r\n\r\nTo restrict sharing with all domains:\r\n1. Sign in to the **Exchange admin center**.\r\n2. On the left-hand pane under **Organization**, select **Sharing**.\r\n3. Select [**Individual Sharing**](https://admin.exchange.microsoft.com/#/individualsharing).\r\n4. For all existing policies, select the policy, then select **Manage domains**.\r\n5. For all sharing rules under all existing policies, ensure **Sharing with everyone** and **Anonymous** do not include CalendarSharing.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Individual Sharing](https://admin.exchange.microsoft.com/#/individualsharing)\r\n* [CISA 6 Calendar and Contact Sharing - MS.EXO.6.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo62v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L368)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.07.1: External sender warnings SHALL be implemented.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.7.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaExternalSenderWarning = Test-MtCisaExternalSenderWarning\r\n\r\n        if ($null -ne $cisaExternalSenderWarning) {\r\n            $cisaExternalSenderWarning | Should -Be $true -Because \"external sender warning is set.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaExternalSenderWarning.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaExternalSenderWarning, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaExternalSenderWarning.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaExternalSenderWarning.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)\r\n",
        "TestDescription": "External sender warnings SHALL be implemented.\r\n\r\nRationale: Phishing is an ever-present threat. Alerting users when email originates from outside their organization can encourage them to exercise increased caution, especially if an email is one they expected from an internal sender.\r\n\r\n> ⚠️ WARNING: This test allows the use of a technical mechanism that differs from CISA's, though the outcome is the same.\r\n\r\n#### Remediation action:\r\n\r\n##### Option 1: Use external sender identification\r\n\r\nThis feature is only available for Outlook, Outlook for Mac, Outlook on the web, and Outlook for iOS and Android.\r\n\r\n1. Connect to Exchange Online using PowerShell module `ExchangeOnlineManagement`\r\n2. Enable the feature with the cmdlet `Set-ExternalInOutlook`\r\n\r\n```powershell\r\nConnect-ExchangeOnline\r\nSet-ExternalInOutlook -Enabled $true\r\n```\r\n\r\n##### Option 2: Prepend subject with \"[External]\"\r\n\r\nTo create a mail flow rule to produce external sender warnings:\r\n1. Sign in to the **Exchange admin center**.\r\n2. Under **Mail flow**, select [**Rules**](https://admin.exchange.microsoft.com/#/transportrules).\r\n3. Click the plus (+) button to create a new rule.\r\n4. Select **Modify messages…**.\r\n5. Give the rule an appropriate name.\r\n6. Under **Apply this rule if…**, select **The sender is external/internal**.\r\n7. Under **select sender location**, select **Outside the organization**, then click **OK**.\r\n8. Under **Do the following…**, select **Prepend the subject of the message with…**.\r\n9. Under **specify subject prefix**, enter a message such as \"[External]\" (without the quotation marks), then click **OK**.\r\n10. Click **Next**.\r\n11. Under **Choose a mode for this rule**, select **Enforce**.\r\n12. Leave the **Severity** as **Not Specified**.\r\n13. Leave the **Match sender address in message** as **Header** and click **Next**.\r\n14. Click **Finish** and then **Done**.\r\n15. The new rule will be disabled. Re-select the new rule to show its settings and slide the **Enable or disable rule** slider to the right until it shows as **Enabled**.\r\n\r\n#### Related links\r\n\r\n* [Exchange admin center - Mail Flow Rules](https://admin.exchange.microsoft.com/#/transportrules)\r\n* [CISA 7 External Sender Warnings - MS.EXO.7.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo71v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L405)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.08.1: A DLP solution SHALL be used.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.8.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaDlp = Test-MtCisaDlp\r\n\r\n        if ($null -ne $cisaDlp) {\r\n            $cisaDlp | Should -Be $true -Because \"DLP is enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlp.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDlp, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDlp.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlp.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "A DLP solution SHALL be used.\r\n\r\nRationale: Users may inadvertently disclose sensitive information to unauthorized individuals. A DLP solution may detect the presence of sensitive information in Exchange Online and block access to unauthorized entities.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to the **Microsoft Purview compliance portal**.\r\n2. Under the **Solutions** section, select **Data loss prevention**.\r\n3. Select [**Policies**](https://purview.microsoft.com/datalossprevention/policies) from the left menu.\r\n4. Select **Create policy**.\r\n5. From the **Categories** list, select **Custom**.\r\n6. From the **Templates** list, select **Custom policy** and then click **Next**.\r\n7. Edit the name and description of the policy if desired, then click **Next**.\r\n8. Under **Choose locations to apply the policy**, set **Status** to **On** for at least the Exchange email, OneDrive accounts, SharePoint sites, Teams chat and channel messages, and Devices locations, then click **Next**.\r\n9. Under **Define policy settings**, select **Create or customize advanced DLP rules**, and then click **Next**.\r\n10. Click **Create rule**. Assign the rule an appropriate name and description.\r\n11. Click **Add condition**, then **Content contains**.\r\n12. Click **Add**, then **Sensitive info types**.\r\n13. Add information types that protect information sensitive to the agency.\r\n\r\n    At a minimum, the agency should protect:\r\n    - Credit card numbers\r\n    - U.S. Individual Taxpayer Identification Numbers (ITIN)\r\n    - U.S. Social Security Numbers (SSN)\r\n    - All agency-defined PII and sensitive information\r\n\r\n14. Click **Add**.\r\n15. Under **Actions**, click **Add an action**.\r\n16. Check **Restrict Access or encrypt the content in Microsoft 365 locations**.\r\n17. Under this action, select **Block Everyone**.\r\n18. Under **User notifications**, turn on **Use notifications to inform your users and help educate them on the proper use of sensitive info**.\r\n19. Under **Microsoft 365 services**, a section that appears after user notifications are turned on, check the box next to **Notify users in Office 365 service with a policy tip**.\r\n20. Click **Save**, then **Next**.\r\n21. Select **Turn it on right away**, then click **Next**.\r\n22. Click **Submit**.\r\n\r\n#### Related links\r\n\r\n* [Purview admin center - Data loss prevention policies](https://purview.microsoft.com/datalossprevention/policies)\r\n* [CISA 8 Data Loss Prevention Solutions - MS.EXO.8.1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo81v2)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L439)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.08.2: The DLP solution SHALL protect personally identifiable information (PII) and sensitive information, as defined by the agency.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.8.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaDlpPii = Test-MtCisaDlpPii\r\n\r\n        if ($null -ne $cisaDlpPii) {\r\n            $cisaDlpPii | Should -Be $true -Because \"DLP protects sensitive information.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlpPii.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDlpPii, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDlpPii.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlpPii.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The DLP solution SHALL protect personally identifiable information (PII) and sensitive information, as defined by the agency.\r\n\r\n> Reference your organization's policy defining PII.\r\n\r\nRationale: Users may inadvertently share sensitive information with others who should not have access to it. Data loss prevention policies provide a way for agencies to detect and prevent unauthorized disclosures.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to the **Microsoft Purview compliance portal**.\r\n2. Under the **Solutions** section, select **Data loss prevention**.\r\n3. Select [**Policies**](https://purview.microsoft.com/datalossprevention/policies) from the left menu.\r\n4. Select **Create policy**.\r\n5. From the **Categories** list, select **Custom**.\r\n6. From the **Templates** list, select **Custom policy** and then click **Next**.\r\n7. Edit the name and description of the policy if desired, then click **Next**.\r\n8. Under **Choose locations to apply the policy**, set **Status** to **On** for at least the Exchange email, OneDrive accounts, SharePoint sites, Teams chat and channel messages, and Devices locations, then click **Next**.\r\n9. Under **Define policy settings**, select **Create or customize advanced DLP rules**, and then click **Next**.\r\n10. Click **Create rule**. Assign the rule an appropriate name and description.\r\n11. Click **Add condition**, then **Content contains**.\r\n12. Click **Add**, then **Sensitive info types**.\r\n13. Add information types that protect information sensitive to the agency.\r\n\r\n    At a minimum, the agency should protect:\r\n    - Credit card numbers\r\n    - U.S. Individual Taxpayer Identification Numbers (ITIN)\r\n    - U.S. Social Security Numbers (SSN)\r\n    - All agency-defined PII and sensitive information\r\n\r\n14. Click **Add**.\r\n15. Under **Actions**, click **Add an action**.\r\n16. Check **Restrict Access or encrypt the content in Microsoft 365 locations**.\r\n17. Under this action, select **Block Everyone**.\r\n18. Under **User notifications**, turn on **Use notifications to inform your users and help educate them on the proper use of sensitive info**.\r\n19. Under **Microsoft 365 services**, a section that appears after user notifications are turned on, check the box next to **Notify users in Office 365 service with a policy tip**.\r\n20. Click **Save**, then **Next**.\r\n21. Select **Turn it on right away**, then click **Next**.\r\n22. Click **Submit**.\r\n\r\n#### Related links\r\n\r\n* [Purview admin center - Data loss prevention policies](https://purview.microsoft.com/datalossprevention/policies)\r\n* [CISA 8 Data Loss Prevention Solutions - MS.EXO.8.2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo82v2)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L438)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.08.3: The selected DLP solution SHOULD offer services comparable to the native DLP solution offered by Microsoft.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.8.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisa = Test-MtCisaDlpAlternate\r\n\r\n        if ($null -ne $cisa) {\r\n            $cisa | Should -Be $true -Because \"will not reach here.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlpAlternate.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDlpAlternate, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDlpAlternate.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlpAlternate.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The selected DLP solution SHOULD offer services comparable to the native DLP solution offered by Microsoft.\r\n\r\nRationale: Any alternative DLP solution should be able to detect sensitive information in Exchange Online and block access to unauthorized entities.\r\n\r\n> This test will always skip by default.\r\n\r\n#### Related links\r\n\r\n* [Purview admin center - Data loss prevention policies](https://purview.microsoft.com/datalossprevention/policies)\r\n* [CISA 8 Data Loss Prevention Solutions - MS.EXO.8.3](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo83v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L453)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.08.4: At a minimum, the DLP solution SHALL restrict sharing credit card numbers, U.S. Individual Taxpayer Identification Numbers (ITIN), and U.S. Social Security numbers (SSN) via email.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.8.4",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisa = Test-MtCisaDlpBaselineRule\r\n\r\n        if ($null -ne $cisa) {\r\n            $cisa | Should -Be $true -Because \"baseline DLP rules are in use.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlpBaselineRule.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaDlpBaselineRule, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaDlpBaselineRule.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaDlpBaselineRule.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "At a minimum, the DLP solution SHALL restrict sharing credit card numbers, U.S. Individual Taxpayer Identification Numbers (ITIN), and U.S. Social Security numbers (SSN) via email.\r\n\r\n> Reference your organization's policy defining restricted information.\r\n\r\nRationale: Users may inadvertently share sensitive information with others who should not have access to it. Data loss prevention policies provide a way for agencies to detect and prevent unauthorized disclosures.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to the **Microsoft Purview compliance portal**.\r\n2. Under the **Solutions** section, select **Data loss prevention**.\r\n3. Select [**Policies**](https://purview.microsoft.com/datalossprevention/policies) from the left menu.\r\n4. Select **Create policy**.\r\n5. From the **Categories** list, select **Custom**.\r\n6. From the **Templates** list, select **Custom policy** and then click **Next**.\r\n7. Edit the name and description of the policy if desired, then click **Next**.\r\n8. Under **Choose locations to apply the policy**, set **Status** to **On** for at least the Exchange email, OneDrive accounts, SharePoint sites, Teams chat and channel messages, and Devices locations, then click **Next**.\r\n9. Under **Define policy settings**, select **Create or customize advanced DLP rules**, and then click **Next**.\r\n10. Click **Create rule**. Assign the rule an appropriate name and description.\r\n11. Click **Add condition**, then **Content contains**.\r\n12. Click **Add**, then **Sensitive info types**.\r\n13. Add information types that protect information sensitive to the agency.\r\n\r\n    At a minimum, the agency should protect:\r\n    - Credit card numbers\r\n    - U.S. Individual Taxpayer Identification Numbers (ITIN)\r\n    - U.S. Social Security Numbers (SSN)\r\n    - All agency-defined PII and sensitive information\r\n\r\n14. Click **Add**.\r\n15. Under **Actions**, click **Add an action**.\r\n16. Check **Restrict Access or encrypt the content in Microsoft 365 locations**.\r\n17. Under this action, select **Block Everyone**.\r\n18. Under **User notifications**, turn on **Use notifications to inform your users and help educate them on the proper use of sensitive info**.\r\n19. Under **Microsoft 365 services**, a section that appears after user notifications are turned on, check the box next to **Notify users in Office 365 service with a policy tip**.\r\n20. Click **Save**, then **Next**.\r\n21. Select **Turn it on right away**, then click **Next**.\r\n22. Click **Submit**.\r\n\r\n#### Related links\r\n\r\n* [Purview admin center - Data loss prevention policies](https://purview.microsoft.com/datalossprevention/policies)\r\n* [CISA 8 Data Loss Prevention Solutions - MS.EXO.8.4](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo84v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L468)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.09.1: Emails SHALL be filtered by attachment file types.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.9.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAttachmentFilter\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"policies exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAttachmentFilter.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAttachmentFilter, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAttachmentFilter.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAttachmentFilter.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Emails SHALL be filtered by attachment file types.\r\n\r\nRationale: Malicious attachments often take the form of click-to-run files. Sharing high risk file types, when necessary, is better left to a means other than email; the dangers of allowing them to be sent over email outweigh any potential benefits. Filtering email attachments based on file types can prevent spread of malware distributed via click-to-run email attachments.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 9 Attachment File Type - MS.EXO.9.1v2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo91v2)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L487)\r\n* [Microsoft Learn - Common attachments filter in anti-malware policies](https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-about#common-attachments-filter-in-anti-malware-policies)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.09.2: The attachment filter SHOULD attempt to determine the true file type and assess the file extension.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.9.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAttachmentFileType\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"preset policies are enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAttachmentFileType.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAttachmentFileType, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAttachmentFileType.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAttachmentFileType.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The attachment filter SHOULD attempt to determine the true file type and assess the file extension.\r\n\r\nRationale: Users can change a file extension at the end of a file name (e.g., notepad.exe to notepad.txt) to obscure the actual file type. Verifying the file type and checking that this matches the designated file extension can help detect instances where the file extension was changed.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select [**Preset Security Policies**](https://security.microsoft.com/presetSecurityPolicies).\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 9 Attachment File Type - MS.EXO.9.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo92v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L502)\r\n* [Microsoft Learn - True type matching in the common attachments filter](https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-about#true-type-matching-in-the-common-attachments-filter)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.09.3: Disallowed file types SHALL be determined and enforced.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.9.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAttachmentFileType\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"preset policies are enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaBlockFileType.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAttachmentFileType, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAttachmentFileType.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaBlockFileType.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The attachment filter SHOULD attempt to determine the true file type and assess the file extension.\r\n\r\nRationale: Users can change a file extension at the end of a file name (e.g., notepad.exe to notepad.txt) to obscure the actual file type. Verifying the file type and checking that this matches the designated file extension can help detect instances where the file extension was changed.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select [**Preset Security Policies**](https://security.microsoft.com/presetSecurityPolicies).\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 9 Attachment File Type - MS.EXO.9.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo92v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L502)\r\n* [Microsoft Learn - True type matching in the common attachments filter](https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-about#true-type-matching-in-the-common-attachments-filter)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.09.4: Alternatively chosen filtering solutions SHOULD offer services comparable to Microsoft Defender's Common Attachment Filter.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.9.4",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaEmailFilterAlternative\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"should not pass.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaEmailFilterAlternative.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaEmailFilterAlternative, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaEmailFilterAlternative.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaEmailFilterAlternative.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Alternatively chosen filtering solutions SHOULD offer services comparable to Microsoft Defender's Common Attachment Filter.\r\n\r\nRationale: Malicious attachments often take the form of click-to-run files. Sharing high risk file types, when necessary, is better left to a means other than email; the dangers of allowing them to be sent over email outweigh any potential benefits. Filtering email attachments based on file types can prevent spread of malware distributed via click-to-run email attachments.\r\n\r\n> Note: This test will always result in a skip result.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 9 Attachment File Type - MS.EXO.9.4v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo94v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L532)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.09.5: At a minimum, click-to-run files SHOULD be blocked (e.g., .exe, .cmd, and .vbe).",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.9.5",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaBlockExecutable\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"preset policies are enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaBlockExecutable.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaBlockExecutable, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaBlockExecutable.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaBlockExecutable.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "At a minimum, click-to-run files SHOULD be blocked (e.g., .exe, .cmd, and .vbe).\r\n\r\nRationale: Malicious attachments often take the form of click-to-run files. Blocking a list of common executable files helps mitigate the risk of adversarial exploitation.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 9 Attachment File Type - MS.EXO.9.5v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo95v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L547)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.10.1: Emails SHALL be scanned for malware.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.10.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAttachmentFilter\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"malware scanning policy exists.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMalwareScan.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAttachmentFilter, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAttachmentFilter.ps1: line 23\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMalwareScan.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Emails SHALL be filtered by attachment file types.\r\n\r\nRationale: Malicious attachments often take the form of click-to-run files. Sharing high risk file types, when necessary, is better left to a means other than email; the dangers of allowing them to be sent over email outweigh any potential benefits. Filtering email attachments based on file types can prevent spread of malware distributed via click-to-run email attachments.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 9 Attachment File Type - MS.EXO.9.1v2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo91v2)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L487)\r\n* [Microsoft Learn - Common attachments filter in anti-malware policies](https://learn.microsoft.com/en-us/defender-office-365/anti-malware-protection-about#common-attachments-filter-in-anti-malware-policies)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.10.2: Emails identified as containing malware SHALL be quarantined or dropped.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.10.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaMalwareAction\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"policies exist.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMalwareAction.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaMalwareAction, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaMalwareAction.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMalwareAction.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Emails identified as containing malware SHALL be quarantined or dropped.\r\n\r\nRationale: Email can be used as a mechanism for delivering malware. Preventing emails with known malware from reaching user mailboxes helps ensure users cannot interact with those emails.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 10 Malware Scanning - MS.EXO.10.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo102v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L582)\r\n* [Microsoft Learn - Anatomy of a quarantine policy](https://learn.microsoft.com/en-us/defender-office-365/quarantine-policies#anatomy-of-a-quarantine-policy)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.10.3: Email scanning SHALL be capable of reviewing emails after delivery.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.10.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaMalwareZap\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"malware scanning policy exists.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMalwareZap.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaMalwareZap, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaMalwareZap.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMalwareZap.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Email scanning SHALL be capable of reviewing emails after delivery.\r\n\r\nRationale: As known malware signatures are updated, it is possible for an email to be retroactively identified as containing malware after delivery. By scanning emails, the number of malware-infected in users' mailboxes can be reduced.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 10 Malware Scanning - MS.EXO.10.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo103v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L597)\r\n* [Microsoft Learn - Zero-hour auto purge (ZAP) for malware](https://learn.microsoft.com/en-us/defender-office-365/zero-hour-auto-purge#zero-hour-auto-purge-zap-for-email-messages)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.11.1: Impersonation protection checks SHOULD be used.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.11.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaImpersonation\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"preset policies are enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaImpersonation.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaImpersonation, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaImpersonation.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaImpersonation.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Impersonation protection checks SHOULD be used.\r\n\r\nRationale: Users might not be able to reliably identify phishing emails, especially if the `FROM` address is nearly indistinguishable from that of a known entity. By automatically identifying senders who appear to be impersonating known senders, the risk of a successful phishing attempt can be reduced.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 11 Phishing Protections - MS.EXO.11.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo111v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L617)\r\n* [Microsoft Learn - Impersonation settings in anti-phishing policies in Microsoft Defender for Office 365](https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-policies-about#impersonation-settings-in-anti-phishing-policies-in-microsoft-defender-for-office-365)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.11.2: User warnings, comparable to the user safety tips included with EOP, SHOULD be displayed.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.11.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaImpersonationTip\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"preset policies are enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaImpersonationTip.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaImpersonationTip, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaImpersonationTip.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaImpersonationTip.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "User warnings, comparable to the user safety tips included with EOP, SHOULD be displayed.\r\n\r\nRationale: Many tasks are better suited for automated processes, such as identifying unusual characters in the `FROM` address or identifying a first-time sender. User warnings can handle these tasks, reducing the burden on end users and the risk of successful phishing attempts.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 11 Phishing Protections - MS.EXO.11.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo112v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L632)\r\n* [Microsoft Learn - Impersonation settings in anti-phishing policies in Microsoft Defender for Office 365](https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-policies-about#impersonation-settings-in-anti-phishing-policies-in-microsoft-defender-for-office-365)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.11.3: The phishing protection solution SHOULD include an AI-based phishing detection tool comparable to EOP Mailbox Intelligence.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.11.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaMailboxIntelligence\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"preset policies are enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMailboxIntelligence.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaMailboxIntelligence, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaMailboxIntelligence.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMailboxIntelligence.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "The phishing protection solution SHOULD include an AI-based phishing detection tool comparable to EOP Mailbox Intelligence.\r\n\r\nRationale: Phishing attacks can result in unauthorized data disclosure and unauthorized access. Using AI-based phishing detection tools to improve the detection rate of phishing attempts helps reduce the risk of successful phishing attacks.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 11 Phishing Protections - MS.EXO.11.3v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo113v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L647)\r\n* [Microsoft Learn - Mailbox intelligence impersonation protection](https://learn.microsoft.com/en-us/defender-office-365/anti-phishing-policies-about#mailbox-intelligence-impersonation-protection)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.12.1: IP allow lists SHOULD NOT be created.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.12.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaAntiSpamAllowList = Test-MtCisaAntiSpamAllowList\r\n\r\n        if ($null -ne $cisaAntiSpamAllowList) {\r\n            $cisaAntiSpamAllowList | Should -Be $true -Because \"no anti-spam policy allow IPs.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAntiSpamAllowList.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAntiSpamAllowList, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAntiSpamAllowList.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAntiSpamAllowList.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "IP allow lists SHOULD NOT be created.\r\n\r\nRationale: Messages sent from IP addresses on an allow list bypass important security mechanisms, including spam filtering and sender authentication checks. Avoiding use of IP allow lists prevents potential threats from circumventing security mechanisms.\r\n\r\n#### Remediation action:\r\n\r\nTo modify the connection filters, follow the instructions found in Use the Microsoft 365 Defender portal to modify the default connection filter policy.\r\n1. Sign in to **Microsoft 365 Defender portal**.\r\n2. From the left-hand menu, find **Email & collaboration** and select **Policies and Rules**.\r\n3. Select **Threat Policies** from the list of policy names.\r\n4. Under **Policies**, select [**Anti-spam**](https://security.microsoft.com/antispam).\r\n5. Select **Connection filter policy (Default)**.\r\n6. Click **Edit connection filter policy**.\r\n7. Ensure no addresses are specified under **Always allow messages from the following IP addresses or address range**.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Anti-spam policies](https://security.microsoft.com/antispam)\r\n* [CISA 12 IP Allow Lists - MS.EXO.12.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo121v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L683)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.12.2: Safe lists SHOULD NOT be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.12.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\n\n        $cisaAntiSpamSafeList = Test-MtCisaAntiSpamSafeList\n\n        if($null -ne $cisaAntiSpamSafeList) {\r\n            $cisaAntiSpamSafeList | Should -Be $true -Because \"Safe Lists should be disabled.\"\n        }\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAntiSpamSafeList.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAntiSpamSafeList, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAntiSpamSafeList.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAntiSpamSafeList.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Safe lists SHOULD NOT be enabled.\r\n\r\nRationale: Messages sent from allowed safe list addresses bypass important security mechanisms, including spam filtering and sender authentication checks. Avoiding use of safe lists prevents potential threats from circumventing security mechanisms. While blocking all malicious senders is not feasible, blocking specific known, malicious IP addresses may reduce the threat from specific senders.\r\n\r\n#### Remediation action:\r\n\r\nTo modify the connection filters, follow the instructions found in Use the Microsoft 365 Defender portal to modify the default connection filter policy.\r\n1. Sign in to **Microsoft 365 Defender portal**.\r\n2. From the left-hand menu, find **Email & collaboration** and select **Policies and Rules**.\r\n3. Select **Threat Policies** from the list of policy names.\r\n4. Under **Policies**, select [**Anti-spam**](https://security.microsoft.com/antispam).\r\n5. Select **Connection filter policy (Default)**.\r\n6. Click **Edit connection filter policy**.\r\n8. Ensure **Turn on safe list** is not selected.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Anti-spam policies](https://security.microsoft.com/antispam)\r\n* [CISA 12 IP Allow Lists - MS.EXO.12.2v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo122v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L710)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.13.1: Mailbox auditing SHALL be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.13.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $cisaMailboxAuditing = Test-MtCisaMailboxAuditing\r\n\r\n        if($null -ne $cisaMailboxAuditing) {\r\n            $cisaMailboxAuditing | Should -Be $true -Because \"mailbox auditing is enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMailboxAuditing.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaMailboxAuditing, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaMailboxAuditing.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaMailboxAuditing.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Mailbox auditing SHALL be enabled.\r\n\r\nRationale: Exchange Online user accounts can be compromised or misused. Enabling mailbox auditing provides a valuable source of information to detect and respond to mailbox misuse.\r\n\r\n#### Remediation action:\r\n\r\nMailbox auditing can be managed from the [Exchange Online PowerShell module](https://learn.microsoft.com/en-us/microsoft-365/compliance/audit-mailboxes?view=o365-worldwide). Follow the instructions listed on Manage mailbox auditing in Office 365.\r\n1. To enable mailbox auditing by default for your organization via PowerShell:\r\n2. Connect to the Exchange Online PowerShell.\r\n3. Run the following command:\r\n    `Set-OrganizationConfig –AuditDisabled $false`\r\n\r\n#### Related links\r\n\r\n* [Microsoft Learn - Mailbox Auditing](https://learn.microsoft.com/en-us/microsoft-365/compliance/audit-mailboxes?view=o365-worldwide)\r\n* [CISA 13 Mailbox Auditing - MS.EXO.13.1v1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo131v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L741)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.14.1: A spam filter SHALL be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.14.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSpamFilter\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"spam filter enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamFilter.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSpamFilter, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSpamFilter.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamFilter.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "A spam filter SHALL be enabled.\r\n\r\nRationale: Spam is a constant threat as junk mail can reduce user productivity, fill up mailboxes unnecessarily, and in some cases include malicious links or attachments. Filtering out spam reduces user workload burden, prevents junk mail congestion, and reduces potentially malicious content exposure.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select [**Preset Security Policies**](https://security.microsoft.com/presetSecurityPolicies).\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 14 Inbound Anti-Spam Protections - MS.EXO.14.1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo141v2)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L753)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.14.2: Spam and high confidence spam SHALL be moved to either the junk email folder or the quarantine folder.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.14.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSpamAction\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"spam filter enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamAction.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSpamAction, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSpamAction.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamAction.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Spam and high confidence spam SHALL be moved to either the junk email folder or the quarantine folder.\r\n\r\nRationale: Spam is a constant threat as junk mail can reduce user productivity, fill up mailboxes unnecessarily, and in some cases include malicious links or attachments. Moving spam messages to a separate junk or quarantine folder helps users filter out spam while still giving them the ability to review messages, as needed, in case a message is filtered incorrectly.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select [**Preset Security Policies**](https://security.microsoft.com/presetSecurityPolicies).\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 14 Inbound Anti-Spam Protections - MS.EXO.14.2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo142v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L768)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.14.3: Allowed domains SHALL NOT be added to inbound anti-spam protection policies.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.14.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSpamBypass\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"spam filter enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamBypass.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSpamBypass, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSpamBypass.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamBypass.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Allowed domains SHALL NOT be added to inbound anti-spam protection policies.\r\n\r\nRationale: Legitimate emails may be incorrectly filtered by spam protections. Adding allowed senders is an acceptable method of combating these false positives. Allowing an entire domain, especially a common domain like office.com, however, provides for a large number of potentially unknown users to bypass spam protections.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select [**Preset Security Policies**](https://security.microsoft.com/presetSecurityPolicies).\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 14 Inbound Anti-Spam Protections - MS.EXO.14.3](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo143v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L783)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.14.4: If a third-party party filtering solution is used, the solution SHOULD offer services comparable to the native spam filtering offered by Microsoft.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.14.4",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSpamAlternative\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"should not pass.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamAlternative.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSpamAlternative, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSpamAlternative.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSpamAlternative.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "If a third-party party filtering solution is used, the solution SHOULD offer services comparable to the native spam filtering offered by Microsoft.\r\n\r\nRationale: Spam is a constant threat as junk mail can reduce user productivity, fill up mailboxes unnecessarily, and in some cases include malicious links or attachments. Filtering out spam reduces user workload burden, prevents junk mail congestion, and reduces potentially malicious content exposure.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select [**Preset Security Policies**](https://security.microsoft.com/presetSecurityPolicies).\r\n5. Under **Standard protection**, slide the toggle switch to the right so the text next to the toggle reads **Standard protection is on**.\r\n6. Under **Strict protection**, slide the toggle switch to the right so the text next to the toggle reads **Strict protection is on**.\r\n\r\nNote: If the toggle slider in step 5 is grayed out, click on **Manage protection settings** instead and configure the policy settings according to [Use the Microsoft 365 Defender portal to assign Standard and Strict preset security policies to users | Microsoft Learn](https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide#use-the-microsoft-365-defender-portal-to-assign-standard-and-strict-preset-security-policies-to-users).\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 14 Inbound Anti-Spam Protections - MS.EXO.14.4](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo144v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L794)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.15.1: URL comparison with a block-list SHOULD be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.15.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSafeLink\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"safe link enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSafeLink.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSafeLink, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSafeLink.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSafeLink.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "URL comparison with a block-list SHOULD be enabled.\r\n\r\nRationale: Users may be directed to malicious websites via links in email. Blocking access to known, malicious URLs can prevent users from accessing known malicious websites.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under either **Standard protection** or **Strict protection**, select **Manage protection settings**.\r\n6. Select **Next** until you reach the **Apply Defender for Office 365 protection** page.\r\n7. On the **Apply Defender for Office 365 protection** page, select **All recipients**.\r\n8. (Optional) Under **Exclude these recipients**, add **Users** and **Groups** to be exempted from the preset policies.\r\n9. Select **Next** on each page until the **Review and confirm your changes** page.\r\n10. On the **Review and confirm your changes** page, select **Confirm**.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 15 Link Protection - MS.EXO.15.1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo151v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L813)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.15.2: Direct download links SHOULD be scanned for malware.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.15.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSafeLinkDownloadScan\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"safe link scan enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSafeLinkDownloadScan.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSafeLinkDownloadScan, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSafeLinkDownloadScan.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSafeLinkDownloadScan.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Direct download links SHOULD be scanned for malware.\r\n\r\nRationale: URLs in emails may direct users to download and run malware. Scanning direct download links in real-time for known malware and blocking access can prevent users from infecting their devices.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under either **Standard protection** or **Strict protection**, select **Manage protection settings**.\r\n6. Select **Next** until you reach the **Apply Defender for Office 365 protection** page.\r\n7. On the **Apply Defender for Office 365 protection** page, select **All recipients**.\r\n8. (Optional) Under **Exclude these recipients**, add **Users** and **Groups** to be exempted from the preset policies.\r\n9. Select **Next** on each page until the **Review and confirm your changes** page.\r\n10. On the **Review and confirm your changes** page, select **Confirm**.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 15 Link Protection - MS.EXO.15.2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo152v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L828)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.15.3: User click tracking SHOULD be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.15.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaSafeLinkClickTracking\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"safe link click tracking enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSafeLinkClickTracking.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaSafeLinkClickTracking, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaSafeLinkClickTracking.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaSafeLinkClickTracking.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "User click tracking SHOULD be enabled.\r\n\r\nRationale: Users may click on malicious links in emails, leading to compromise or unauthorized data disclosure. Enabling user click tracking lets agencies know if a malicious link may have been visited after the fact to help tailor a response to a potential incident.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. In the left-hand menu, go to **Email & Collaboration** > **Policies & Rules**.\r\n3. Select **Threat Policies**.\r\n4. From the **Templated policies** section, select **Preset Security Policies**.\r\n5. Under either **Standard protection** or **Strict protection**, select **Manage protection settings**.\r\n6. Select **Next** until you reach the **Apply Defender for Office 365 protection** page.\r\n7. On the **Apply Defender for Office 365 protection** page, select **All recipients**.\r\n8. (Optional) Under **Exclude these recipients**, add **Users** and **Groups** to be exempted from the preset policies.\r\n9. Select **Next** on each page until the **Review and confirm your changes** page.\r\n10. On the **Review and confirm your changes** page, select **Confirm**.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Preset security policies](https://security.microsoft.com/presetSecurityPolicies)\r\n* [CISA 15 Link Protection - MS.EXO.15.3](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo153v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L843)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.16.1: Alerts SHALL be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.16.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaExoAlert\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"alerts enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaExoAlert.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaExoAlert, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaExoAlert.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaExoAlert.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "At a minimum, the following alerts SHALL be enabled:\r\na. Suspicious email sending patterns detected.\r\nb. Suspicious Connector Activity.\r\nc. Suspicious Email Forwarding Activity.\r\nd. Messages have been delayed.\r\ne. Tenant restricted from sending unprovisioned email.\r\nf. Tenant restricted from sending email.\r\ng. A potentially malicious URL click was detected.\r\n\r\nRationale: Potentially malicious or service impacting events may go undetected without a means of detecting these events. Setting up a mechanism to alert administrators to events listed above draws attention to them to help minimize impact to users and the agency.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. Under **Email & collaboration**, select **Policies & rules**.\r\n3. Select (**Alert Policy**)[https://security.microsoft.com/alertpoliciesv2].\r\n4. Select the checkbox next to each alert to enable as determined by the agency and at a minimum those referenced in the [CISA M365 Security Configuration Baseline for Exchange Online](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo161v1) which are:\r\n    a. Suspicious email sending patterns detected.\r\n    b. Suspicious connector activity.\r\n    c. Suspicious Email Forwarding Activity.\r\n    d. Messages have been delayed.\r\n    e. Tenant restricted from sending unprovisioned email.\r\n    f. Tenant restricted from sending email.\r\n    g. A potentially malicious URL click was detected.\r\n5. Click the pencil icon from the top menu.\r\n6. Select the **Enable selected policies** action from the **Bulk actions** menu.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Alert policy](https://security.microsoft.com/alertpoliciesv2)\r\n* [CISA 16 Alerts - MS.EXO.16.1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo161v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L863)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.16.2: Alerts SHOULD be sent to a monitored address or incorporated into a security information and event management (SIEM) system.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.16.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaExoAlertSiem\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"alerts enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaExoAlertSiem.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaExoAlertSiem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaExoAlertSiem.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaExoAlertSiem.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Alerts SHOULD be sent to a monitored address or incorporated into a security information and event management (SIEM) system.\r\n\r\nRationale: Suspicious or malicious events, if not resolved promptly, may have a greater impact to users and the agency. Sending alerts to a monitored email address or SIEM system helps ensure these suspicious or malicious events are acted upon in a timely manner to limit overall impact.\r\n\r\n#### Remediation action:\r\n\r\n1. Sign in to **Microsoft 365 Defender**.\r\n2. Select [**Settings**](https://security.microsoft.com/securitysettings).\r\n3. Select either:\r\n    a. [**Microsoft Sentinel**](https://security.microsoft.com/sentinel/settings).\r\n    b. **Defender XDR**, and under **General**, select [**Streaming API**](https://security.microsoft.com/securitysettings/defender/raw_data_export).\r\n4. Ensure a SIEM integration is configured for your organization.\r\n\r\n#### Related links\r\n\r\n* [Defender admin center - Alert policy](https://security.microsoft.com/alertpoliciesv2)\r\n* [Defender admin center - Streaming API](https://security.microsoft.com/securitysettings/defender/raw_data_export)\r\n* [Defender admin center - Sentinel workspaces](https://security.microsoft.com/sentinel/settings)\r\n* [CISA 16 Alerts - MS.EXO.16.2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo162v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L878)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.17.1: Microsoft Purview Audit (Standard) logging SHALL be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.17.1",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAuditLog\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"safe link enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAuditLog.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAuditLog, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAuditLog.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAuditLog.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Microsoft Purview Audit (Standard) logging SHALL be enabled.\r\n\r\nRationale: Responding to incidents without detailed information about activities that took place slows response actions. Enabling Microsoft Purview Audit (Standard) helps ensure agencies have visibility into user actions. Furthermore, Microsoft Purview Audit (Standard) is required for government agencies by OMB M-21-31 (referred to therein by its former name, Unified Audit Logs).\r\n\r\n#### Remediation action:\r\n\r\nTo enable auditing via the Microsoft Purview compliance portal:\r\n1. Sign in to the **Microsoft Purview compliance portal**.\r\n2. Under **Solutions**, select [**Audit**](https://purview.microsoft.com/audit/auditsearch).\r\n3. If auditing is not enabled, a banner is displayed to notify the administrator to start recording user and admin activity.\r\n4. Click the **Start recording user and admin activity**.\r\n\r\n#### Related links\r\n\r\n* [Purview portal - Audit search](https://purview.microsoft.com/audit/auditsearch)\r\n* [CISA 17 Audit Logging - MS.EXO.17.1](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo171v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L898)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.17.2: Microsoft Purview Audit (Premium) logging SHALL be enabled.",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.17.2",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAuditLogPremium\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAuditLogPremium.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAuditLogPremium, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAuditLogPremium.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAuditLogPremium.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Microsoft Purview Audit (Premium) logging SHALL be enabled.\r\n\r\nRationale: Standard logging may not include relevant details necessary for visibility into user actions during an incident. Enabling Microsoft Purview Audit (Premium) captures additional event types not included with Standard. Furthermore, it is required for government agencies by OMB M-21-13 (referred to therein by its former name, Unified Audit Logs w/Advanced Features).\r\n\r\n#### Remediation action:\r\n\r\nTo set up Microsoft Purview Audit (Premium), see [Set up Microsoft Purview Audit (Premium) | Microsoft Learn](https://learn.microsoft.com/en-us/purview/audit-premium-setup?view=o365-worldwide).\r\n\r\n#### Related links\r\n\r\n* [Purview portal - Audit search](https://purview.microsoft.com/audit/auditsearch)\r\n* [CISA 17 Audit Logging - MS.EXO.17.2](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo172v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L913)\r\n\r\n"
      }
    },
    {
      "Name": "MS.EXO.17.3: Audit logs SHALL be maintained for at least the minimum duration dictated by OMB M-21-31 (Appendix C).",
      "HelpUrl": "",
      "Tag": [
        "MS.EXO",
        "MS.EXO.17.3",
        "CISA",
        "Security",
        "All"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtCisaAuditLogRetention\r\n\r\n        if ($null -ne $result) {\r\n            $result | Should -Be $true -Because \"enabled.\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAuditLogRetention.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtCisaAuditLogRetention, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\cisa\\exchange\\Test-MtCisaAuditLogRetention.ps1: line 22\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\cisa\\exchange\\Test-MtCisaAuditLogRetention.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "CISA SCuBA",
      "ResultDetail": {
        "TestSkipped": "NotConnectedExchange",
        "SkippedReason": "Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\nSkipped. Not connected to Exchange Online. See [Connecting to Exchange Online](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "Audit logs SHALL be maintained for at least the minimum duration dictated by OMB M-21-31 (Appendix C).\r\n\r\nRationale: Audit logs may no longer be available when needed if they are not retained for a sufficient time. Increased log retention time gives an agency the necessary visibility to investigate incidents that occurred some time ago. OMB M-21-13, Appendix C, Table 5 specifically calls out Unified Audit Logs in the Cloud Azure log category.\r\n\r\n#### Remediation action:\r\n\r\nTo create one or more custom audit retention policies, if the default retention policy is not sufficient for agency needs, follow [Create an audit log retention policy](https://learn.microsoft.com/en-us/purview/audit-log-retention-policies?view=o365-worldwide&tabs=microsoft-purview-portal#create-an-audit-log-retention-policy) instructions. Ensure the duration selected in the retention policies is at least one year, in accordance with OMB M-21-31.\r\n\r\n#### Related links\r\n\r\n* [Purview portal - Audit policies](https://purview.microsoft.com/audit/auditpolicies)\r\n* [CISA 17 Audit Logging - MS.EXO.17.3](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/baselines/exo.md#msexo173v1)\r\n* [CISA ScubaGear Rego Reference](https://github.com/cisagov/ScubaGear/blob/main/PowerShell/ScubaGear/Rego/EXOConfig.rego#L928)\r\n\r\n"
      }
    },
    {
      "Name": "MT.1002: App management restrictions on applications and service principals is configured and enabled.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1002",
      "Tag": [
        "Maester",
        "App",
        "Security",
        "All",
        "MT.1002"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        Test-MtAppManagementPolicyEnabled | Should -Be $true -Because \"an app policy for workload identities should be defined to enforce strong credentials instead of passwords and a maximum expiry period (e.g. credential should be renewed every six months)\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-AppManagementPolicies.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because This test is for tenants that are licensed for Entra Workload ID. See [Entra Workload ID licensing](https://learn.microsoft.com/entra/workload-id/workload-identities-faqs)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because This test is for tenants that are licensed for Entra Workload ID. See [Entra Workload ID licensing](https://learn.microsoft.com/entra/workload-id/workload-identities-faqs)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtAppManagementPolicyEnabled, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Test-MtAppManagementPolicyEnabled.ps1: line 20\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-AppManagementPolicies.Tests.ps1: line 4\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "App Management Policies",
      "ResultDetail": {
        "TestSkipped": "NotLicensedEntraWorkloadID",
        "SkippedReason": "This test is for tenants that are licensed for Entra Workload ID. See [Entra Workload ID licensing](https://learn.microsoft.com/entra/workload-id/workload-identities-faqs)",
        "TestResult": "Skipped. This test is for tenants that are licensed for Entra Workload ID. See [Entra Workload ID licensing](https://learn.microsoft.com/entra/workload-id/workload-identities-faqs)",
        "TestDescription": "By default Microsoft Entra ID allows service principals and applications to be configured with weak credentials.\r\n\r\nThis can include\r\n\r\n- client secrets instead of certificates\r\n- secrets and certificates with long expiry (e.g. 10 year)\r\n\r\n## How to fix\r\n\r\nUsing shorter expiry periods and certificates instead of secrets can help reduce the risk of credentials being compromised and used by an attacker.\r\n\r\nThe sample policy below can be used to enforce credential configurations on apps and service principals.\r\n\r\n```powershell\r\nImport-Module Microsoft.Graph.Identity.SignIns\r\n\r\n$params = @{\r\nisEnabled = $true\r\napplicationRestrictions = @{\r\n    passwordCredentials = @(\r\n    @{\r\n        restrictionType = \"passwordAddition\"\r\n        maxLifetime = $null\r\n        restrictForAppsCreatedAfterDateTime = [System.DateTime]::Parse(\"2021-01-01T10:37:00Z\")\r\n    }\r\n    @{\r\n        restrictionType = \"passwordLifetime\"\r\n        maxLifetime = \"P365D\"\r\n        restrictForAppsCreatedAfterDateTime = [System.DateTime]::Parse(\"2017-01-01T10:37:00Z\")\r\n    }\r\n    @{\r\n        restrictionType = \"symmetricKeyAddition\"\r\n        maxLifetime = $null\r\n        restrictForAppsCreatedAfterDateTime = [System.DateTime]::Parse(\"2021-01-01T10:37:00Z\")\r\n    }\r\n    @{\r\n        restrictionType = \"customPasswordAddition\"\r\n        maxLifetime = $null\r\n        restrictForAppsCreatedAfterDateTime = [System.DateTime]::Parse(\"2015-01-01T10:37:00Z\")\r\n    }\r\n    @{\r\n        restrictionType = \"symmetricKeyLifetime\"\r\n        maxLifetime = \"P365D\"\r\n        restrictForAppsCreatedAfterDateTime = [System.DateTime]::Parse(\"2015-01-01T10:37:00Z\")\r\n    }\r\n    )\r\n    keyCredentials = @(\r\n    @{\r\n        restrictionType = \"asymmetricKeyLifetime\"\r\n        maxLifetime = \"P365D\"\r\n        restrictForAppsCreatedAfterDateTime = [System.DateTime]::Parse(\"2015-01-01T10:37:00Z\")\r\n    }\r\n    )\r\n}\r\n}\r\n\r\nUpdate-MgPolicyDefaultAppManagementPolicy -BodyParameter $params\r\n```\r\n\r\n## Learn more\r\n\r\n- [Tenant App Management Policy - Microsoft Graph Reference](https://learn.microsoft.com/graph/api/resources/tenantappmanagementpolicy?view=graph-rest-1.0)\r\n"
      }
    },
    {
      "Name": "MT.1021: Security Defaults are enabled.",
      "HelpUrl": "https://maester.dev/docs/tests/MT.1021",
      "Tag": [
        "CA",
        "Security",
        "All",
        "MT.1021"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        $EntraIDPlan = Get-MtLicenseInformation -Product EntraID\r\n        if ($EntraIDPlan -ne \"Free\") {\r\n            Add-MtTestResultDetail -SkippedBecause LicensedEntraIDPremium\r\n        } else {\r\n            $SecurityDefaults = Invoke-MtGraphRequest -RelativeUri \"policies/identitySecurityDefaultsEnforcementPolicy\" -ApiVersion beta | Select-Object -ExpandProperty isEnabled\r\n\r\n            if ($SecurityDefaults -eq $true) {\r\n                $testResultMarkdown = \"Well done. SecurityDefaults are On `n`n\"\r\n            } else {\r\n                $testResultMarkdown = \"SecurityDefaults are Off '$($SecurityDefaults)' `n`n\"\r\n            }\r\n            $testDetailsMarkdown = \"You should enable SecurityDefaults or configure Conditional Access.\"\r\n            Add-MtTestResultDetail -Description $testDetailsMarkdown -Result $testResultMarkdown\r\n\r\n            $SecurityDefaults | Should -Be $true -Because \"Security Defaults are not enabled\"\r\n        }\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because This test is for tenants that are not licensed for any Entra ID Premium license. See [Entra ID licensing](https://learn.microsoft.com/entra/fundamentals/licensing)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because This test is for tenants that are not licensed for any Entra ID Premium license. See [Entra ID licensing](https://learn.microsoft.com/entra/fundamentals/licensing)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessBaseline.Tests.ps1: line 84\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Security Defaults",
      "ResultDetail": {
        "TestSkipped": "LicensedEntraIDPremium",
        "SkippedReason": "This test is for tenants that are not licensed for any Entra ID Premium license. See [Entra ID licensing](https://learn.microsoft.com/entra/fundamentals/licensing)",
        "TestResult": "Skipped. This test is for tenants that are not licensed for any Entra ID Premium license. See [Entra ID licensing](https://learn.microsoft.com/entra/fundamentals/licensing)",
        "TestDescription": ""
      }
    },
    {
      "Name": "MT.1033: User should be blocked from using legacy authentication (<userPrincipalName>)",
      "HelpUrl": "",
      "Tag": "MT.1033",
      "Result": "NotRun",
      "ScriptBlock": "\r\n            Test-MtCaWIFBlockLegacyAuthentication -UserId $id | Should -Be $true\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessWhatIf.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Regular users",
      "ResultDetail": null
    },
    {
      "Name": "MT.1033: User should be blocked from using legacy authentication (<userPrincipalName>)",
      "HelpUrl": "",
      "Tag": "MT.1033",
      "Result": "NotRun",
      "ScriptBlock": "\r\n            Test-MtCaWIFBlockLegacyAuthentication -UserId $id | Should -Be $true\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessWhatIf.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Regular users",
      "ResultDetail": null
    },
    {
      "Name": "MT.1033: User should be blocked from using legacy authentication (<userPrincipalName>)",
      "HelpUrl": "",
      "Tag": "MT.1033",
      "Result": "NotRun",
      "ScriptBlock": "\r\n            Test-MtCaWIFBlockLegacyAuthentication -UserId $id | Should -Be $true\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessWhatIf.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Regular users",
      "ResultDetail": null
    },
    {
      "Name": "MT.1033: User should be blocked from using legacy authentication (<userPrincipalName>)",
      "HelpUrl": "",
      "Tag": "MT.1033",
      "Result": "NotRun",
      "ScriptBlock": "\r\n            Test-MtCaWIFBlockLegacyAuthentication -UserId $id | Should -Be $true\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessWhatIf.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Regular users",
      "ResultDetail": null
    },
    {
      "Name": "MT.1034: Emergency access users should not be blocked (<userPrincipalName>)",
      "HelpUrl": "",
      "Tag": "MT.1034",
      "Result": "NotRun",
      "ScriptBlock": "\r\n            if ( ( Get-MtLicenseInformation EntraID ) -eq \"Free\" ) {\r\n                Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP1\r\n            } else {\r\n                Test-MtConditionalAccessWhatIf -UserId $id -IncludeApplications \"00000002-0000-0ff1-ce00-000000000000\" -ClientAppType exchangeActiveSync | Should -BeNullOrEmpty\r\n            }\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessWhatIf.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Emergency access users",
      "ResultDetail": null
    },
    {
      "Name": "MT.1034: Emergency access users should not be blocked (<userPrincipalName>)",
      "HelpUrl": "",
      "Tag": "MT.1034",
      "Result": "NotRun",
      "ScriptBlock": "\r\n            if ( ( Get-MtLicenseInformation EntraID ) -eq \"Free\" ) {\r\n                Add-MtTestResultDetail -SkippedBecause NotLicensedEntraIDP1\r\n            } else {\r\n                Test-MtConditionalAccessWhatIf -UserId $id -IncludeApplications \"00000002-0000-0ff1-ce00-000000000000\" -ClientAppType exchangeActiveSync | Should -BeNullOrEmpty\r\n            }\r\n        ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Entra\\Test-ConditionalAccessWhatIf.Tests.ps1",
      "ErrorRecord": [],
      "Block": "Emergency access users",
      "ResultDetail": null
    },
    {
      "Name": "MT.1037 Only users with Presenter role are allowed to present in Teams meetings",
      "HelpUrl": "",
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All",
        "MT.1037"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $result = Test-MtTeamsRestrictParticipantGiveRequestControl -TeamsMeetingPolicy $TeamsMeetingPolicy\r\n        $result | Should -Be $true -Because \"Standard attendees in a Teams meeting should not be allowed to present in Teams meetings unless they are assigned the Presenter role.\"\r\n\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat Test-MtTeamsRestrictParticipantGiveRequestControl, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\maester\\teams\\Test-MtTeamsRestrictParticipantGiveRequestControl.ps1: line 28\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1: line 15\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Teams Meeting policies",
      "ResultDetail": {
        "TestSkipped": "NotConnectedTeams",
        "SkippedReason": "Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "\r\n\r\nSkipped. Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": "This test checks the Org-wide default meeting policy is configured to only allow users in the **Presenter** role to request control and share content during meetings.\r\n\r\nRestricting who can present limits meeting disruptions and reduces the risk of unwanted or inappropriate content being shared.\r\n\r\n#### Remediation action:\r\n\r\nTo prevent standard attendees from sharing content during Teams meetings:\r\n\r\n1. Click here to open [**Org-wide default settings > Meetings**](https://admin.teams.microsoft.com/one-policy/settings/meeting)\r\n   * Or navigate to [Teams Admin Center](https://admin.teams.microsoft.com).\r\n   * Click **Settings & policies > Org-wide default settings > Meetings**.\r\n1. Scroll to the **Content sharing** section.\r\n1. Set **Participants can give or request control** to **Off**.\r\n1. Click Save.\r\n\r\n#### Related links\r\n\r\n* [Manage meeting policies for content sharing](https://learn.microsoft.com/en-us/microsoftteams/meeting-policies-content-sharing)\r\n* [7 tips for safe online meetings and collaboration with Microsoft Teams - Tip 3: Determine who can present content or share their screen in your Teams meeting](https://techcommunity.microsoft.com/blog/microsoftteamsblog/7-tips-for-safe-online-meetings-and-collaboration-with-microsoft-teams/2072303)\r\n\r\n"
      }
    },
    {
      "Name": "MT.1038 Only invited users should be automatically admitted to Teams meetings",
      "HelpUrl": "",
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All",
        "MT.1038"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n        #($TeamsMeetingPolicyGlobal.AutoAdmittedUsers -eq \"InvitedUsers\")\r\n        $TeamsMeetingPolicyGlobal = $TeamsMeetingPolicy | Where-Object { $_.Identity -eq \"Global\" }\r\n        $portalLink_MeetingPolicy = \"https://admin.teams.microsoft.com/policies/meetings\"\r\n\r\n        if (!(Test-MtConnection Teams)) {\r\n            Add-MtTestResultDetail -SkippedBecause NotConnectedTeams\r\n            return $null\r\n        }\r\n\r\n        $result = $TeamsMeetingPolicyGlobal.AutoAdmittedUsers\r\n\r\n        if ($result -eq \"InvitedUsers\") {\r\n            $testResultMarkdown = \"Well done. AutoAdmittedUsers is $($result)`n`n\"\r\n        } else {\r\n            $testResultMarkdown = \"AutoAdmittedUsers in [Meeting policies]($portalLink_MeetingPolicy) should be InvitedUsers and is $($result) `n`n\"\r\n        }\r\n        $testDetailsMarkdown = \"Users who aren’t invited to a meeting shouldn’t be let in automatically, because it increases the risk of data leaks, inappropriate content being shared, or malicious actors joining. If only invited users are automatically admitted, then users who weren’t invited will be sent to a meeting lobby. The host can then decide whether or not to let them in.\"\r\n        Add-MtTestResultDetail -Description $testDetailsMarkdown -Result $testResultMarkdown\r\n\r\n        $result | Should -Be \"InvitedUsers\" -Because \"AutoAdmittedUsers should be InvitedUsers\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1: line 26\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Teams Meeting policies",
      "ResultDetail": {
        "TestSkipped": "NotConnectedTeams",
        "SkippedReason": "Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "Skipped. Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": ""
      }
    },
    {
      "Name": "MT.1039 Restrict anonymous users from joining meetings",
      "HelpUrl": "",
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All",
        "MT.1039"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $TeamsMeetingPolicyGlobal = $TeamsMeetingPolicy | Where-Object { $_.Identity -eq \"Global\" }\r\n        $portalLink_MeetingPolicy = \"https://admin.teams.microsoft.com/policies/meetings\"\r\n\r\n        if (!(Test-MtConnection Teams)) {\r\n            Add-MtTestResultDetail -SkippedBecause NotConnectedTeams\r\n            return $null\r\n        }\r\n\r\n        $result = $TeamsMeetingPolicyGlobal.AllowAnonymousUsersToJoinMeeting\r\n\r\n        if ($result -eq $false) {\r\n            $testResultMarkdown = \"Well done. AllowAnonymousUsersToJoinMeeting is $($result)`n`n\"\r\n        } else {\r\n            $testResultMarkdown = \"AllowAnonymousUsersToJoinMeeting in [Meeting policies]($portalLink_MeetingPolicy) should be False and is $($result) `n`n\"\r\n        }\r\n        $testDetailsMarkdown = \"By restricting anonymous users from joining Microsoft Teams meetings, you have full control over meeting access. Anonymous users may not be from your organization and could have joined for malicious purposes, such as gaining information about your organization through conversations.\"\r\n        Add-MtTestResultDetail -Description $testDetailsMarkdown -Result $testResultMarkdown\r\n\r\n        $result | Should -Be $false -Because \"AllowAnonymousUsersToJoinMeeting should be False\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1: line 49\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Teams Meeting policies",
      "ResultDetail": {
        "TestSkipped": "NotConnectedTeams",
        "SkippedReason": "Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "Skipped. Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": ""
      }
    },
    {
      "Name": "MT.1040 Restrict anonymous users from starting Teams meetings",
      "HelpUrl": "",
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All",
        "MT.1040"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $TeamsMeetingPolicyGlobal = $TeamsMeetingPolicy | Where-Object { $_.Identity -eq \"Global\" }\r\n        $portalLink_MeetingPolicy = \"https://admin.teams.microsoft.com/policies/meetings\"\r\n\r\n        if (!(Test-MtConnection Teams)) {\r\n            Add-MtTestResultDetail -SkippedBecause NotConnectedTeams\r\n            return $null\r\n        }\r\n\r\n        $result = $TeamsMeetingPolicyGlobal.AllowAnonymousUsersToStartMeeting\r\n\r\n        if ($result -eq $false) {\r\n            $testResultMarkdown = \"Well done. AllowAnonymousUsersToStartMeeting is $($result)`n`n\"\r\n        } else {\r\n            $testResultMarkdown = \"AllowAnonymousUsersToStartMeeting in [Meeting policies]($portalLink_MeetingPolicy) should be False and is $($result) `n`n\"\r\n        }\r\n        $testDetailsMarkdown = \"If anonymous users are allowed to start meetings, they can admit any users from the lobbies, authenticated or otherwise. Anonymous users haven’t been authenticated, which can increase the risk of data leakage.\"\r\n        Add-MtTestResultDetail -Description $testDetailsMarkdown -Result $testResultMarkdown\r\n\r\n        $result | Should -Be $false -Because \"AllowAnonymousUsersToStartMeeting should be False\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1: line 72\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Teams Meeting policies",
      "ResultDetail": {
        "TestSkipped": "NotConnectedTeams",
        "SkippedReason": "Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "Skipped. Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": ""
      }
    },
    {
      "Name": "MT.1041 Limit external participants from having control in a Teams meeting",
      "HelpUrl": "",
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All",
        "MT.1041"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $TeamsMeetingPolicyGlobal = $TeamsMeetingPolicy | Where-Object { $_.Identity -eq \"Global\" }\r\n        $portalLink_MeetingPolicy = \"https://admin.teams.microsoft.com/policies/meetings\"\r\n\r\n        if (!(Test-MtConnection Teams)) {\r\n            Add-MtTestResultDetail -SkippedBecause NotConnectedTeams\r\n            return $null\r\n        }\r\n\r\n        $result = $TeamsMeetingPolicyGlobal.AllowExternalParticipantGiveRequestControl\r\n\r\n        if ($result -eq $false) {\r\n            $testResultMarkdown = \"Well done. AllowExternalParticipantGiveRequestControl is $($result)`n`n\"\r\n        } else {\r\n            $testResultMarkdown = \"AllowExternalParticipantGiveRequestControl in [Meeting policies]($portalLink_MeetingPolicy) should be False and is $($result) `n`n\"\r\n        }\r\n        $testDetailsMarkdown = \"External participants are users that are outside your organization. Limiting their permission to share content, add new users, and more protects your organization’s information from data leaks, inappropriate content being shared, or malicious actors joining the meeting.\"\r\n        Add-MtTestResultDetail -Description $testDetailsMarkdown -Result $testResultMarkdown\r\n\r\n        $result | Should -Be $false -Because \"AllowExternalParticipantGiveRequestControl should be False\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1: line 95\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Teams Meeting policies",
      "ResultDetail": {
        "TestSkipped": "NotConnectedTeams",
        "SkippedReason": "Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "Skipped. Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": ""
      }
    },
    {
      "Name": "MT.1042 Restrict dial-in users from bypassing a meeting lobby ",
      "HelpUrl": "",
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All",
        "MT.1042"
      ],
      "Result": "Skipped",
      "ScriptBlock": "\r\n\r\n        $TeamsMeetingPolicyGlobal = $TeamsMeetingPolicy | Where-Object { $_.Identity -eq \"Global\" }\r\n        $portalLink_MeetingPolicy = \"https://admin.teams.microsoft.com/policies/meetings\"\r\n\r\n        if (!(Test-MtConnection Teams)) {\r\n            Add-MtTestResultDetail -SkippedBecause NotConnectedTeams\r\n            return $null\r\n        }\r\n\r\n        $result = $TeamsMeetingPolicyGlobal.AllowPSTNUsersToBypassLobby\r\n\r\n        if ($result -eq $false) {\r\n            $testResultMarkdown = \"Well done. AllowPSTNUsersToBypassLobby is $($result)`n`n\"\r\n        } else {\r\n            $testResultMarkdown = \"AllowPSTNUsersToBypassLobby in [Meeting policies]($portalLink_MeetingPolicy) should be False and is $($result) `n`n\"\r\n        }\r\n        $testDetailsMarkdown = \"Dial-in users aren’t authenticated though the Teams app. Increase the security of your meetings by preventing these unknown users from bypassing the lobby and immediately joining the meeting.\"\r\n        Add-MtTestResultDetail -Description $testDetailsMarkdown -Result $testResultMarkdown\r\n\r\n        $result | Should -Be $false -Because \"AllowPSTNUsersToBypassLobby should be False\"\r\n    ",
      "ScriptBlockFile": "C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1",
      "ErrorRecord": [
        {
          "Exception": {
            "TargetSite": null,
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "Data": "System.Collections.ListDictionaryInternal",
            "InnerException": null,
            "HelpLink": null,
            "Source": null,
            "HResult": -2146233088,
            "StackTrace": null
          },
          "TargetObject": {
            "Message": "is skipped, because Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
            "File": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1",
            "Line": "147",
            "LineText": "Set-ItResult -Skipped -Because $SkippedReason",
            "Terminating": false
          },
          "CategoryInfo": {
            "Category": 8,
            "Activity": "",
            "Reason": "Exception",
            "TargetName": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "TargetType": "Dictionary`2"
          },
          "FullyQualifiedErrorId": "PesterTestSkipped",
          "ErrorDetails": null,
          "InvocationInfo": {
            "MyCommand": null,
            "BoundParameters": "System.Collections.Generic.Dictionary`2[System.String,System.Object]",
            "UnboundArguments": "",
            "ScriptLineNumber": 16092,
            "OffsetInLine": 5,
            "HistoryId": 20,
            "ScriptName": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "Line": "    throw [Pester.Factory]::CreateErrorRecord(\r\n",
            "Statement": "throw [Pester.Factory]::CreateErrorRecord(\r\n        $errorId, #string errorId\r\n        $Message, #string message\r\n        $File, #string file\r\n        $Line, #string line\r\n        $LineText, #string lineText\r\n        $false #bool terminating\r\n    )",
            "PositionMessage": "At C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1:16092 char:5\r\n+     throw [Pester.Factory]::CreateErrorRecord(\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
            "PSScriptRoot": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1",
            "PSCommandPath": "C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1",
            "InvocationName": "",
            "PipelineLength": 0,
            "PipelinePosition": 0,
            "ExpectingInput": false,
            "CommandOrigin": 1,
            "DisplayScriptPosition": null
          },
          "ScriptStackTrace": "at Set-ItResult, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 16092\r\nat Add-MtTestResultDetail, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Add-MtTestResultDetail.ps1: line 147\r\nat <ScriptBlock>, C:\\Users\\marc-antoinehebert\\Downloads\\road-to-builder\\micro-projects\\maester-tests\\Maester\\Teams\\Test-TeamsMeeting.Tests.ps1: line 118\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2157\r\nat Invoke-TestItem, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1199\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 835\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 893\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2024\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1985\r\nat Invoke-ScriptBlock, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2160\r\nat Invoke-Block, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 940\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1688\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.ps1: line 3\r\nat <ScriptBlock>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3260\r\nat Invoke-InNewScriptScope, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 3267\r\nat Run-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 1691\r\nat Invoke-Test, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 2512\r\nat Invoke-Pester<End>, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Pester\\5.7.1\\Pester.psm1: line 4960\r\nat Invoke-Maester, C:\\Mac\\Home\\Documents\\PowerShell\\Modules\\Maester\\1.0.0\\public\\Invoke-Maester.ps1: line 309\r\nat <ScriptBlock>, <No file>: line 1",
          "PipelineIterationInfo": []
        }
      ],
      "Block": "Teams Meeting policies",
      "ResultDetail": {
        "TestSkipped": "NotConnectedTeams",
        "SkippedReason": "Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestResult": "Skipped. Not connected to Teams. See [Connecting to Teams](https://maester.dev/docs/connect-maester/#connect-to-azure-exchange-online-and-teams)",
        "TestDescription": ""
      }
    }
  ],
  "Blocks": [
    {
      "Name": "CIS",
      "Result": "Passed",
      "FailedCount": 1,
      "PassedCount": 2,
      "SkippedCount": 11,
      "NotRunCount": 0,
      "TotalCount": 14,
      "Tag": [
        "CIS 1.2.1",
        "L2",
        "CIS E3 Level 2",
        "CIS E3",
        "CIS",
        "Security",
        "All",
        "CIS M365 v3.1.0"
      ]
    },
    {
      "Name": "CISA SCuBA",
      "Result": "Failed",
      "FailedCount": 21,
      "PassedCount": 10,
      "SkippedCount": 42,
      "NotRunCount": 0,
      "TotalCount": 73,
      "Tag": [
        "MS.AAD",
        "MS.AAD.7.8",
        "CISA",
        "Security",
        "All",
        "Entra ID P2"
      ]
    },
    {
      "Name": "Default Authorization Settings",
      "Result": "Failed",
      "FailedCount": 5,
      "PassedCount": 4,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 9,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AP01"
      ]
    },
    {
      "Name": "Default Settings - Consent Policy Settings",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 2,
      "SkippedCount": 1,
      "NotRunCount": 0,
      "TotalCount": 3,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CP01"
      ]
    },
    {
      "Name": "Default Settings - Password Rule Settings",
      "Result": "Failed",
      "FailedCount": 2,
      "PassedCount": 3,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 5,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.PR01"
      ]
    },
    {
      "Name": "Default Settings - Classification and M365 Groups",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 2,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 2,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.ST08"
      ]
    },
    {
      "Name": "Authentication Method - General Settings",
      "Result": "Failed",
      "FailedCount": 2,
      "PassedCount": 1,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 3,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AG01"
      ]
    },
    {
      "Name": "Authentication Method - Microsoft Authenticator",
      "Result": "Passed",
      "FailedCount": 3,
      "PassedCount": 5,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 8,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AM01"
      ]
    },
    {
      "Name": "Authentication Method - FIDO2 security key",
      "Result": "Passed",
      "FailedCount": 1,
      "PassedCount": 3,
      "SkippedCount": 2,
      "NotRunCount": 0,
      "TotalCount": 6,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AF01"
      ]
    },
    {
      "Name": "Authentication Method - Temporary Access Pass",
      "Result": "Passed",
      "FailedCount": 1,
      "PassedCount": 1,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 2,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AT01"
      ]
    },
    {
      "Name": "Authentication Method - Voice call",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 1,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 1,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AV01"
      ]
    },
    {
      "Name": "Authentication Method - SMS",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 0,
      "SkippedCount": 1,
      "NotRunCount": 0,
      "TotalCount": 1,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.AS04"
      ]
    },
    {
      "Name": "Consent Framework - Admin Consent Request",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 4,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 4,
      "Tag": [
        "EIDSCA",
        "Security",
        "All",
        "EIDSCA.CR01"
      ]
    },
    {
      "Name": "App Management Policies",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 0,
      "SkippedCount": 1,
      "NotRunCount": 0,
      "TotalCount": 1,
      "Tag": [
        "Maester",
        "App",
        "Security",
        "All"
      ]
    },
    {
      "Name": "Conditional Access Baseline Policies",
      "Result": "Failed",
      "FailedCount": 12,
      "PassedCount": 12,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 24,
      "Tag": [
        "Maester",
        "CA",
        "Security",
        "All"
      ]
    },
    {
      "Name": "Security Defaults",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 0,
      "SkippedCount": 1,
      "NotRunCount": 0,
      "TotalCount": 1,
      "Tag": [
        "CA",
        "Security",
        "All"
      ]
    },
    {
      "Name": "Conditional Access WhatIf",
      "Result": "NotRun",
      "FailedCount": 0,
      "PassedCount": 0,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 0,
      "Tag": [
        "Maester",
        "CA",
        "CAWhatIf",
        "Security",
        "All"
      ]
    },
    {
      "Name": "Entra Recommendations",
      "Result": "Failed",
      "FailedCount": 13,
      "PassedCount": 7,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 20,
      "Tag": [
        "Maester",
        "Entra",
        "Security",
        "All",
        "Recommendation"
      ]
    },
    {
      "Name": "Directory Roles - Permanent assignments",
      "Result": "Failed",
      "FailedCount": 2,
      "PassedCount": 2,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 4,
      "Tag": [
        "Maester",
        "Privileged",
        "Security",
        "All"
      ]
    },
    {
      "Name": "Privileged Identity Management (PIM) - Alerts",
      "Result": "Failed",
      "FailedCount": 4,
      "PassedCount": 0,
      "SkippedCount": 0,
      "NotRunCount": 0,
      "TotalCount": 4,
      "Tag": [
        "Privileged",
        "Security",
        "All"
      ]
    },
    {
      "Name": "Teams Meeting policies",
      "Result": "Passed",
      "FailedCount": 0,
      "PassedCount": 0,
      "SkippedCount": 6,
      "NotRunCount": 0,
      "TotalCount": 6,
      "Tag": [
        "Maester",
        "Teams",
        "MeetingPolicy",
        "All"
      ]
    }
  ]
}
